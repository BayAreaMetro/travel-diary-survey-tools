<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Work From Home Analysis - BATS 2023</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="analyze_wfh_files/libs/clipboard/clipboard.min.js"></script>
<script src="analyze_wfh_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="analyze_wfh_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="analyze_wfh_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="analyze_wfh_files/libs/quarto-html/popper.min.js"></script>
<script src="analyze_wfh_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="analyze_wfh_files/libs/quarto-html/anchor.min.js"></script>
<link href="analyze_wfh_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="analyze_wfh_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="analyze_wfh_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="analyze_wfh_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="analyze_wfh_files/libs/bootstrap/bootstrap-9e3ffae467580fdb927a41352e75a2e0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script type="text/javascript">
window.PlotlyConfig = {MathJaxConfig: 'local'};
if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
</script>
<script type="module">import "https://cdn.plot.ly/plotly-3.2.0.min"</script>



</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#run-pipeline" id="toc-run-pipeline" class="nav-link" data-scroll-target="#run-pipeline">Run Pipeline</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data Preparation</a>
  <ul class="collapse">
  <li><a href="#telework-frequency" id="toc-telework-frequency" class="nav-link" data-scroll-target="#telework-frequency">Telework frequency</a></li>
  <li><a href="#impute-commute_freq" id="toc-impute-commute_freq" class="nav-link" data-scroll-target="#impute-commute_freq">Impute commute_freq</a></li>
  <li><a href="#data-filtering" id="toc-data-filtering" class="nav-link" data-scroll-target="#data-filtering">Data filtering</a></li>
  <li><a href="#survey-code-reference" id="toc-survey-code-reference" class="nav-link" data-scroll-target="#survey-code-reference">Survey Code Reference</a></li>
  </ul></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis">Analysis</a>
  <ul class="collapse">
  <li><a href="#classification-rules" id="toc-classification-rules" class="nav-link" data-scroll-target="#classification-rules">Classification Rules</a></li>
  <li><a href="#temporal-validation" id="toc-temporal-validation" class="nav-link" data-scroll-target="#temporal-validation">Temporal Validation</a></li>
  <li><a href="#categorize-telework-frequency" id="toc-categorize-telework-frequency" class="nav-link" data-scroll-target="#categorize-telework-frequency">Categorize Telework Frequency</a></li>
  <li><a href="#categorize-commute-frequency" id="toc-categorize-commute-frequency" class="nav-link" data-scroll-target="#categorize-commute-frequency">Categorize Commute Frequency</a></li>
  <li><a href="#calculate-telework-ratio" id="toc-calculate-telework-ratio" class="nav-link" data-scroll-target="#calculate-telework-ratio">Calculate Telework Ratio</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#telework-frequency-distribution" id="toc-telework-frequency-distribution" class="nav-link" data-scroll-target="#telework-frequency-distribution">Telework Frequency Distribution</a></li>
  <li><a href="#commute-frequency-distribution" id="toc-commute-frequency-distribution" class="nav-link" data-scroll-target="#commute-frequency-distribution">Commute Frequency Distribution</a></li>
  <li><a href="#combined-telework-and-commute-frequency-distribution" id="toc-combined-telework-and-commute-frequency-distribution" class="nav-link" data-scroll-target="#combined-telework-and-commute-frequency-distribution">Combined Telework and Commute Frequency Distribution</a></li>
  <li><a href="#telework-ratio-proportion-of-work-days-at-home" id="toc-telework-ratio-proportion-of-work-days-at-home" class="nav-link" data-scroll-target="#telework-ratio-proportion-of-work-days-at-home">Telework Ratio (Proportion of Work Days at Home)</a></li>
  </ul></li>
  <li><a href="#telework-summary" id="toc-telework-summary" class="nav-link" data-scroll-target="#telework-summary">Telework Summary</a></li>
  <li><a href="#stated-vs-observed-commute-frequency-validation" id="toc-stated-vs-observed-commute-frequency-validation" class="nav-link" data-scroll-target="#stated-vs-observed-commute-frequency-validation">Stated vs Observed Commute Frequency Validation</a>
  <ul class="collapse">
  <li><a href="#classify-weekdays-as-commute-days" id="toc-classify-weekdays-as-commute-days" class="nav-link" data-scroll-target="#classify-weekdays-as-commute-days">Classify Weekdays as Commute Days</a></li>
  <li><a href="#calculate-observed-frequencies" id="toc-calculate-observed-frequencies" class="nav-link" data-scroll-target="#calculate-observed-frequencies">Calculate Observed Frequencies</a></li>
  <li><a href="#merge-with-stated-frequencies" id="toc-merge-with-stated-frequencies" class="nav-link" data-scroll-target="#merge-with-stated-frequencies">Merge with Stated Frequencies</a></li>
  <li><a href="#observed-frequency-distributions" id="toc-observed-frequency-distributions" class="nav-link" data-scroll-target="#observed-frequency-distributions">Observed Frequency Distributions</a></li>
  <li><a href="#stated-vs-observed-comparison" id="toc-stated-vs-observed-comparison" class="nav-link" data-scroll-target="#stated-vs-observed-comparison">Stated vs Observed Comparison</a></li>
  </ul></li>
  <li><a href="#reporting-discrepancies" id="toc-reporting-discrepancies" class="nav-link" data-scroll-target="#reporting-discrepancies">Reporting Discrepancies</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Work From Home Analysis - BATS 2023</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview" class="level1">
<h1>Overview</h1>
<p>This report analyzes work-from-home (WFH) patterns among employed persons in the BATS 2023 survey data. The analysis examines:</p>
<ul>
<li>Telework frequency (days per week working from home)</li>
<li>Commute frequency (days per week commuting to workplace)</li>
<li>Telework ratio (proportion of work days spent at home)</li>
<li>Temporal validation (identifying impossible telework/commute combinations)</li>
</ul>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div id="imports" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> enum <span class="im">import</span> IntEnum</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotly.subplots <span class="im">import</span> make_subplots</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pipeline.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> processing <span class="im">import</span> link_trips, load_data, write_data</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> processing.cleaning.clean_bats_2023 <span class="im">import</span> clean_2023_bats</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> data_canon.core.labeled_enum <span class="im">import</span> LabeledEnum</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure logging</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>logging.basicConfig(</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    level<span class="op">=</span>logging.INFO,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">format</span><span class="op">=</span><span class="st">"</span><span class="sc">%(asctime)s</span><span class="st"> | </span><span class="sc">%(levelname)s</span><span class="st"> | </span><span class="sc">%(message)s</span><span class="st">"</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="mount-drives" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Try to mount network drives if not already mounted</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    os.system(<span class="vs">r"net use M: </span><span class="ch">\\</span><span class="vs">models</span><span class="dv">.</span><span class="vs">ad</span><span class="dv">.</span><span class="vs">mtc</span><span class="dv">.</span><span class="vs">ca</span><span class="dv">.</span><span class="vs">gov</span><span class="dv">\d</span><span class="vs">ata</span><span class="dv">\m</span><span class="vs">odels"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"Mounted M: drive"</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="ss">f"Could not mount M: drive: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    os.system(<span class="vs">r"net use X: </span><span class="ch">\\</span><span class="vs">model3-a</span><span class="dv">\M</span><span class="vs">odel3A-Share"</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="st">"Mounted X: drive"</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    logger.warning(<span class="ss">f"Could not mount X: drive: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="run-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="run-pipeline">Run Pipeline</h2>
<div id="constants" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom enums for categorizing responses</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FrequencyCategory(LabeledEnum):</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Ordered frequency categories for sorting."""</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    FIVE_PLUS <span class="op">=</span> (<span class="dv">5</span>, <span class="st">"5+ days per week"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    FOUR <span class="op">=</span> (<span class="dv">4</span>, <span class="st">"4 days per week"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    TWO_THREE <span class="op">=</span> (<span class="dv">3</span>, <span class="st">"2-3 days per week"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    ONE <span class="op">=</span> (<span class="dv">2</span>, <span class="st">"1 day per week"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    LESS_THAN_WEEKLY <span class="op">=</span> (<span class="dv">1</span>, <span class="st">"Less than once a week"</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    NEVER <span class="op">=</span> (<span class="dv">0</span>, <span class="st">"Almost never"</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    MISSING <span class="op">=</span> (<span class="op">-</span><span class="dv">1</span>, <span class="st">"Missing Response"</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TeleworkRatio(LabeledEnum):</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Ordered telework ratio categories for sorting."""</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    ALWAYS <span class="op">=</span> (<span class="dv">4</span>, <span class="st">"Always"</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    MORE_THAN_60 <span class="op">=</span> (<span class="dv">3</span>, <span class="st">"More than 60</span><span class="sc">% o</span><span class="st">f the time"</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    ABOUT_HALF <span class="op">=</span> (<span class="dv">2</span>, <span class="st">"About half (40-60%)"</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    LESS_THAN_40 <span class="op">=</span> (<span class="dv">1</span>, <span class="st">"Less than 40</span><span class="sc">% o</span><span class="st">f the time"</span>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    NEVER <span class="op">=</span> (<span class="dv">0</span>, <span class="st">"Never, or less than once a week"</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    MISSING <span class="op">=</span> (<span class="op">-</span><span class="dv">1</span>, <span class="st">"Missing Response"</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Employment codes we care about (from data_canon.codebook.persons.Employment)</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>EMPLOYED_CODES <span class="op">=</span> [<span class="dv">1</span>]  <span class="co"># Fulltime employed persons only</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuration</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>CONFIG_PATH <span class="op">=</span> Path(<span class="st">"config.yaml"</span>)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>CACHE_PATH <span class="op">=</span> <span class="st">".cache"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="load-data" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the 2019 and 2023 persons data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>persons_23_dir <span class="op">=</span> Path(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"E:/Box/Modeling and Surveys/Surveys/Travel Diary Survey/BATS_2023/MTC_RSG_Partner Repository/"</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"5.Deliverables/Task 10 - Weighting and Expansion Data Files/UnweightedDataset/"</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>persons_19_dir <span class="op">=</span> Path(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"M:/Data/HomeInterview/Bay Area Travel Study 2018-2019/Data/Final Version with Imputations/"</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Final Updated Dataset as of 10-18-2021/"</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>weights_23_dir <span class="op">=</span> Path(</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"X:/survey_repos/ProjRoot_Mon-Thu20251201/WgtRoot_Mon-Thu20251201_nocommutemode/output/"</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the 2019 data</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>persons_19 <span class="op">=</span> pl.read_csv(</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    persons_19_dir <span class="op">/</span> <span class="st">"person.tsv"</span>,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    separator<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    ignore_errors<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Load 2023 data and replace the old weights</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>person_weights_23 <span class="op">=</span> pl.read_csv(weights_23_dir <span class="op">/</span> <span class="st">"person_weights.csv"</span>)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>persons_23 <span class="op">=</span> pl.read_csv(persons_23_dir <span class="op">/</span> <span class="st">"person.csv"</span>)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>persons_23 <span class="op">=</span> (</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    persons_23.drop(<span class="st">"person_weight"</span>)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    .join(</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        person_weights_23.select(<span class="st">"person_id"</span>, <span class="st">"person_weight"</span>),</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        on<span class="op">=</span><span class="st">"person_id"</span>,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>        how<span class="op">=</span><span class="st">"left"</span>,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Load trip and day data for 2019</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>trips_19 <span class="op">=</span> pl.read_csv(</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    persons_19_dir <span class="op">/</span> <span class="st">"trip.tsv"</span>,</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    separator<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>,</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    ignore_errors<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>days_19 <span class="op">=</span> pl.read_csv(</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    persons_19_dir <span class="op">/</span> <span class="st">"day.tsv"</span>,</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    separator<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>,</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    ignore_errors<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Create day_id in 2019 data for joining weights</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>days_19 <span class="op">=</span> days_19.with_columns(</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    (</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"person_id"</span>).cast(pl.Utf8) <span class="op">+</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"day_num"</span>).cast(pl.Utf8).cast(pl.Utf8).<span class="bu">str</span>.pad_start(<span class="dv">2</span>, <span class="st">"0"</span>)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    ).cast(pl.Int64).alias(<span class="st">"day_id"</span>)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>trips_19 <span class="op">=</span> trips_19.with_columns(</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>    (</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"person_id"</span>).cast(pl.Utf8) <span class="op">+</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"day_num"</span>).cast(pl.Utf8).<span class="bu">str</span>.pad_start(<span class="dv">2</span>, <span class="st">"0"</span>)</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>    ).cast(pl.Int64).alias(<span class="st">"day_id"</span>)</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Load trip and day data for 2023</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>trips_23 <span class="op">=</span> pl.read_csv(persons_23_dir <span class="op">/</span> <span class="st">"trip.csv"</span>)</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>days_23 <span class="op">=</span> pl.read_csv(persons_23_dir <span class="op">/</span> <span class="st">"day.csv"</span>)</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and apply revised 2023 day weights</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>day_weights_23 <span class="op">=</span> pl.read_csv(weights_23_dir <span class="op">/</span> <span class="st">"day_weights.csv"</span>)</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>days_23 <span class="op">=</span> (</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>    days_23.drop(<span class="st">"day_weight"</span>)</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>    .join(</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>        day_weights_23.select(<span class="st">"day_id"</span>, <span class="st">"day_weight"</span>),</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>        on<span class="op">=</span><span class="st">"day_id"</span>,</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>        how<span class="op">=</span><span class="st">"left"</span>,</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Loaded 2019 trips: </span><span class="sc">{</span><span class="bu">len</span>(trips_19)<span class="sc">:,}</span><span class="ss">, days: </span><span class="sc">{</span><span class="bu">len</span>(days_19)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Loaded 2023 trips: </span><span class="sc">{</span><span class="bu">len</span>(trips_23)<span class="sc">:,}</span><span class="ss">, days: </span><span class="sc">{</span><span class="bu">len</span>(days_23)<span class="sc">:,}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation">Data Preparation</h2>
<section id="telework-frequency" class="level3">
<h3 class="anchored" data-anchor-id="telework-frequency">Telework frequency</h3>
<p>The 2- and 3-day telework/commute frequencies are binned in 2019 and will need to be binned in 2023 for consistency.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 33%">
<col style="width: 16%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>2019 Code</th>
<th>Label</th>
<th>2023 Code</th>
<th>Label</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>6-7 Days a week</td>
<td>1</td>
<td>6-7 Days a week</td>
</tr>
<tr class="even">
<td>2</td>
<td>5 Days a week</td>
<td>2</td>
<td>5 Days a week</td>
</tr>
<tr class="odd">
<td>3</td>
<td>4 Days a week</td>
<td>3</td>
<td>4 Days a week</td>
</tr>
<tr class="even">
<td>4</td>
<td>2-3 Days a week</td>
<td>4</td>
<td>3 Days a week</td>
</tr>
<tr class="odd">
<td>4</td>
<td>2-3 Days a week</td>
<td>5</td>
<td>2 Days a week</td>
</tr>
<tr class="even">
<td>5</td>
<td>1 Day a week</td>
<td>6</td>
<td>1 Day a week</td>
</tr>
<tr class="odd">
<td>6</td>
<td>1-3 days a month</td>
<td>7</td>
<td>1-3 days a month</td>
</tr>
<tr class="even">
<td>7</td>
<td>Less than monthly</td>
<td>8</td>
<td>Less than monthly</td>
</tr>
<tr class="odd">
<td>8</td>
<td>Never</td>
<td>996</td>
<td>Never</td>
</tr>
<tr class="even">
<td>995</td>
<td>Missing</td>
<td>995</td>
<td>Missing</td>
</tr>
</tbody>
</table>
<div id="downcode-telework" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Maps 2023 to 2019 codes for telework and commute freq</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>downcode_map <span class="op">=</span> {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>: <span class="dv">1</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>: <span class="dv">2</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>: <span class="dv">3</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span>: <span class="dv">4</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>: <span class="dv">4</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">6</span>: <span class="dv">5</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">7</span>: <span class="dv">6</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="dv">8</span>: <span class="dv">7</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">996</span>: <span class="dv">8</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="dv">995</span>: <span class="dv">995</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the downcoding to the 2023 data</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>persons_23 <span class="op">=</span> persons_23.with_columns(</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Copy original data</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    telework_freq_original<span class="op">=</span>pl.col(<span class="st">"telework_freq"</span>),</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    commute_freq_original<span class="op">=</span>pl.col(<span class="st">"commute_freq"</span>),</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply downcoding</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    telework_freq<span class="op">=</span>pl.col(<span class="st">"telework_freq"</span>).replace_strict(downcode_map),</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    commute_freq<span class="op">=</span>pl.col(<span class="st">"commute_freq"</span>).replace_strict(downcode_map),</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="impute-commute_freq" class="level3">
<h3 class="anchored" data-anchor-id="impute-commute_freq">Impute commute_freq</h3>
<p>There is no <code>commute_freq</code> data in the 2019 survey, we will need to approximate days/week from <code>hours_work</code> minus <code>telework_hours</code> (assuming 8 hours is a typical workday).</p>
<div id="impute-commute-freq" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hours vary greatly week to week</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>hours_work <span class="op">=</span> {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>: <span class="dv">55</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>: <span class="dv">44</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>: <span class="dv">36</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span>: <span class="dv">32</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>: <span class="dv">24</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">6</span>: <span class="dv">16</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">7</span>: <span class="dv">8</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="dv">8</span>: <span class="va">None</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">995</span>: <span class="va">None</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="dv">9998</span>: <span class="va">None</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>telework_hours <span class="op">=</span> {</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>: <span class="dv">48</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>: <span class="dv">40</span>,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>: <span class="dv">32</span>,</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span>: <span class="dv">16</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>: <span class="dv">8</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="dv">6</span>: <span class="dv">0</span>,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="dv">7</span>: <span class="dv">0</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="dv">8</span>: <span class="dv">0</span>,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="dv">996</span>: <span class="dv">0</span>,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="dv">995</span>: <span class="va">None</span>,</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>commute_freq_map <span class="op">=</span> {</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>: <span class="dv">8</span>,</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>: <span class="dv">5</span>,</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>: <span class="dv">4</span>,</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>: <span class="dv">4</span>,</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span>: <span class="dv">3</span>,</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>: <span class="dv">2</span>,</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    <span class="dv">6</span>: <span class="dv">1</span>,</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    <span class="dv">7</span>: <span class="dv">1</span>,</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    <span class="va">None</span>: <span class="dv">995</span>,</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Impute commute frequency for 2019 data</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>persons_19 <span class="op">=</span> persons_19.with_columns(</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    commute_freq_days<span class="op">=</span>(</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>        (</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">"hours_work"</span>).replace_strict(hours_work) <span class="op">-</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">"telework_freq"</span>).replace_strict(telework_hours)</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>        ).clip(lower_bound<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">//</span> <span class="dv">8</span>,</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Map commute days to the 2019 frequency codes</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>persons_19 <span class="op">=</span> persons_19.with_columns(</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    commute_freq<span class="op">=</span>pl.col(<span class="st">"commute_freq_days"</span>).replace_strict(commute_freq_map),</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename person_weight_rmove_only to person_weight</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>persons_19 <span class="op">=</span> persons_19.with_columns(</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    person_weight<span class="op">=</span>pl.col(<span class="st">"wt_sphone_wkday"</span>),</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>    job_type<span class="op">=</span>pl.when(pl.col(<span class="st">"job_type"</span>) <span class="op">==</span> <span class="op">-</span><span class="dv">9998</span>).then(<span class="dv">995</span>).otherwise(pl.col(<span class="st">"job_type"</span>)),</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribution of imputed commute freq</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.histogram(</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>    persons_19.<span class="bu">filter</span>(pl.col(<span class="st">"employment"</span>).is_in(EMPLOYED_CODES)),</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"commute_freq_days"</span>,</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Distribution of Imputed Commute Frequency (2019)"</span>,</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{<span class="st">"commute_freq"</span>: <span class="st">"Days per week commuting to workplace"</span>},</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>    nbins<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>    xaxis_title<span class="op">=</span><span class="st">"Days per week commuting to workplace"</span>,</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>    yaxis_title<span class="op">=</span><span class="st">"Number of persons"</span>,</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>    bargap<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>fig.show()</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>persons_19.group_by(<span class="st">"commute_freq"</span>).<span class="bu">len</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="data-filtering" class="level3">
<h3 class="anchored" data-anchor-id="data-filtering">Data filtering</h3>
<p>For <code>job_type==3</code> (WFH always), it is ambiguous to know if someone simply never commutes because they hardly work outside the home, or if they truly never commute. Therefore, for simplicity, we will narrow the analysis to only full-time employed persons.</p>
<div id="prepare-data" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Key columns to select</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>key_columns <span class="op">=</span> [</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"person_id"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"employment"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"telework_freq"</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"commute_freq"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"job_type"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"person_weight"</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the data</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>persons <span class="op">=</span> pl.concat([</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    persons_19.select(key_columns).with_columns(year<span class="op">=</span>pl.lit(<span class="dv">2019</span>, pl.Utf8)),</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    persons_23.select(key_columns).with_columns(year<span class="op">=</span>pl.lit(<span class="dv">2023</span>, pl.Utf8)),</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    rechunk<span class="op">=</span><span class="va">True</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare person table</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>persons_clean <span class="op">=</span> (</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drop rows with missing weights (incomplete days etc.)</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    persons</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"person_weight"</span>).is_not_null()</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (pl.col(<span class="st">"person_weight"</span>) <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Check person sum for reasonableness</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>person_weight_sum <span class="op">=</span> persons_clean.select(<span class="st">"person_weight"</span>).<span class="bu">sum</span>().item()</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Sum of person weights: </span><span class="sc">{</span>person_weight_sum<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter just employed persons</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>employed_persons <span class="op">=</span> persons_clean.<span class="bu">filter</span>(</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Must be employed AND not missing job type</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"employment"</span>).is_in(EMPLOYED_CODES) <span class="op">&amp;</span> (pl.col(<span class="st">"job_type"</span>) <span class="op">!=</span> <span class="dv">995</span>)</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>).select(</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"person_id"</span>,</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"employment"</span>,</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"telework_freq"</span>,</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"commute_freq"</span>,</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"job_type"</span>,</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"person_weight"</span>,</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">"year"</span>,</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Total employed persons: </span><span class="sc">{</span><span class="bu">len</span>(employed_persons)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Weighted employed persons: </span><span class="sc">{</span>employed_persons[<span class="st">'person_weight'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:.0f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Sum of person weights: 12891187.54
INFO:__main__:Total employed persons: 9,084
INFO:__main__:Weighted employed persons: 6152092</code></pre>
</div>
</div>
</section>
<section id="survey-code-reference" class="level3">
<h3 class="anchored" data-anchor-id="survey-code-reference">Survey Code Reference</h3>
<p><strong>Employment Codes:</strong> - 1: Employed full-time (paid) - 2: Employed part-time (paid) - 3: Self-employed - 5: Not employed and not looking for work - 6: Unemployed and looking for work - 7: Unpaid volunteer or intern - 8: Employed, but not currently working - 995: Missing Response</p>
<p><strong>Telework/Commute Frequency Codes:</strong> - 1: 6-7 days a week - 2: 5 days a week - 3: 4 days a week - 4: 3 days a week - 5: 2 days a week - 6: 1 day a week - 7: 1-3 days a month - 8: Less than monthly - 995: Missing Response - 996: Never</p>
<p><strong>Job Type Codes:</strong> - 1: One work location - 2: Multiple work locations - 3: WFH always - 4: Travel for work - 5: Hybrid - 995: Missing Response</p>
</section>
</section>
<section id="analysis" class="level2">
<h2 class="anchored" data-anchor-id="analysis">Analysis</h2>
<section id="classification-rules" class="level3">
<h3 class="anchored" data-anchor-id="classification-rules">Classification Rules</h3>
<section id="telework-commute-frequency-categorization" class="level4">
<h4 class="anchored" data-anchor-id="telework-commute-frequency-categorization">Telework / Commute Frequency Categorization</h4>
<p>Simple definition of telework and commute frequency categorization.<br>
Mirrored for commute freq using commute_freq instead of telework_freq</p>
<table class="caption-top table">
<colgroup>
<col style="width: 19%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th>Days per Week Category</th>
<th>Telework Frequency Rules</th>
<th>Commute Frequency Rules</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>5+ days per week</td>
<td><code>telework_freq</code> in [1, 2] OR <code>job_type</code> == 3</td>
<td><code>commute_freq</code> in [1, 2] AND <code>job_type</code> != 3</td>
</tr>
<tr class="even">
<td>4 days per week</td>
<td><code>telework_freq</code> == 3</td>
<td><code>commute_freq</code> == 3</td>
</tr>
<tr class="odd">
<td>2-3 days per week</td>
<td><code>telework_freq</code> == 4</td>
<td><code>commute_freq</code> == 4</td>
</tr>
<tr class="even">
<td>1 day per week</td>
<td><code>telework_freq</code> == 5</td>
<td><code>commute_freq</code> == 5</td>
</tr>
<tr class="odd">
<td>Less than once a week</td>
<td><code>telework_freq</code> in [6, 7]</td>
<td><code>commute_freq</code> in [6, 7]</td>
</tr>
<tr class="even">
<td>Never</td>
<td><code>telework_freq</code> == 8</td>
<td><code>commute_freq</code> == 8</td>
</tr>
<tr class="odd">
<td>Missing Response</td>
<td><code>telework_freq</code> == 995 AND <code>job_type</code> != 3</td>
<td><code>commute_freq</code> == 995 AND <code>job_type</code> != 3</td>
</tr>
</tbody>
</table>
</section>
<section id="telework-ratio-categorization" class="level4">
<h4 class="anchored" data-anchor-id="telework-ratio-categorization">Telework Ratio Categorization</h4>
<p>While more broad, this categorization accounts for part-time or over-time work scenarios (&lt;5 and &gt;5 days/week).</p>
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 73%">
</colgroup>
<thead>
<tr class="header">
<th>Telework Ratio Category</th>
<th>Rules</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Never, or less than once a week</td>
<td><code>telework_freq</code> in [995, 6, 7, 8] AND <code>job_type</code> != 3</td>
</tr>
<tr class="even">
<td>Less than 40% of the time</td>
<td><code>telework_freq</code> &gt; <code>commute_freq</code> + 1 AND both &lt; 7 (weekly+) AND both != 995 AND <code>job_type</code> != 3</td>
</tr>
<tr class="odd">
<td>About half (40-60%)</td>
<td>|<code>telework_freq</code> - <code>commute_freq</code>|  1 AND both &lt; 7 (weekly+) AND both != 995 AND <code>job_type</code> != 3</td>
</tr>
<tr class="even">
<td>More than 60% of the time</td>
<td><code>commute_freq</code> &gt; <code>telework_freq</code> + 1 AND both &lt; 7 (weekly+) AND both != 995 AND <code>job_type</code> != 3</td>
</tr>
<tr class="odd">
<td>Always</td>
<td>(<code>telework_freq</code> in [1, 2] AND <code>commute_freq</code> == 8) OR <code>job_type</code> == 3</td>
</tr>
</tbody>
</table>
</section>
<section id="categorization-function" class="level4">
<h4 class="anchored" data-anchor-id="categorization-function">Categorization Function</h4>
<div id="categorization-function" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> categorize_frequency(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    df: pl.DataFrame,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    prefix: <span class="bu">str</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    conditions: <span class="bu">dict</span>[<span class="bu">str</span>, pl.Expr],</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> pl.DataFrame:</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Categorize frequency data using one-hot encoding with validation.</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">        df: Input dataframe</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">        prefix: Prefix for output columns (e.g., 'telework_freq' or 'commute_freq')</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">        conditions: Dictionary of labeled conditions and expressions to categorize by</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">        DataFrame with unpivoted frequency categories</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create one-hot encoded columns</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    one_hot_exprs <span class="op">=</span> []</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    one_hot_cols <span class="op">=</span> []</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> category <span class="kw">in</span> conditions.keys():</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        col_name <span class="op">=</span> category.name.lower()</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        one_hot_cols.append(col_name)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Build condition based on category</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>        condition <span class="op">=</span> conditions.get(category, <span class="va">None</span>)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> condition <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Unknown category: </span><span class="sc">{</span>category<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        one_hot_exprs.append(</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>            condition.cast(pl.Int8).alias(col_name)</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add one-hot columns</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    df_one_hot <span class="op">=</span> df.with_columns(one_hot_exprs)</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Verify mutual exclusivity</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    count_col <span class="op">=</span> <span class="st">"category_count"</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    df_one_hot <span class="op">=</span> df_one_hot.with_columns(</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>        pl.sum_horizontal(one_hot_cols).alias(count_col)</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check for violations</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    violations <span class="op">=</span> df_one_hot.<span class="bu">filter</span>(pl.col(count_col) <span class="op">!=</span> <span class="dv">1</span>)</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(violations) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>        chk_cols <span class="op">=</span> [<span class="st">"person_id"</span>, <span class="st">"telework_freq"</span>, <span class="st">"commute_freq"</span>, <span class="st">"job_type"</span>, count_col] <span class="op">+</span> one_hot_cols</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If _freq_cat cols are in the table</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> c <span class="kw">in</span> [<span class="st">"telework_freq_cat"</span>, <span class="st">"commute_freq_cat"</span>]:</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> c <span class="kw">in</span> df_one_hot.columns:</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>                chk_cols.append(c)</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>        logger.warning(</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(violations)<span class="sc">}</span><span class="ss"> persons with non-exclusive </span><span class="sc">{</span>prefix<span class="sc">}</span><span class="ss"> categories!"</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>prefix<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss"> Category Violations:"</span>)</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(violations.select(chk_cols).head(<span class="dv">10</span>))</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Found persons with non-exclusive </span><span class="sc">{</span>prefix<span class="sc">}</span><span class="ss"> categories!"</span>)</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="ss">f" All persons have exactly 1 </span><span class="sc">{</span>prefix<span class="sc">}</span><span class="ss"> category"</span>)</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Unpivot to single column</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    df_unpivot <span class="op">=</span> (</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>        df_one_hot</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>        .unpivot(</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>            index<span class="op">=</span><span class="st">"person_id"</span>,</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>            on<span class="op">=</span>one_hot_cols,</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>            variable_name<span class="op">=</span><span class="st">"category"</span>,</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Keep only rows where this category is true (value = 1)</span></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">filter</span>(pl.col(<span class="st">"value"</span>) <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Map short names to enum values</span></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>        .with_columns(</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">"category"</span>)</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>                .<span class="bu">str</span>.replace(<span class="ss">f"</span><span class="sc">{</span>prefix<span class="sc">}</span><span class="ss">_"</span>, <span class="st">""</span>)</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>                .<span class="bu">str</span>.to_uppercase()</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>                .replace({cat.name: cat.value <span class="cf">for</span> cat <span class="kw">in</span> conditions.keys()})</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>                .cast(pl.Int8)</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>                .alias(<span class="ss">f"</span><span class="sc">{</span>prefix<span class="sc">}</span><span class="ss">_cat"</span>)</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add descriptive labels</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>        .with_columns(</span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="ss">f"</span><span class="sc">{</span>prefix<span class="sc">}</span><span class="ss">_cat"</span>).cast(pl.Utf8)</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>            .replace({cat.value: cat.label <span class="cf">for</span> cat <span class="kw">in</span> conditions.keys()})</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>            .alias(<span class="ss">f"</span><span class="sc">{</span>prefix<span class="sc">}</span><span class="ss">_str"</span>)</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>        .drop(<span class="st">"category"</span>, <span class="st">"value"</span>)</span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Join back to employed persons</span></span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>    join_cols <span class="op">=</span> [</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>prefix<span class="sc">}</span><span class="ss">_str"</span>,</span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"</span><span class="sc">{</span>prefix<span class="sc">}</span><span class="ss">_cat"</span></span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>     ]</span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> join_cols:</span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> df.drop(col)</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>    df_joined <span class="op">=</span> df.join(</span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>        df_unpivot.select([<span class="st">"person_id"</span>] <span class="op">+</span> join_cols),</span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>        on<span class="op">=</span><span class="st">"person_id"</span>,</span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>        how<span class="op">=</span><span class="st">"left"</span>,</span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_joined</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
</section>
<section id="temporal-validation" class="level3">
<h3 class="anchored" data-anchor-id="temporal-validation">Temporal Validation</h3>
<p>Check for impossible combinations where telework + commute frequency exceeds 7 days/week.</p>
<div id="temporal-violations" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for temporal violations:</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Bad telework/commute freq combos where sum &lt; 7 days/week</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ignoring the less than weekly and never categories</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>bad_freqs <span class="op">=</span> employed_persons.<span class="bu">filter</span>(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    (pl.col(<span class="st">"telework_freq"</span>) <span class="op">+</span> pl.col(<span class="st">"commute_freq"</span>) <span class="op">&lt;</span> <span class="dv">7</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> (pl.col(<span class="st">"telework_freq"</span>) <span class="op">&lt;</span> <span class="dv">8</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> (pl.col(<span class="st">"commute_freq"</span>) <span class="op">&lt;</span> <span class="dv">8</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>bad_freqs_summary <span class="op">=</span> pl.DataFrame(</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Count"</span>: [<span class="bu">len</span>(bad_freqs)],</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Weighted count"</span>: [<span class="bu">round</span>(bad_freqs[<span class="st">"person_weight"</span>].<span class="bu">sum</span>(), <span class="dv">2</span>)],</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"% (wtd)"</span>: [</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>            <span class="bu">round</span>(</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>                <span class="dv">100</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>                <span class="op">*</span> bad_freqs[<span class="st">"person_weight"</span>].<span class="bu">sum</span>()</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>                <span class="op">/</span> employed_persons[<span class="st">"person_weight"</span>].<span class="bu">sum</span>(),</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>                <span class="dv">2</span>,</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        ],<span class="st">"% (unwtd)"</span>: [</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>            <span class="bu">round</span>(<span class="dv">100</span> <span class="op">*</span> bad_freqs.shape[<span class="dv">0</span>] <span class="op">/</span> employed_persons.shape[<span class="dv">0</span>], <span class="dv">2</span>),</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Temporal Violations Summary:"</span>)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(bad_freqs_summary)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Temporal Violations Summary:
shape: (1, 4)

 Count  Weighted count  % (wtd)  % (unwtd) 
 ---    ---             ---      ---       
 i64    f64             f64      f64       

 188    113402.38       1.84     2.07      
</code></pre>
</div>
</div>
<p>So about {python} f{bad_freqs_summary[% (wtd)].item():.2f}% ` of the total weighted count of employed persons have impossible telework/commute frequency combinations. This is a relatively small proportion, but noticeable. The importance of this is that the following telework/commute frequency categories treat these as independent, which means these persons may be double counted in the analysis.</p>
</section>
<section id="categorize-telework-frequency" class="level3">
<h3 class="anchored" data-anchor-id="categorize-telework-frequency">Categorize Telework Frequency</h3>
<div id="categorize-telework" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>telework_conditions <span class="op">=</span> {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Works 5+ or always WFH</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    FrequencyCategory.FIVE_PLUS: (</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"telework_freq"</span>).is_in([<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> (pl.col(<span class="st">"job_type"</span>) <span class="op">==</span> <span class="dv">3</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Works 4 days</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    FrequencyCategory.FOUR: (pl.col(<span class="st">"telework_freq"</span>) <span class="op">==</span> <span class="dv">3</span>),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Works 2-3 days</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    FrequencyCategory.TWO_THREE: (pl.col(<span class="st">"telework_freq"</span>) <span class="op">==</span> <span class="dv">4</span>),</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Works 1 day</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    FrequencyCategory.ONE: (pl.col(<span class="st">"telework_freq"</span>) <span class="op">==</span> <span class="dv">5</span>),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Less than weekly</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    FrequencyCategory.LESS_THAN_WEEKLY: (pl.col(<span class="st">"telework_freq"</span>).is_in([<span class="dv">6</span>, <span class="dv">7</span>])),</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Never</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    FrequencyCategory.NEVER: (pl.col(<span class="st">"telework_freq"</span>) <span class="op">==</span> <span class="dv">8</span>),</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Missing</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    FrequencyCategory.MISSING: (</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        (pl.col(<span class="st">"telework_freq"</span>) <span class="op">==</span> <span class="dv">995</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (pl.col(<span class="st">"job_type"</span>) <span class="op">!=</span> <span class="dv">3</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorize telework frequency</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>employed_persons <span class="op">=</span> categorize_frequency(</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    employed_persons,</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    prefix<span class="op">=</span><span class="st">"telework_freq"</span>,</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    conditions<span class="op">=</span>telework_conditions,</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__: All persons have exactly 1 telework_freq category</code></pre>
</div>
</div>
</section>
<section id="categorize-commute-frequency" class="level3">
<h3 class="anchored" data-anchor-id="categorize-commute-frequency">Categorize Commute Frequency</h3>
<div id="categorize-commute" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>commute_conditions <span class="op">=</span> {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Works 5+ days</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    FrequencyCategory.FIVE_PLUS: (</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"commute_freq"</span>).is_in([<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (pl.col(<span class="st">"job_type"</span>) <span class="op">!=</span> <span class="dv">3</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Works 4 days</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    FrequencyCategory.FOUR: (pl.col(<span class="st">"commute_freq"</span>) <span class="op">==</span> <span class="dv">3</span>),</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Works 2-3 days</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    FrequencyCategory.TWO_THREE: (pl.col(<span class="st">"commute_freq"</span>) <span class="op">==</span> <span class="dv">4</span>),</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Works 1 day</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    FrequencyCategory.ONE: (pl.col(<span class="st">"commute_freq"</span>) <span class="op">==</span> <span class="dv">5</span>),</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Less than weekly</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    FrequencyCategory.LESS_THAN_WEEKLY: (pl.col(<span class="st">"commute_freq"</span>).is_in([<span class="dv">6</span>, <span class="dv">7</span>])),</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Never</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    FrequencyCategory.NEVER: (</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># WFH Always</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>        (pl.col(<span class="st">"job_type"</span>) <span class="op">==</span> <span class="dv">3</span>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Never commutes</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> (pl.col(<span class="st">"commute_freq"</span>) <span class="op">==</span> <span class="dv">8</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Missing</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    FrequencyCategory.MISSING: (</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>        (pl.col(<span class="st">"commute_freq"</span>) <span class="op">==</span> <span class="dv">995</span>) <span class="op">&amp;</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>        (pl.col(<span class="st">"job_type"</span>) <span class="op">!=</span> <span class="dv">3</span>)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorize commute frequency</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>employed_persons <span class="op">=</span> categorize_frequency(</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    employed_persons,</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    prefix<span class="op">=</span><span class="st">"commute_freq"</span>,</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    conditions<span class="op">=</span>commute_conditions,</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__: All persons have exactly 1 commute_freq category</code></pre>
</div>
</div>
</section>
<section id="calculate-telework-ratio" class="level3">
<h3 class="anchored" data-anchor-id="calculate-telework-ratio">Calculate Telework Ratio</h3>
<div id="telework-ratio" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>ratio_conditions <span class="op">=</span> {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># MISSING: Catch missing values first</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    TeleworkRatio.MISSING: (</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>        (pl.col(<span class="st">"telework_freq_cat"</span>) <span class="op">==</span> FrequencyCategory.MISSING.value)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> (pl.col(<span class="st">"commute_freq_cat"</span>) <span class="op">==</span> FrequencyCategory.MISSING.value)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ALWAYS: job_type==3 OR high telework with no/rare commute</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    TeleworkRatio.ALWAYS: (</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        (pl.col(<span class="st">"telework_freq_cat"</span>).is_in([</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>            FrequencyCategory.FIVE_PLUS.value,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>            FrequencyCategory.FOUR.value</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> pl.col(<span class="st">"commute_freq_cat"</span>).is_in([</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>            FrequencyCategory.NEVER.value,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>            FrequencyCategory.LESS_THAN_WEEKLY.value,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>        ]))</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> (pl.col(<span class="st">"job_type"</span>) <span class="op">==</span> <span class="dv">3</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># NEVER: telework is never/rare (not based on commute frequency)</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    TeleworkRatio.NEVER: (</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"telework_freq_cat"</span>).is_in([</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>            FrequencyCategory.NEVER.value,</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>            FrequencyCategory.LESS_THAN_WEEKLY.value,</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (pl.col(<span class="st">"job_type"</span>) <span class="op">!=</span> <span class="dv">3</span>)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (pl.col(<span class="st">"telework_freq_cat"</span>) <span class="op">!=</span> FrequencyCategory.MISSING.value)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (pl.col(<span class="st">"commute_freq_cat"</span>) <span class="op">!=</span> FrequencyCategory.MISSING.value)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># LESS_THAN_40: commute significantly more than telework</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    TeleworkRatio.LESS_THAN_40: (</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>        (pl.col(<span class="st">"commute_freq_cat"</span>) <span class="op">&gt;</span> pl.col(<span class="st">"telework_freq_cat"</span>) <span class="op">+</span> <span class="dv">1</span>) <span class="co"># +1 to get 40% threshold</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (pl.col(<span class="st">"telework_freq_cat"</span>) <span class="op">!=</span> FrequencyCategory.MISSING.value)</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (pl.col(<span class="st">"commute_freq_cat"</span>) <span class="op">!=</span> FrequencyCategory.MISSING.value)</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (pl.col(<span class="st">"job_type"</span>) <span class="op">!=</span> <span class="dv">3</span>)</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Exclude never/rare telework (handled by NEVER category)</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> <span class="op">~</span>pl.col(<span class="st">"telework_freq_cat"</span>).is_in([</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>            FrequencyCategory.NEVER.value,</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>            FrequencyCategory.LESS_THAN_WEEKLY.value,</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Exclude high telework with no/rare commute (handled by ALWAYS)</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> <span class="op">~</span>(</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">"telework_freq_cat"</span>).is_in([</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>                FrequencyCategory.FIVE_PLUS.value,</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>                FrequencyCategory.FOUR.value</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>            <span class="op">&amp;</span> pl.col(<span class="st">"commute_freq_cat"</span>).is_in([</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>                FrequencyCategory.NEVER.value,</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>                FrequencyCategory.LESS_THAN_WEEKLY.value,</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ABOUT_HALF: telework and commute roughly equal</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>    TeleworkRatio.ABOUT_HALF: (</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>        ((pl.col(<span class="st">"telework_freq_cat"</span>) <span class="op">-</span> pl.col(<span class="st">"commute_freq_cat"</span>)).<span class="bu">abs</span>() <span class="op">&lt;=</span> <span class="dv">1</span>) <span class="co"># 1 to get 40-60% threshold</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (pl.col(<span class="st">"telework_freq_cat"</span>) <span class="op">!=</span> FrequencyCategory.MISSING.value)</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (pl.col(<span class="st">"commute_freq_cat"</span>) <span class="op">!=</span> FrequencyCategory.MISSING.value)</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (pl.col(<span class="st">"job_type"</span>) <span class="op">!=</span> <span class="dv">3</span>)</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Exclude never/rare telework (handled by NEVER category)</span></span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> <span class="op">~</span>pl.col(<span class="st">"telework_freq_cat"</span>).is_in([</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>            FrequencyCategory.NEVER.value,</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>            FrequencyCategory.LESS_THAN_WEEKLY.value,</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Exclude high telework with no/rare commute (handled by ALWAYS)</span></span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> <span class="op">~</span>(</span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">"telework_freq_cat"</span>).is_in([</span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>                FrequencyCategory.FIVE_PLUS.value,</span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a>                FrequencyCategory.FOUR.value</span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>            <span class="op">&amp;</span> pl.col(<span class="st">"commute_freq_cat"</span>).is_in([</span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>                FrequencyCategory.NEVER.value,</span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>                FrequencyCategory.LESS_THAN_WEEKLY.value,</span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># MORE_THAN_60: telework significantly more than commute</span></span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a>    TeleworkRatio.MORE_THAN_60: (</span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a>        (pl.col(<span class="st">"telework_freq_cat"</span>) <span class="op">&gt;</span> pl.col(<span class="st">"commute_freq_cat"</span>) <span class="op">+</span> <span class="dv">1</span>) <span class="co"># +1 to get 60% threshold</span></span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (pl.col(<span class="st">"telework_freq_cat"</span>) <span class="op">!=</span> FrequencyCategory.MISSING.value)</span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (pl.col(<span class="st">"commute_freq_cat"</span>) <span class="op">!=</span> FrequencyCategory.MISSING.value)</span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (pl.col(<span class="st">"job_type"</span>) <span class="op">!=</span> <span class="dv">3</span>)</span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Exclude never/rare telework (handled by NEVER category)</span></span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> <span class="op">~</span>pl.col(<span class="st">"telework_freq_cat"</span>).is_in([</span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a>            FrequencyCategory.NEVER.value,</span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a>            FrequencyCategory.LESS_THAN_WEEKLY.value,</span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Exclude high telework with no/rare commute (handled by ALWAYS)</span></span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> <span class="op">~</span>(</span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a>            pl.col(<span class="st">"telework_freq_cat"</span>).is_in([</span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a>                FrequencyCategory.FIVE_PLUS.value,</span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a>                FrequencyCategory.FOUR.value</span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a>            <span class="op">&amp;</span> pl.col(<span class="st">"commute_freq_cat"</span>).is_in([</span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a>                FrequencyCategory.NEVER.value,</span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a>                FrequencyCategory.LESS_THAN_WEEKLY.value,</span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorize telework ratio</span></span>
<span id="cb16-101"><a href="#cb16-101" aria-hidden="true" tabindex="-1"></a>employed_persons <span class="op">=</span> employed_persons_ratio <span class="op">=</span> categorize_frequency(</span>
<span id="cb16-102"><a href="#cb16-102" aria-hidden="true" tabindex="-1"></a>    employed_persons,</span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a>    prefix<span class="op">=</span><span class="st">"telework_ratio"</span>,</span>
<span id="cb16-104"><a href="#cb16-104" aria-hidden="true" tabindex="-1"></a>    conditions<span class="op">=</span>ratio_conditions,</span>
<span id="cb16-105"><a href="#cb16-105" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__: All persons have exactly 1 telework_ratio category</code></pre>
</div>
</div>
</section>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<section id="telework-frequency-distribution" class="level3">
<h3 class="anchored" data-anchor-id="telework-frequency-distribution">Telework Frequency Distribution</h3>
<div id="telework-freq-summary" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>telework_freq_summary <span class="op">=</span> (</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    employed_persons.group_by(<span class="st">"year"</span>, <span class="st">"telework_freq_str"</span>, <span class="st">"telework_freq_cat"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        pl.<span class="bu">len</span>().alias(<span class="st">"count"</span>),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"person_weight"</span>).<span class="bu">sum</span>().alias(<span class="st">"weighted_count"</span>),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        (</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>            <span class="dv">100</span> <span class="op">*</span> pl.col(<span class="st">"weighted_count"</span>) <span class="op">/</span> pl.col(<span class="st">"weighted_count"</span>).<span class="bu">sum</span>().over(<span class="st">"year"</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        ).alias(<span class="st">"% (wtd)"</span>),</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">100</span> <span class="op">*</span> pl.col(<span class="st">"count"</span>) <span class="op">/</span> pl.col(<span class="st">"count"</span>).<span class="bu">sum</span>().over(<span class="st">"year"</span>)).alias(<span class="st">"% (unwtd)"</span>),</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"weighted_count"</span>).<span class="bu">round</span>(<span class="dv">2</span>),</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"% (wtd)"</span>).<span class="bu">round</span>(<span class="dv">2</span>),</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"% (unwtd)"</span>).<span class="bu">round</span>(<span class="dv">2</span>),</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"telework_freq_cat"</span>)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Telework Frequency Summary - 2019:"</span>)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(telework_freq_summary.<span class="bu">filter</span>(pl.col(<span class="st">"year"</span>) <span class="op">==</span> <span class="st">"2019"</span>).drop(<span class="st">"telework_freq_cat"</span>))</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Telework Frequency Summary - 2023:"</span>)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(telework_freq_summary.<span class="bu">filter</span>(pl.col(<span class="st">"year"</span>) <span class="op">==</span> <span class="st">"2023"</span>).drop(<span class="st">"telework_freq_cat"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Telework Frequency Summary - 2019:
shape: (7, 6)

 year  telework_freq_str      count  weighted_count  % (wtd)  % (unwtd) 
 ---   ---                    ---    ---             ---      ---       
 str   str                    u32    f64             f64      f64       

 2019  Missing Response       34     83868.97        2.62     1.09      
 2019  Almost never           879    1.1691e6        36.56    28.08     
 2019  Less than once a week  1260   898789.78       28.1     40.26     
 2019  1 day per week         402    286405.59       8.96     12.84     
 2019  2-3 days per week      213    302433.05       9.46     6.81      
 2019  4 days per week        44     34929.63        1.09     1.41      
 2019  5+ days per week       298    422532.66       13.21    9.52      

Telework Frequency Summary - 2023:
shape: (7, 6)

 year  telework_freq_str      count  weighted_count  % (wtd)  % (unwtd) 
 ---   ---                    ---    ---             ---      ---       
 str   str                    u32    f64             f64      f64       

 2023  Missing Response       2      4123.52         0.14     0.03      
 2023  Almost never           1259   859103.88       29.08    21.15     
 2023  Less than once a week  703    377696.65       12.79    11.81     
 2023  1 day per week         461    198417.69       6.72     7.74      
 2023  2-3 days per week      1626   668746.07       22.64    27.31     
 2023  4 days per week        431    184486.89       6.25     7.24      
 2023  5+ days per week       1472   661415.87       22.39    24.72     
</code></pre>
</div>
</div>
</section>
<section id="commute-frequency-distribution" class="level3">
<h3 class="anchored" data-anchor-id="commute-frequency-distribution">Commute Frequency Distribution</h3>
<div id="commute-freq-summary" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>commute_freq_summary <span class="op">=</span> (</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    employed_persons.group_by(<span class="st">"year"</span>, <span class="st">"commute_freq_str"</span>, <span class="st">"commute_freq_cat"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>        pl.<span class="bu">len</span>().alias(<span class="st">"count"</span>),</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"person_weight"</span>).<span class="bu">sum</span>().alias(<span class="st">"weighted_count"</span>),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        (</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>            <span class="dv">100</span> <span class="op">*</span> pl.col(<span class="st">"weighted_count"</span>) <span class="op">/</span> pl.col(<span class="st">"weighted_count"</span>).<span class="bu">sum</span>().over(<span class="st">"year"</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>        ).alias(<span class="st">"% (wtd)"</span>),</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">100</span> <span class="op">*</span> pl.col(<span class="st">"count"</span>) <span class="op">/</span> pl.col(<span class="st">"count"</span>).<span class="bu">sum</span>().over(<span class="st">"year"</span>)).alias(<span class="st">"% (unwtd)"</span>),</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"weighted_count"</span>).<span class="bu">round</span>(<span class="dv">2</span>),</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"% (wtd)"</span>).<span class="bu">round</span>(<span class="dv">2</span>),</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"% (unwtd)"</span>).<span class="bu">round</span>(<span class="dv">2</span>),</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"commute_freq_cat"</span>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Commute Frequency Summary - 2019:"</span>)</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(commute_freq_summary.<span class="bu">filter</span>(pl.col(<span class="st">"year"</span>) <span class="op">==</span> <span class="st">"2019"</span>).drop(<span class="st">"commute_freq_cat"</span>))</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Commute Frequency Summary - 2023:"</span>)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(commute_freq_summary.<span class="bu">filter</span>(pl.col(<span class="st">"year"</span>) <span class="op">==</span> <span class="st">"2023"</span>).drop(<span class="st">"commute_freq_cat"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Commute Frequency Summary - 2019:
shape: (6, 6)

 year  commute_freq_str   count  weighted_count  % (wtd)  % (unwtd) 
 ---   ---                ---    ---             ---      ---       
 str   str                u32    f64             f64      f64       

 2019  Missing Response   51     121896.02       3.81     1.63      
 2019  Almost never       280    381958.95       11.94    8.95      
 2019  1 day per week     66     85451.38        2.67     2.11      
 2019  2-3 days per week  217    276474.37       8.64     6.93      
 2019  4 days per week    595    547029.85       17.1     19.01     
 2019  5+ days per week   1921   1.7853e6        55.82    61.37     

Commute Frequency Summary - 2023:
shape: (7, 6)

 year  commute_freq_str       count  weighted_count  % (wtd)  % (unwtd) 
 ---   ---                    ---    ---             ---      ---       
 str   str                    u32    f64             f64      f64       

 2023  Missing Response       49     54134.88        1.83     0.82      
 2023  Almost never           994    450879.64       15.26    16.69     
 2023  Less than once a week  410    192583.74       6.52     6.89      
 2023  1 day per week         390    158292.44       5.36     6.55      
 2023  2-3 days per week      1676   693801.24       23.49    28.15     
 2023  4 days per week        604    288057.35       9.75     10.14     
 2023  5+ days per week       1831   1.1162e6        37.79    30.75     
</code></pre>
</div>
</div>
</section>
<section id="combined-telework-and-commute-frequency-distribution" class="level3">
<h3 class="anchored" data-anchor-id="combined-telework-and-commute-frequency-distribution">Combined Telework and Commute Frequency Distribution</h3>
<div id="cell-fig-freq-shift-bar-plot" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define consistent colors for years</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>year_colors <span class="op">=</span> {</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2019"</span>: <span class="st">"#1f77b4"</span>,  <span class="co"># Blue</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2023"</span>: <span class="st">"#ff7f0e"</span>   <span class="co"># Orange</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out missing responses</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>telework_plot_data <span class="op">=</span> telework_freq_summary.<span class="bu">filter</span>(</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"telework_freq_str"</span>) <span class="op">!=</span> <span class="st">"Missing Response"</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>commute_plot_data <span class="op">=</span> commute_freq_summary.<span class="bu">filter</span>(</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"commute_freq_str"</span>) <span class="op">!=</span> <span class="st">"Missing Response"</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create subplots</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> make_subplots(</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    rows<span class="op">=</span><span class="dv">1</span>, cols<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    subplot_titles<span class="op">=</span>(<span class="st">"Telework Frequency"</span>, <span class="st">"Commute Frequency"</span>)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Add telework bars</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> [<span class="st">"2019"</span>, <span class="st">"2023"</span>]:</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> telework_plot_data.<span class="bu">filter</span>(pl.col(<span class="st">"year"</span>) <span class="op">==</span> year).sort(<span class="st">"telework_freq_cat"</span>)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>        go.Bar(</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span>data[<span class="st">"telework_freq_str"</span>].to_list(),</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span>data[<span class="st">"% (wtd)"</span>].to_list(),</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span>year,</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>            marker_color<span class="op">=</span>year_colors[year],</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>        row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Add commute bars</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> [<span class="st">"2019"</span>, <span class="st">"2023"</span>]:</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> commute_plot_data.<span class="bu">filter</span>(pl.col(<span class="st">"year"</span>) <span class="op">==</span> year).sort(<span class="st">"commute_freq_cat"</span>)</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>        go.Bar(</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span>data[<span class="st">"commute_freq_str"</span>].to_list(),</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span>data[<span class="st">"% (wtd)"</span>].to_list(),</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span>year,</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>            marker_color<span class="op">=</span>year_colors[year],</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>            showlegend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>        row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">2</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"% (Weighted)"</span>)</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(tickangle<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>fig.update_layout(height<span class="op">=</span><span class="dv">500</span>, barmode<span class="op">=</span><span class="st">"group"</span>, title_text<span class="op">=</span><span class="st">"Work Pattern Comparison: 2019 vs 2023"</span>)</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="fig-freq-shift-bar-plot" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-freq-shift-bar-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>            <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG"></script><script type="text/javascript">if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}</script>                <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script charset="utf-8" src="https://cdn.plot.ly/plotly-3.2.0.min.js" integrity="sha256-iZ2u/oU2wf/vDbl/ChcX93WgbBRSBvUO6N413hDz7xM=" crossorigin="anonymous"></script>                <div id="b4560921-cdb5-4a3b-9f65-52a77dec6945" class="plotly-graph-div" style="height:500px; width:100%;"></div>            <script type="text/javascript">                window.PLOTLYENV=window.PLOTLYENV || {};                                if (document.getElementById("b4560921-cdb5-4a3b-9f65-52a77dec6945")) {                    Plotly.newPlot(                        "b4560921-cdb5-4a3b-9f65-52a77dec6945",                        [{"marker":{"color":"#1f77b4"},"name":"2019","x":["Almost never","Less than once a week","1 day per week","2-3 days per week","4 days per week","5+ days per week"],"y":[36.56,28.1,8.96,9.46,1.09,13.21],"type":"bar","xaxis":"x","yaxis":"y"},{"marker":{"color":"#ff7f0e"},"name":"2023","x":["Almost never","Less than once a week","1 day per week","2-3 days per week","4 days per week","5+ days per week"],"y":[29.08,12.79,6.72,22.64,6.25,22.39],"type":"bar","xaxis":"x","yaxis":"y"},{"marker":{"color":"#1f77b4"},"name":"2019","showlegend":false,"x":["Almost never","1 day per week","2-3 days per week","4 days per week","5+ days per week"],"y":[11.94,2.67,8.64,17.1,55.82],"type":"bar","xaxis":"x2","yaxis":"y2"},{"marker":{"color":"#ff7f0e"},"name":"2023","showlegend":false,"x":["Almost never","Less than once a week","1 day per week","2-3 days per week","4 days per week","5+ days per week"],"y":[15.26,6.52,5.36,23.49,9.75,37.79],"type":"bar","xaxis":"x2","yaxis":"y2"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermap":[{"type":"scattermap","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"anchor":"y","domain":[0.0,0.45],"tickangle":45},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"% (Weighted)"}},"xaxis2":{"anchor":"y2","domain":[0.55,1.0],"tickangle":45},"yaxis2":{"anchor":"x2","domain":[0.0,1.0],"title":{"text":"% (Weighted)"}},"annotations":[{"font":{"size":16},"showarrow":false,"text":"Telework Frequency","x":0.225,"xanchor":"center","xref":"paper","y":1.0,"yanchor":"bottom","yref":"paper"},{"font":{"size":16},"showarrow":false,"text":"Commute Frequency","x":0.775,"xanchor":"center","xref":"paper","y":1.0,"yanchor":"bottom","yref":"paper"}],"title":{"text":"Work Pattern Comparison: 2019 vs 2023"},"height":500,"barmode":"group"},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('b4560921-cdb5-4a3b-9f65-52a77dec6945');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };            </script>        </div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-freq-shift-bar-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Telework and Commute Frequency Distribution: 2019 vs 2023
</figcaption>
</figure>
</div>
</div>
<div id="cell-fig-freq-shift-point-plot" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create simple shift plots</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create color mapping for consistent colors across both plots</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create graduated color scale</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> px.colors.sample_colorscale(</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    px.colors.sequential.Bluered,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">1.0</span>]</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>color_map <span class="op">=</span> {</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    FrequencyCategory.FIVE_PLUS.label: colors[<span class="dv">0</span>],</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    FrequencyCategory.FOUR.label: colors[<span class="dv">1</span>],</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    FrequencyCategory.TWO_THREE.label: colors[<span class="dv">2</span>],</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    FrequencyCategory.ONE.label: colors[<span class="dv">3</span>],</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    FrequencyCategory.LESS_THAN_WEEKLY.label: colors[<span class="dv">4</span>],</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    FrequencyCategory.NEVER.label: colors[<span class="dv">5</span>],</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> make_subplots(rows<span class="op">=</span><span class="dv">1</span>, cols<span class="op">=</span><span class="dv">2</span>, subplot_titles<span class="op">=</span>(<span class="st">"Telework Frequency"</span>, <span class="st">"Commute Frequency"</span>))</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Telework data</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>telework_pivot <span class="op">=</span> (</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    telework_freq_summary</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"telework_freq_str"</span>) <span class="op">!=</span> <span class="st">"Missing Response"</span>)</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    .pivot(index<span class="op">=</span>[<span class="st">"telework_freq_str"</span>, <span class="st">"telework_freq_cat"</span>], on<span class="op">=</span><span class="st">"year"</span>, values<span class="op">=</span><span class="st">"% (wtd)"</span>)</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"telework_freq_cat"</span>, descending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> telework_pivot.iter_rows(named<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>        go.Scatter(</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span>[<span class="dv">2019</span>, <span class="dv">2023</span>],</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span>[row[<span class="st">"2019"</span>], row[<span class="st">"2023"</span>]],</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>            mode<span class="op">=</span><span class="st">'lines+markers'</span>,</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span>row[<span class="st">"telework_freq_str"</span>],</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>            line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span>color_map.get(row[<span class="st">"telework_freq_str"</span>])),</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>            marker<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span>color_map.get(row[<span class="st">"telework_freq_str"</span>])),</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>        row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Commute data</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>commute_pivot <span class="op">=</span> (</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>    commute_freq_summary</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"commute_freq_str"</span>) <span class="op">!=</span> <span class="st">"Missing Response"</span>)</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>    .pivot(index<span class="op">=</span>[<span class="st">"commute_freq_str"</span>, <span class="st">"commute_freq_cat"</span>], on<span class="op">=</span><span class="st">"year"</span>, values<span class="op">=</span><span class="st">"% (wtd)"</span>)</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"commute_freq_cat"</span>, descending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> commute_pivot.iter_rows(named<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(</span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>        go.Scatter(</span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span>[<span class="dv">2019</span>, <span class="dv">2023</span>],</span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span>[row[<span class="st">"2019"</span>], row[<span class="st">"2023"</span>]],</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>            mode<span class="op">=</span><span class="st">'lines+markers'</span>,</span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span>row[<span class="st">"commute_freq_str"</span>],</span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>            line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span>color_map.get(row[<span class="st">"commute_freq_str"</span>])),</span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>            marker<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span>color_map.get(row[<span class="st">"commute_freq_str"</span>])),</span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>            showlegend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>        row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">2</span></span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Find max value across both datasets to set matching y-axis range</span></span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a>max_val <span class="op">=</span> max_val <span class="op">=</span> <span class="bu">max</span>(</span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a>    telework_pivot[<span class="st">'2019'</span>].<span class="bu">max</span>(),</span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>    telework_pivot[<span class="st">'2023'</span>].<span class="bu">max</span>(),</span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a>    commute_pivot[<span class="st">'2019'</span>].<span class="bu">max</span>(),</span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a>    commute_pivot[<span class="st">'2023'</span>].<span class="bu">max</span>(),</span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(tickvals<span class="op">=</span>[<span class="dv">2019</span>, <span class="dv">2023</span>])</span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">"% (Weighted)"</span>, <span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>, max_val <span class="op">*</span> <span class="fl">1.1</span>])</span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a>fig.update_layout(height<span class="op">=</span><span class="dv">500</span>, title_text<span class="op">=</span><span class="st">"Work Pattern Changes: 2019 to 2023"</span>)</span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="fig-freq-shift-point-plot" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-freq-shift-point-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>            <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG"></script><script type="text/javascript">if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}</script>                <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script charset="utf-8" src="https://cdn.plot.ly/plotly-3.2.0.min.js" integrity="sha256-iZ2u/oU2wf/vDbl/ChcX93WgbBRSBvUO6N413hDz7xM=" crossorigin="anonymous"></script>                <div id="327bd883-19d2-4c47-adde-46631c8d2701" class="plotly-graph-div" style="height:500px; width:100%;"></div>            <script type="text/javascript">                window.PLOTLYENV=window.PLOTLYENV || {};                                if (document.getElementById("327bd883-19d2-4c47-adde-46631c8d2701")) {                    Plotly.newPlot(                        "327bd883-19d2-4c47-adde-46631c8d2701",                        [{"line":{"color":"rgb(0, 0, 255)"},"marker":{"color":"rgb(0, 0, 255)"},"mode":"lines+markers","name":"5+ days per week","x":[2019,2023],"y":[13.21,22.39],"type":"scatter","xaxis":"x","yaxis":"y"},{"line":{"color":"rgb(51, 0, 204)"},"marker":{"color":"rgb(51, 0, 204)"},"mode":"lines+markers","name":"4 days per week","x":[2019,2023],"y":[1.09,6.25],"type":"scatter","xaxis":"x","yaxis":"y"},{"line":{"color":"rgb(102, 0, 153)"},"marker":{"color":"rgb(102, 0, 153)"},"mode":"lines+markers","name":"2-3 days per week","x":[2019,2023],"y":[9.46,22.64],"type":"scatter","xaxis":"x","yaxis":"y"},{"line":{"color":"rgb(153, 0, 102)"},"marker":{"color":"rgb(153, 0, 102)"},"mode":"lines+markers","name":"1 day per week","x":[2019,2023],"y":[8.96,6.72],"type":"scatter","xaxis":"x","yaxis":"y"},{"line":{"color":"rgb(204, 0, 51)"},"marker":{"color":"rgb(204, 0, 51)"},"mode":"lines+markers","name":"Less than once a week","x":[2019,2023],"y":[28.1,12.79],"type":"scatter","xaxis":"x","yaxis":"y"},{"line":{"color":"rgb(255, 0, 0)"},"marker":{"color":"rgb(255, 0, 0)"},"mode":"lines+markers","name":"Almost never","x":[2019,2023],"y":[36.56,29.08],"type":"scatter","xaxis":"x","yaxis":"y"},{"line":{"color":"rgb(0, 0, 255)"},"marker":{"color":"rgb(0, 0, 255)"},"mode":"lines+markers","name":"5+ days per week","showlegend":false,"x":[2019,2023],"y":[55.82,37.79],"type":"scatter","xaxis":"x2","yaxis":"y2"},{"line":{"color":"rgb(51, 0, 204)"},"marker":{"color":"rgb(51, 0, 204)"},"mode":"lines+markers","name":"4 days per week","showlegend":false,"x":[2019,2023],"y":[17.1,9.75],"type":"scatter","xaxis":"x2","yaxis":"y2"},{"line":{"color":"rgb(102, 0, 153)"},"marker":{"color":"rgb(102, 0, 153)"},"mode":"lines+markers","name":"2-3 days per week","showlegend":false,"x":[2019,2023],"y":[8.64,23.49],"type":"scatter","xaxis":"x2","yaxis":"y2"},{"line":{"color":"rgb(153, 0, 102)"},"marker":{"color":"rgb(153, 0, 102)"},"mode":"lines+markers","name":"1 day per week","showlegend":false,"x":[2019,2023],"y":[2.67,5.36],"type":"scatter","xaxis":"x2","yaxis":"y2"},{"line":{"color":"rgb(204, 0, 51)"},"marker":{"color":"rgb(204, 0, 51)"},"mode":"lines+markers","name":"Less than once a week","showlegend":false,"x":[2019,2023],"y":[null,6.52],"type":"scatter","xaxis":"x2","yaxis":"y2"},{"line":{"color":"rgb(255, 0, 0)"},"marker":{"color":"rgb(255, 0, 0)"},"mode":"lines+markers","name":"Almost never","showlegend":false,"x":[2019,2023],"y":[11.94,15.26],"type":"scatter","xaxis":"x2","yaxis":"y2"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermap":[{"type":"scattermap","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"anchor":"y","domain":[0.0,0.45],"tickvals":[2019,2023]},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"% (Weighted)"},"range":[0,61.40200000000001]},"xaxis2":{"anchor":"y2","domain":[0.55,1.0],"tickvals":[2019,2023]},"yaxis2":{"anchor":"x2","domain":[0.0,1.0],"title":{"text":"% (Weighted)"},"range":[0,61.40200000000001]},"annotations":[{"font":{"size":16},"showarrow":false,"text":"Telework Frequency","x":0.225,"xanchor":"center","xref":"paper","y":1.0,"yanchor":"bottom","yref":"paper"},{"font":{"size":16},"showarrow":false,"text":"Commute Frequency","x":0.775,"xanchor":"center","xref":"paper","y":1.0,"yanchor":"bottom","yref":"paper"}],"title":{"text":"Work Pattern Changes: 2019 to 2023"},"height":500},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('327bd883-19d2-4c47-adde-46631c8d2701');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };            </script>        </div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-freq-shift-point-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Shift in Telework and Commute Frequency: 2019 vs 2023
</figcaption>
</figure>
</div>
</div>
<div id="cell-fig-telework-commute-diverging" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot telework data</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>telework_pivot <span class="op">=</span> (</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    telework_plot_data</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    .pivot(index<span class="op">=</span>[<span class="st">"telework_freq_str"</span>, <span class="st">"telework_freq_cat"</span>], on<span class="op">=</span><span class="st">"year"</span>, values<span class="op">=</span><span class="st">"% (wtd)"</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"telework_freq_cat"</span>, descending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot commute data</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>commute_pivot <span class="op">=</span> (</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    commute_plot_data</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    .pivot(index<span class="op">=</span>[<span class="st">"commute_freq_str"</span>, <span class="st">"commute_freq_cat"</span>], on<span class="op">=</span><span class="st">"year"</span>, values<span class="op">=</span><span class="st">"% (wtd)"</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"commute_freq_cat"</span>, descending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Colors</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>telework_2019_color <span class="op">=</span> <span class="st">'rgba(31, 119, 180, 0.5)'</span>  <span class="co"># Light blue</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>telework_2023_color <span class="op">=</span> <span class="st">'#1f77b4'</span>  <span class="co"># Full blue</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>commute_2019_color <span class="op">=</span> <span class="st">'rgba(255, 127, 14, 0.5)'</span>  <span class="co"># Light orange</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>commute_2023_color <span class="op">=</span> <span class="st">'#ff7f0e'</span>  <span class="co"># Full orange</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure()</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Commute 2019 (left side)</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>fig.add_trace(go.Bar(</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>commute_pivot[<span class="st">"commute_freq_str"</span>],</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=-</span>commute_pivot[<span class="st">"2019"</span>],</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"2019"</span>,</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    orientation<span class="op">=</span><span class="st">'h'</span>,</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    marker_color<span class="op">=</span>commute_2019_color,</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    text<span class="op">=</span>commute_pivot[<span class="st">"2019"</span>].<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    texttemplate<span class="op">=</span><span class="st">'%</span><span class="sc">{text}</span><span class="st">%'</span>,</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    textposition<span class="op">=</span><span class="st">'inside'</span>,</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    offsetgroup<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>    legendgroup<span class="op">=</span><span class="st">'2019'</span>,</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Commute 2023 (left side, dodged)</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>fig.add_trace(go.Bar(</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>commute_pivot[<span class="st">"commute_freq_str"</span>],</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=-</span>commute_pivot[<span class="st">"2023"</span>],</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"2023"</span>,</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>    orientation<span class="op">=</span><span class="st">'h'</span>,</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>    marker_color<span class="op">=</span>commute_2023_color,</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>    text<span class="op">=</span>commute_pivot[<span class="st">"2023"</span>].<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>    texttemplate<span class="op">=</span><span class="st">'%</span><span class="sc">{text}</span><span class="st">%'</span>,</span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>    textposition<span class="op">=</span><span class="st">'inside'</span>,</span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>    offsetgroup<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>    legendgroup<span class="op">=</span><span class="st">'2023'</span>,</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Telework 2019 (right side)</span></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>fig.add_trace(go.Bar(</span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>telework_pivot[<span class="st">"telework_freq_str"</span>],</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>telework_pivot[<span class="st">"2019"</span>],</span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"2019"</span>,</span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>    orientation<span class="op">=</span><span class="st">'h'</span>,</span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>    marker_color<span class="op">=</span>telework_2019_color,</span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>    text<span class="op">=</span>telework_pivot[<span class="st">"2019"</span>].<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>    texttemplate<span class="op">=</span><span class="st">'%</span><span class="sc">{text}</span><span class="st">%'</span>,</span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>    textposition<span class="op">=</span><span class="st">'inside'</span>,</span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a>    offsetgroup<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>    legendgroup<span class="op">=</span><span class="st">'2019'</span>,</span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>    showlegend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Telework 2023 (right side, dodged)</span></span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a>fig.add_trace(go.Bar(</span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>telework_pivot[<span class="st">"telework_freq_str"</span>],</span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>telework_pivot[<span class="st">"2023"</span>],</span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"2023"</span>,</span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a>    orientation<span class="op">=</span><span class="st">'h'</span>,</span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a>    marker_color<span class="op">=</span>telework_2023_color,</span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a>    text<span class="op">=</span>telework_pivot[<span class="st">"2023"</span>].<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a>    texttemplate<span class="op">=</span><span class="st">'%</span><span class="sc">{text}</span><span class="st">%'</span>,</span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a>    textposition<span class="op">=</span><span class="st">'inside'</span>,</span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a>    offsetgroup<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a>    legendgroup<span class="op">=</span><span class="st">'2023'</span>,</span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a>    showlegend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb24-79"><a href="#cb24-79" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb24-80"><a href="#cb24-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-81"><a href="#cb24-81" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb24-82"><a href="#cb24-82" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Commute vs Telework Frequency: 2019 vs 2023"</span>,</span>
<span id="cb24-83"><a href="#cb24-83" aria-hidden="true" tabindex="-1"></a>    xaxis_title<span class="op">=</span><span class="st">" Commute Frequency | Telework Frequency &lt;br&gt;</span><span class="sc">% o</span><span class="st">f Employed Persons (Weighted)"</span>,</span>
<span id="cb24-84"><a href="#cb24-84" aria-hidden="true" tabindex="-1"></a>    yaxis_title<span class="op">=</span><span class="st">""</span>,</span>
<span id="cb24-85"><a href="#cb24-85" aria-hidden="true" tabindex="-1"></a>    barmode<span class="op">=</span><span class="st">'group'</span>,</span>
<span id="cb24-86"><a href="#cb24-86" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">600</span>,</span>
<span id="cb24-87"><a href="#cb24-87" aria-hidden="true" tabindex="-1"></a>    xaxis<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb24-88"><a href="#cb24-88" aria-hidden="true" tabindex="-1"></a>        tickvals<span class="op">=</span>[<span class="op">-</span><span class="dv">40</span>, <span class="op">-</span><span class="dv">30</span>, <span class="op">-</span><span class="dv">20</span>, <span class="op">-</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>],</span>
<span id="cb24-89"><a href="#cb24-89" aria-hidden="true" tabindex="-1"></a>        ticktext<span class="op">=</span>[<span class="st">'40%'</span>, <span class="st">'30%'</span>, <span class="st">'20%'</span>, <span class="st">'10%'</span>, <span class="st">'0'</span>, <span class="st">'10%'</span>, <span class="st">'20%'</span>, <span class="st">'30%'</span>, <span class="st">'40%'</span>]</span>
<span id="cb24-90"><a href="#cb24-90" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-91"><a href="#cb24-91" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-92"><a href="#cb24-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-93"><a href="#cb24-93" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="fig-telework-commute-diverging" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-telework-commute-diverging-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>            <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG"></script><script type="text/javascript">if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}</script>                <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script charset="utf-8" src="https://cdn.plot.ly/plotly-3.2.0.min.js" integrity="sha256-iZ2u/oU2wf/vDbl/ChcX93WgbBRSBvUO6N413hDz7xM=" crossorigin="anonymous"></script>                <div id="0edaf4b1-99ab-4395-a2f4-2766c0bdbd15" class="plotly-graph-div" style="height:600px; width:100%;"></div>            <script type="text/javascript">                window.PLOTLYENV=window.PLOTLYENV || {};                                if (document.getElementById("0edaf4b1-99ab-4395-a2f4-2766c0bdbd15")) {                    Plotly.newPlot(                        "0edaf4b1-99ab-4395-a2f4-2766c0bdbd15",                        [{"legendgroup":"2019","marker":{"color":"rgba(255, 127, 14, 0.5)"},"name":"2019","offsetgroup":"0","orientation":"h","text":{"dtype":"f8","bdata":"ZmZmZmbmS0CamZmZmRkxQDMzMzMzMyFAmpmZmZmZBUAAAAAAAAD4f83MzMzMzCdA"},"textposition":"inside","texttemplate":"%{text}%","x":{"dtype":"f8","bdata":"KVyPwvXoS8CamZmZmRkxwEjhehSuRyHAXI\u002fC9ShcBcAAAAAAAAD4f+F6FK5H4SfA"},"y":["5+ days per week","4 days per week","2-3 days per week","1 day per week","Less than once a week","Almost never"],"type":"bar"},{"legendgroup":"2023","marker":{"color":"#ff7f0e"},"name":"2023","offsetgroup":"1","orientation":"h","text":{"dtype":"f8","bdata":"ZmZmZmbmQkCamZmZmZkjQAAAAAAAgDdAmpmZmZmZFUAAAAAAAAAaQJqZmZmZmS5A"},"textposition":"inside","texttemplate":"%{text}%","x":{"dtype":"f8","bdata":"hetRuB7lQsAAAAAAAIAjwD0K16NwfTfAcT0K16NwFcAUrkfhehQawIXrUbgehS7A"},"y":["5+ days per week","4 days per week","2-3 days per week","1 day per week","Less than once a week","Almost never"],"type":"bar"},{"legendgroup":"2019","marker":{"color":"rgba(31, 119, 180, 0.5)"},"name":"2019","offsetgroup":"0","orientation":"h","showlegend":false,"text":{"dtype":"f8","bdata":"ZmZmZmZmKkCamZmZmZnxPwAAAAAAACNAAAAAAAAAIkCamZmZmRk8QM3MzMzMTEJA"},"textposition":"inside","texttemplate":"%{text}%","x":{"dtype":"f8","bdata":"7FG4HoVrKkBxPQrXo3DxP+xRuB6F6yJA7FG4HoXrIUCamZmZmRk8QEjhehSuR0JA"},"y":["5+ days per week","4 days per week","2-3 days per week","1 day per week","Less than once a week","Almost never"],"type":"bar"},{"legendgroup":"2023","marker":{"color":"#1f77b4"},"name":"2023","offsetgroup":"1","orientation":"h","showlegend":false,"text":{"dtype":"f8","bdata":"ZmZmZmZmNkDNzMzMzMwYQJqZmZmZmTZAzczMzMzMGkCamZmZmZkpQJqZmZmZGT1A"},"textposition":"inside","texttemplate":"%{text}%","x":{"dtype":"f8","bdata":"pHA9CtdjNkAAAAAAAAAZQKRwPQrXozZA4XoUrkfhGkAUrkfhepQpQBSuR+F6FD1A"},"y":["5+ days per week","4 days per week","2-3 days per week","1 day per week","Less than once a week","Almost never"],"type":"bar"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermap":[{"type":"scattermap","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"title":{"text":" Commute Frequency | Telework Frequency \u003cbr\u003e% of Employed Persons (Weighted)"},"tickvals":[-40,-30,-20,-10,0,10,20,30,40],"ticktext":["40%","30%","20%","10%","0","10%","20%","30%","40%"]},"title":{"text":"Commute vs Telework Frequency: 2019 vs 2023"},"yaxis":{"title":{"text":""}},"barmode":"group","height":600},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('0edaf4b1-99ab-4395-a2f4-2766c0bdbd15');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };            </script>        </div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-telework-commute-diverging-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Change in Telework and Commute Frequency: 2019 vs 2023
</figcaption>
</figure>
</div>
</div>
</section>
<section id="telework-ratio-proportion-of-work-days-at-home" class="level3">
<h3 class="anchored" data-anchor-id="telework-ratio-proportion-of-work-days-at-home">Telework Ratio (Proportion of Work Days at Home)</h3>
<div id="telework-ratio-summary" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>telework_ratio_summary <span class="op">=</span> (</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    employed_persons.group_by(<span class="st">"year"</span>, <span class="st">"telework_ratio_str"</span>, <span class="st">"telework_ratio_cat"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>        pl.<span class="bu">len</span>().alias(<span class="st">"count"</span>),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"person_weight"</span>).<span class="bu">sum</span>().alias(<span class="st">"weighted_count"</span>),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        (</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>            <span class="dv">100</span> <span class="op">*</span> pl.col(<span class="st">"weighted_count"</span>) <span class="op">/</span> pl.col(<span class="st">"weighted_count"</span>).<span class="bu">sum</span>().over(<span class="st">"year"</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>        ).alias(<span class="st">"% (wtd)"</span>),</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">100</span> <span class="op">*</span> pl.col(<span class="st">"count"</span>) <span class="op">/</span> pl.col(<span class="st">"count"</span>).<span class="bu">sum</span>().over(<span class="st">"year"</span>)).alias(<span class="st">"% (unwtd)"</span>),</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"weighted_count"</span>).<span class="bu">round</span>(<span class="dv">2</span>),</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"% (wtd)"</span>).<span class="bu">round</span>(<span class="dv">2</span>),</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"% (unwtd)"</span>).<span class="bu">round</span>(<span class="dv">2</span>),</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"telework_ratio_cat"</span>)</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    .drop(<span class="st">"telework_ratio_cat"</span>)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Telework Ratio Summary - 2019:"</span>)</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(telework_ratio_summary.<span class="bu">filter</span>(pl.col(<span class="st">"year"</span>) <span class="op">==</span> <span class="st">"2019"</span>))</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Telework Ratio Summary - 2023:"</span>)</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(telework_ratio_summary.<span class="bu">filter</span>(pl.col(<span class="st">"year"</span>) <span class="op">==</span> <span class="st">"2023"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Telework Ratio Summary - 2019:
shape: (6, 6)

 year  telework_ratio_str               count  weighted_count  % (wtd)  % (unwtd) 
 ---   ---                              ---    ---             ---      ---       
 str   str                              u32    f64             f64      f64       

 2019  Missing Response                 51     121896.02       3.81     1.63      
 2019  Never, or less than once a wee  2130   2.0453e6        63.96    68.05     
 2019  Less than 40% of the time        346    259459.1        8.11     11.05     
 2019  About half (40-60%)              266    310943.52       9.72     8.5       
 2019  More than 60% of the time        62     97243.17        3.04     1.98      
 2019  Always                           275    363211.66       11.36    8.79      

Telework Ratio Summary - 2023:
shape: (6, 6)

 year  telework_ratio_str               count  weighted_count  % (wtd)  % (unwtd) 
 ---   ---                              ---    ---             ---      ---       
 str   str                              u32    f64             f64      f64       

 2023  Missing Response                 49     54134.88        1.83     0.82      
 2023  Never, or less than once a wee  1933   1.1977e6        40.55    32.47     
 2023  Less than 40% of the time        463    204383.86       6.92     7.78      
 2023  About half (40-60%)              1728   722956.48       24.47    29.02     
 2023  More than 60% of the time        426    172590.89       5.84     7.15      
 2023  Always                           1355   602217.18       20.39    22.76     
</code></pre>
</div>
</div>
<div id="cell-fig-telework-ratio" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.bar(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    telework_ratio_summary,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"telework_ratio_str"</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"% (wtd)"</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"year"</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    barmode<span class="op">=</span><span class="st">"group"</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Proportion of Work Days Spent Working From Home by Survey Year"</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{<span class="st">"telework_ratio_str"</span>: <span class="st">"Telework Ratio"</span>, <span class="st">"% (wtd)"</span>: <span class="st">"Percentage (Weighted)"</span>, <span class="st">"year"</span>: <span class="st">"Survey Year"</span>},</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    text<span class="op">=</span><span class="st">"% (wtd)"</span>,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>fig.update_traces(texttemplate<span class="op">=</span><span class="st">'%</span><span class="sc">{text:.1f}</span><span class="st">%'</span>, textposition<span class="op">=</span><span class="st">'outside'</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="fig-telework-ratio" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-telework-ratio-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>            <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG"></script><script type="text/javascript">if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}</script>                <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script charset="utf-8" src="https://cdn.plot.ly/plotly-3.2.0.min.js" integrity="sha256-iZ2u/oU2wf/vDbl/ChcX93WgbBRSBvUO6N413hDz7xM=" crossorigin="anonymous"></script>                <div id="a205e02a-0f7c-4994-b1c4-2bc6fc72aa9d" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                window.PLOTLYENV=window.PLOTLYENV || {};                                if (document.getElementById("a205e02a-0f7c-4994-b1c4-2bc6fc72aa9d")) {                    Plotly.newPlot(                        "a205e02a-0f7c-4994-b1c4-2bc6fc72aa9d",                        [{"alignmentgroup":"True","hovertemplate":"Survey Year=2019\u003cbr\u003eTelework Ratio=%{x}\u003cbr\u003ePercentage (Weighted)=%{text}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"2019","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"2019","offsetgroup":"2019","orientation":"v","showlegend":true,"text":{"dtype":"f8","bdata":"exSuR+F6DkB7FK5H4fpPQLgehetROCBAcT0K16NwI0BSuB6F61EIQLgehetRuCZA"},"textposition":"outside","x":["Missing Response","Never, or less than once a week","Less than 40% of the time","About half (40-60%)","More than 60% of the time","Always"],"xaxis":"x","y":{"dtype":"f8","bdata":"exSuR+F6DkB7FK5H4fpPQLgehetROCBAcT0K16NwI0BSuB6F61EIQLgehetRuCZA"},"yaxis":"y","type":"bar","texttemplate":"%{text:.1f}%"},{"alignmentgroup":"True","hovertemplate":"Survey Year=2023\u003cbr\u003eTelework Ratio=%{x}\u003cbr\u003ePercentage (Weighted)=%{text}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"2023","marker":{"color":"#EF553B","pattern":{"shape":""}},"name":"2023","offsetgroup":"2023","orientation":"v","showlegend":true,"text":{"dtype":"f8","bdata":"SOF6FK5H\u002fT9mZmZmZkZEQK5H4XoUrhtAuB6F61F4OEBcj8L1KFwXQKRwPQrXYzRA"},"textposition":"outside","x":["Missing Response","Never, or less than once a week","Less than 40% of the time","About half (40-60%)","More than 60% of the time","Always"],"xaxis":"x","y":{"dtype":"f8","bdata":"SOF6FK5H\u002fT9mZmZmZkZEQK5H4XoUrhtAuB6F61F4OEBcj8L1KFwXQKRwPQrXYzRA"},"yaxis":"y","type":"bar","texttemplate":"%{text:.1f}%"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermap":[{"type":"scattermap","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"Telework Ratio"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Percentage (Weighted)"}},"legend":{"title":{"text":"Survey Year"},"tracegroupgap":0},"title":{"text":"Proportion of Work Days Spent Working From Home by Survey Year"},"barmode":"group"},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('a205e02a-0f7c-4994-b1c4-2bc6fc72aa9d');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };            </script>        </div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-telework-ratio-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Telework Ratio Distribution (Weighted)
</figcaption>
</figure>
</div>
</div>
</section>
</section>
<section id="telework-summary" class="level2">
<h2 class="anchored" data-anchor-id="telework-summary">Telework Summary</h2>
<div id="7a246f42" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define metric categories based on frequency</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>is_5plus <span class="op">=</span> pl.col(<span class="st">"telework_freq_cat"</span>) <span class="op">&gt;</span> FrequencyCategory.FOUR.value</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>is_2plus <span class="op">=</span> pl.col(<span class="st">"telework_freq_cat"</span>) <span class="op">&gt;=</span> FrequencyCategory.TWO_THREE.value</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>is_1orless <span class="op">=</span> (</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    (pl.col(<span class="st">"telework_freq_cat"</span>) <span class="op">&lt;=</span> FrequencyCategory.ONE.value)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> (pl.col(<span class="st">"telework_freq_cat"</span>) <span class="op">!=</span> FrequencyCategory.MISSING.value)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorize and aggregate in one chain</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>telework_metrics <span class="op">=</span> (</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    telework_freq_summary</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>        pl.when(is_5plus).then(pl.lit(<span class="st">"5+ days per week"</span>))</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>        .when(is_2plus).then(pl.lit(<span class="st">"2+ days per week"</span>))</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>        .when(is_1orless).then(pl.lit(<span class="st">"1 day or less per week"</span>))</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>        .alias(<span class="st">"Telework Frequency"</span>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"Telework Frequency"</span>).is_not_null())</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"year"</span>, <span class="st">"Telework Frequency"</span>)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    .agg(pl.col(<span class="st">"% (wtd)"</span>).<span class="bu">sum</span>())</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    .pivot(index<span class="op">=</span><span class="st">"Telework Frequency"</span>, on<span class="op">=</span><span class="st">"year"</span>, values<span class="op">=</span><span class="st">"% (wtd)"</span>)</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>).sort(<span class="st">"Telework Frequency"</span>).select(</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Telework Frequency"</span>,</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2019"</span>,</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2023"</span>,</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>).with_columns(</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"2019"</span>).<span class="bu">round</span>(<span class="dv">2</span>).alias(<span class="st">"2019 (%)"</span>),</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"2023"</span>).<span class="bu">round</span>(<span class="dv">2</span>).alias(<span class="st">"2023 (%)"</span>),</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a><span class="co"># column sums</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>telework_metrics</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Summary of Key Telework Metrics:")</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Proportion of employed persons teleworking 5+ days/week:")</span></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a><span class="co"># for year, pct in telework_5plus.items():</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"  {year}: {pct:.2f}%")</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Proportion of employed persons teleworking 2+ days/week:")</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a><span class="co"># for year, pct in telework_2plus.items():</span></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(f"  {year}: {pct:.2f}%")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="20">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 5)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Telework Frequency</th>
<th data-quarto-table-cell-role="th">2019</th>
<th data-quarto-table-cell-role="th">2023</th>
<th data-quarto-table-cell-role="th">2019 (%)</th>
<th data-quarto-table-cell-role="th">2023 (%)</th>
</tr>
<tr class="even">
<td>str</td>
<td>f64</td>
<td>f64</td>
<td>f64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"1 day or less per week"</td>
<td>73.62</td>
<td>48.59</td>
<td>73.62</td>
<td>48.59</td>
</tr>
<tr class="even">
<td>"2+ days per week"</td>
<td>10.55</td>
<td>28.89</td>
<td>10.55</td>
<td>28.89</td>
</tr>
<tr class="odd">
<td>"5+ days per week"</td>
<td>13.21</td>
<td>22.39</td>
<td>13.21</td>
<td>22.39</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="stated-vs-observed-commute-frequency-validation" class="level2">
<h2 class="anchored" data-anchor-id="stated-vs-observed-commute-frequency-validation">Stated vs Observed Commute Frequency Validation</h2>
<p>This section compares the stated telework and commute frequencies (from survey responses) against the observed behavior (from travel diary data). We focus on full-time employed persons only and classify weekdays based on whether they made any work-related trips.</p>
<section id="classify-weekdays-as-commute-days" class="level3">
<h3 class="anchored" data-anchor-id="classify-weekdays-as-commute-days">Classify Weekdays as Commute Days</h3>
<p>For each person-day, we identify weekdays (Monday-Friday) and flag them as commute days if the person made any work or work-related trips (<code>d_purpose_category</code> in [2, 3]). Non-commute weekdays are potential work-from-home days.</p>
<div id="classify-commute-days" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify work trips in 2019 (d_purpose_category 2=Work, 3=Work-related)</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>work_trips_19 <span class="op">=</span> (</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    trips_19</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"d_purpose_category"</span>).is_in([<span class="dv">2</span>, <span class="dv">3</span>]))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    .select(<span class="st">"day_id"</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    .unique()</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    .with_columns(has_work_trip<span class="op">=</span>pl.lit(<span class="va">True</span>))</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify work trips in 2023</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>work_trips_23 <span class="op">=</span> (</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    trips_23</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"d_purpose_category"</span>).is_in([<span class="dv">2</span>, <span class="dv">3</span>]))</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    .select(<span class="st">"day_id"</span>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    .unique()</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    .with_columns(has_work_trip<span class="op">=</span>pl.lit(<span class="va">True</span>))</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Process 2019 days (day weight needs to be added from person level)</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>days_19_classified <span class="op">=</span> (</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    days_19</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    .select(<span class="st">"day_id"</span>, <span class="st">"person_id"</span>, <span class="st">"travel_date_dow"</span>)</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter to weekdays only (Monday=1 through Friday=5)</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"travel_date_dow"</span>).is_between(<span class="dv">1</span>, <span class="dv">5</span>))</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add day weight from person-level weight (2019 doesn't have day-level weights)</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>    .join(</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>        persons_19.select(<span class="st">"person_id"</span>, pl.col(<span class="st">"wt_sphone_wkday"</span>).alias(<span class="st">"day_weight"</span>)),</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>        on<span class="op">=</span><span class="st">"person_id"</span>,</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>        how<span class="op">=</span><span class="st">"left"</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Join with work trips to flag commute days</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>    .join(work_trips_19, on<span class="op">=</span><span class="st">"day_id"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"has_work_trip"</span>).fill_null(<span class="va">False</span>),</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>        pl.lit(<span class="st">"2019"</span>).alias(<span class="st">"year"</span>),</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>    .rename({<span class="st">"travel_date_dow"</span>: <span class="st">"travel_dow"</span>})</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Process 2023 days (now has revised day weights)</span></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>days_23_classified <span class="op">=</span> (</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>    days_23</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>    .select(<span class="st">"day_id"</span>, <span class="st">"person_id"</span>, <span class="st">"travel_dow"</span>, <span class="st">"day_weight"</span>)</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter to weekdays only</span></span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"travel_dow"</span>).is_between(<span class="dv">1</span>, <span class="dv">5</span>))</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Join with work trips to flag commute days</span></span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>    .join(work_trips_23, on<span class="op">=</span><span class="st">"day_id"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>        has_work_trip<span class="op">=</span>pl.col(<span class="st">"has_work_trip"</span>).fill_null(<span class="va">False</span>),</span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>        year<span class="op">=</span>pl.lit(<span class="st">"2023"</span>),</span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine years</span></span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a>days_classified <span class="op">=</span> pl.concat([days_19_classified, days_23_classified], rechunk<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Total weekdays classified: </span><span class="sc">{</span><span class="bu">len</span>(days_classified)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a>logger.info(<span class="ss">f"Weekdays with work trips: </span><span class="sc">{</span>days_classified<span class="sc">.</span><span class="bu">filter</span>(pl.col(<span class="st">'has_work_trip'</span>))<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:__main__:Total weekdays classified: 91,561
INFO:__main__:Weekdays with work trips: 31,553</code></pre>
</div>
</div>
</section>
<section id="calculate-observed-frequencies" class="level3">
<h3 class="anchored" data-anchor-id="calculate-observed-frequencies">Calculate Observed Frequencies</h3>
<p>Aggregate to person level to calculate observed commute and telework frequencies based on actual travel diary behavior.</p>
<div id="calculate-observed-freq" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate by person to calculate observed frequencies</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>observed_freq <span class="op">=</span> (</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    days_classified</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"person_id"</span>, <span class="st">"year"</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Total weekdays in diary</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>        total_weekdays<span class="op">=</span>pl.<span class="bu">len</span>(),</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Weighted total weekdays</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>        total_weekdays_wtd<span class="op">=</span>(pl.col(<span class="st">"day_weight"</span>) <span class="op">*</span> pl.lit(<span class="dv">1</span>)).<span class="bu">sum</span>(),</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Commute days (days with work trips)</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>        commute_days<span class="op">=</span>(pl.col(<span class="st">"has_work_trip"</span>).cast(pl.Int32)).<span class="bu">sum</span>(),</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Weighted commute days</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>        commute_days_wtd<span class="op">=</span>(pl.col(<span class="st">"has_work_trip"</span>).cast(pl.Int32) <span class="op">*</span> pl.col(<span class="st">"day_weight"</span>)).<span class="bu">sum</span>(),</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Non-commute weekdays (potential WFH days)</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>        wfh_days<span class="op">=</span>((<span class="op">~</span>pl.col(<span class="st">"has_work_trip"</span>)).cast(pl.Int32)).<span class="bu">sum</span>(),</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Weighted WFH days</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>        wfh_days_wtd<span class="op">=</span>((<span class="op">~</span>pl.col(<span class="st">"has_work_trip"</span>)).cast(pl.Int32) <span class="op">*</span> pl.col(<span class="st">"day_weight"</span>)).<span class="bu">sum</span>(),</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate observed weekly frequency rates (extrapolate from diary)</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Assuming 5 weekdays per week</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>        observed_commute_rate<span class="op">=</span>(pl.col(<span class="st">"commute_days_wtd"</span>) <span class="op">/</span> pl.col(<span class="st">"total_weekdays_wtd"</span>) <span class="op">*</span> <span class="dv">5</span>),</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>        observed_telework_rate<span class="op">=</span>(pl.col(<span class="st">"wfh_days_wtd"</span>) <span class="op">/</span> pl.col(<span class="st">"total_weekdays_wtd"</span>) <span class="op">*</span> <span class="dv">5</span>),</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>freq_comparison <span class="op">=</span> (</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    employed_persons</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"employment"</span>) <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"person_id"</span>,</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"year"</span>,</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"person_weight"</span>,</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"telework_freq_cat"</span>).alias(<span class="st">"stated_telework_freq"</span>),</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"telework_freq_str"</span>).alias(<span class="st">"stated_telework_str"</span>),</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"commute_freq_cat"</span>).alias(<span class="st">"stated_commute_freq"</span>),</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"commute_freq_str"</span>).alias(<span class="st">"stated_commute_str"</span>),</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">"job_type"</span>,</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>    .join(observed_freq, on<span class="op">=</span>[<span class="st">"person_id"</span>, <span class="st">"year"</span>], how<span class="op">=</span><span class="st">"inner"</span>)</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(pl.col(<span class="st">"total_weekdays"</span>) <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="merge-with-stated-frequencies" class="level3">
<h3 class="anchored" data-anchor-id="merge-with-stated-frequencies">Merge with Stated Frequencies</h3>
<p>Join the observed frequencies with the stated frequencies from the person table. We filter to full-time employed persons only (employment status code 1). The stated frequencies use the cleaned categorical values and labels created earlier.</p>
<div id="cell-merge-stated-observed" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bin_frequency_rate(rate_col: <span class="bu">str</span>) <span class="op">-&gt;</span> pl.Expr:</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Bin a frequency rate (days per week) to FrequencyCategory integer codes.</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Maps rates to categories:</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co">    - null  -1 (MISSING)</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co">    - 0  0 (NEVER)</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co">    - 0 &lt; x &lt; 1  1 (LESS_THAN_WEEKLY)</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co">    - 1  x &lt; 2  2 (ONE)</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co">    - 2  x &lt; 4  3 (TWO_THREE)</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co">    - 4  x &lt; 5  4 (FOUR)</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co">    - x  5  5 (FIVE_PLUS)</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co">        rate_col: Name of the column containing the rate values</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co">        Polars expression that maps rates to frequency category codes</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>        pl.when(pl.col(rate_col).is_null())</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>        .then(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>        .when(pl.col(rate_col) <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>        .then(<span class="dv">0</span>)</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>        .when((pl.col(rate_col) <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">&amp;</span> (pl.col(rate_col) <span class="op">&lt;</span> <span class="dv">1</span>))</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>        .then(<span class="dv">1</span>)</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>        .when((pl.col(rate_col) <span class="op">&gt;=</span> <span class="dv">1</span>) <span class="op">&amp;</span> (pl.col(rate_col) <span class="op">&lt;</span> <span class="dv">2</span>))</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>        .then(<span class="dv">2</span>)</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>        .when((pl.col(rate_col) <span class="op">&gt;=</span> <span class="dv">2</span>) <span class="op">&amp;</span> (pl.col(rate_col) <span class="op">&lt;</span> <span class="dv">4</span>))</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>        .then(<span class="dv">3</span>)</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>        .when((pl.col(rate_col) <span class="op">&gt;=</span> <span class="dv">4</span>) <span class="op">&amp;</span> (pl.col(rate_col) <span class="op">&lt;</span> <span class="dv">5</span>))</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>        .then(<span class="dv">4</span>)</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>        .when(pl.col(rate_col) <span class="op">&gt;=</span> <span class="dv">5</span>)</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>        .then(<span class="dv">5</span>)</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>        .otherwise(<span class="va">None</span>)  <span class="co"># This should never happen, but makes unbinned values explicit</span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply to both columns</span></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>freq_comparison_binned <span class="op">=</span> freq_comparison.with_columns([</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>    bin_frequency_rate(<span class="st">"observed_commute_rate"</span>).alias(<span class="st">"observed_commute_cat"</span>),</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>    bin_frequency_rate(<span class="st">"observed_telework_rate"</span>).alias(<span class="st">"observed_telework_cat"</span>),</span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>bin_labs <span class="op">=</span> {x.value: x.label <span class="cf">for</span> x <span class="kw">in</span> FrequencyCategory}</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Map bins to labels</span></span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>freq_comparison_labeled <span class="op">=</span> freq_comparison_binned.with_columns(</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"observed_commute_cat"</span>).replace_strict(bin_labs).alias(<span class="st">"observed_commute_str"</span>),</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"observed_telework_cat"</span>).replace_strict(bin_labs).alias(<span class="st">"observed_telework_str"</span>)</span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Show sample</span></span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>freq_comparison_labeled.select(</span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">"person_id"</span>,</span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">"year"</span>,</span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stated_telework_str"</span>,</span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a>    <span class="st">"observed_telework_str"</span>,</span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stated_commute_str"</span>,</span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a>    <span class="st">"observed_commute_str"</span>,</span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a>    <span class="st">"total_weekdays"</span>,</span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a>).head(<span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="merge-stated-observed" class="cell-output cell-output-display" data-execution_count="23">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10, 7)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">person_id</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">stated_telework_str</th>
<th data-quarto-table-cell-role="th">observed_telework_str</th>
<th data-quarto-table-cell-role="th">stated_commute_str</th>
<th data-quarto-table-cell-role="th">observed_commute_str</th>
<th data-quarto-table-cell-role="th">total_weekdays</th>
</tr>
<tr class="even">
<td>i64</td>
<td>str</td>
<td>str</td>
<td>str</td>
<td>str</td>
<td>str</td>
<td>u32</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2340432701</td>
<td>"2023"</td>
<td>"Almost never"</td>
<td>"Almost never"</td>
<td>"5+ days per week"</td>
<td>"5+ days per week"</td>
<td>5</td>
</tr>
<tr class="even">
<td>18113501801</td>
<td>"2019"</td>
<td>"Almost never"</td>
<td>"Almost never"</td>
<td>"5+ days per week"</td>
<td>"5+ days per week"</td>
<td>5</td>
</tr>
<tr class="odd">
<td>2301633201</td>
<td>"2023"</td>
<td>"2-3 days per week"</td>
<td>"2-3 days per week"</td>
<td>"2-3 days per week"</td>
<td>"1 day per week"</td>
<td>5</td>
</tr>
<tr class="even">
<td>2340717801</td>
<td>"2023"</td>
<td>"2-3 days per week"</td>
<td>"2-3 days per week"</td>
<td>"2-3 days per week"</td>
<td>"1 day per week"</td>
<td>5</td>
</tr>
<tr class="odd">
<td>2301874501</td>
<td>"2023"</td>
<td>"Less than once a week"</td>
<td>"2-3 days per week"</td>
<td>"5+ days per week"</td>
<td>"2-3 days per week"</td>
<td>5</td>
</tr>
<tr class="even">
<td>2329158101</td>
<td>"2023"</td>
<td>"Almost never"</td>
<td>"Almost never"</td>
<td>"5+ days per week"</td>
<td>"5+ days per week"</td>
<td>5</td>
</tr>
<tr class="odd">
<td>18113341501</td>
<td>"2019"</td>
<td>"Less than once a week"</td>
<td>"1 day per week"</td>
<td>"5+ days per week"</td>
<td>"4 days per week"</td>
<td>5</td>
</tr>
<tr class="even">
<td>2330193701</td>
<td>"2023"</td>
<td>"Less than once a week"</td>
<td>"2-3 days per week"</td>
<td>"5+ days per week"</td>
<td>"2-3 days per week"</td>
<td>5</td>
</tr>
<tr class="odd">
<td>2334676701</td>
<td>"2023"</td>
<td>"Less than once a week"</td>
<td>"1 day per week"</td>
<td>"4 days per week"</td>
<td>"2-3 days per week"</td>
<td>5</td>
</tr>
<tr class="even">
<td>2311171601</td>
<td>"2023"</td>
<td>"1 day per week"</td>
<td>"2-3 days per week"</td>
<td>"2-3 days per week"</td>
<td>"2-3 days per week"</td>
<td>5</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="observed-frequency-distributions" class="level3">
<h3 class="anchored" data-anchor-id="observed-frequency-distributions">Observed Frequency Distributions</h3>
<p>Now lets examine the observed telework and commute frequencies derived from actual travel diary behavior. Well map the observed frequency codes to the same categorical structure used for stated frequencies.</p>
<div id="observed-telework-summary" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize observed telework frequency</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>observed_telework_summary <span class="op">=</span> (</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    freq_comparison_labeled</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"year"</span>, <span class="st">"observed_telework_str"</span>, <span class="st">"observed_telework_cat"</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>        pl.<span class="bu">len</span>().alias(<span class="st">"count"</span>),</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"person_weight"</span>).<span class="bu">sum</span>().alias(<span class="st">"weighted_count"</span>),</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">100</span> <span class="op">*</span> pl.col(<span class="st">"weighted_count"</span>) <span class="op">/</span> pl.col(<span class="st">"weighted_count"</span>).<span class="bu">sum</span>().over(<span class="st">"year"</span>)).alias(<span class="st">"% (wtd)"</span>),</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">100</span> <span class="op">*</span> pl.col(<span class="st">"count"</span>) <span class="op">/</span> pl.col(<span class="st">"count"</span>).<span class="bu">sum</span>().over(<span class="st">"year"</span>)).alias(<span class="st">"% (unwtd)"</span>),</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"weighted_count"</span>).<span class="bu">round</span>(<span class="dv">2</span>),</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"% (wtd)"</span>).<span class="bu">round</span>(<span class="dv">2</span>),</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"% (unwtd)"</span>).<span class="bu">round</span>(<span class="dv">2</span>),</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"observed_telework_cat"</span>)</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Observed Telework Frequency - 2019:"</span>)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(observed_telework_summary.<span class="bu">filter</span>(pl.col(<span class="st">"year"</span>) <span class="op">==</span> <span class="st">"2019"</span>).drop(<span class="st">"observed_telework_cat"</span>))</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Observed Telework Frequency - 2023:"</span>)</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(observed_telework_summary.<span class="bu">filter</span>(pl.col(<span class="st">"year"</span>) <span class="op">==</span> <span class="st">"2023"</span>).drop(<span class="st">"observed_telework_cat"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Observed Telework Frequency - 2019:
shape: (6, 6)

 year  observed_telework_str  count  weighted_count  % (wtd)  % (unwtd) 
 ---   ---                    ---    ---             ---      ---       
 str   str                    u32    f64             f64      f64       

 2019  Almost never           1273   1.1559e6        36.14    40.67     
 2019  Less than once a week  287    323140.39       10.1     9.17      
 2019  1 day per week         666    605505.09       18.93    21.28     
 2019  2-3 days per week      604    788579.57       24.66    19.3      
 2019  4 days per week        121    124199.03       3.88     3.87      
 2019  5+ days per week       179    200729.28       6.28     5.72      


Observed Telework Frequency - 2023:
shape: (4, 6)

 year  observed_telework_str  count  weighted_count  % (wtd)  % (unwtd) 
 ---   ---                    ---    ---             ---      ---       
 str   str                    u32    f64             f64      f64       

 2023  Almost never           1950   1.1953e6        40.46    32.75     
 2023  1 day per week         872    340431.68       11.52    14.65     
 2023  2-3 days per week      1262   467432.6        15.82    21.2      
 2023  5+ days per week       1870   950836.7        32.19    31.41     
</code></pre>
</div>
</div>
<div id="observed-commute-summary" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize observed commute frequency</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>observed_commute_summary <span class="op">=</span> (</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    freq_comparison_labeled</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">"year"</span>, <span class="st">"observed_commute_str"</span>, <span class="st">"observed_commute_cat"</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>        pl.<span class="bu">len</span>().alias(<span class="st">"count"</span>),</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"person_weight"</span>).<span class="bu">sum</span>().alias(<span class="st">"weighted_count"</span>),</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">100</span> <span class="op">*</span> pl.col(<span class="st">"weighted_count"</span>) <span class="op">/</span> pl.col(<span class="st">"weighted_count"</span>).<span class="bu">sum</span>().over(<span class="st">"year"</span>)).alias(<span class="st">"% (wtd)"</span>),</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">100</span> <span class="op">*</span> pl.col(<span class="st">"count"</span>) <span class="op">/</span> pl.col(<span class="st">"count"</span>).<span class="bu">sum</span>().over(<span class="st">"year"</span>)).alias(<span class="st">"% (unwtd)"</span>),</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"weighted_count"</span>).<span class="bu">round</span>(<span class="dv">2</span>),</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"% (wtd)"</span>).<span class="bu">round</span>(<span class="dv">2</span>),</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"% (unwtd)"</span>).<span class="bu">round</span>(<span class="dv">2</span>),</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">"observed_commute_cat"</span>)</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Observed Commute Frequency - 2019:"</span>)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(observed_commute_summary.<span class="bu">filter</span>(pl.col(<span class="st">"year"</span>) <span class="op">==</span> <span class="st">"2019"</span>).drop(<span class="st">"observed_commute_cat"</span>))</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Observed Commute Frequency - 2023:"</span>)</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(observed_commute_summary.<span class="bu">filter</span>(pl.col(<span class="st">"year"</span>) <span class="op">==</span> <span class="st">"2023"</span>).drop(<span class="st">"observed_commute_cat"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Observed Commute Frequency - 2019:
shape: (6, 6)

 year  observed_commute_str   count  weighted_count  % (wtd)  % (unwtd) 
 ---   ---                    ---    ---             ---      ---       
 str   str                    u32    f64             f64      f64       

 2019  Almost never           179    200729.28       6.28     5.72      
 2019  Less than once a week  52     71338.79        2.23     1.66      
 2019  1 day per week         225    289377.13       9.05     7.19      
 2019  2-3 days per week      937    1063075.8       33.24    29.94     
 2019  4 days per week        464    417632.35       13.06    14.82     
 2019  5+ days per week       1273   1.1559e6        36.14    40.67     


Observed Commute Frequency - 2023:
shape: (4, 6)

 year  observed_commute_str  count  weighted_count  % (wtd)  % (unwtd) 
 ---   ---                   ---    ---             ---      ---       
 str   str                   u32    f64             f64      f64       

 2023  Almost never          1870   950836.7        32.19    31.41     
 2023  1 day per week        586    221663.52       7.5      9.84      
 2023  2-3 days per week     1548   586200.76       19.84    26.0      
 2023  5+ days per week      1950   1.1953e6        40.46    32.75     
</code></pre>
</div>
</div>
<div id="cell-fig-observed-freq-bar" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_diverging_observed_by_year_chart(df):</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create diverging bar chart comparing 2019 vs 2023 observed frequencies."""</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter for each year and aggregate commute data</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    commute_2019 <span class="op">=</span> (</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>        df.<span class="bu">filter</span>(pl.col(<span class="st">"year"</span>) <span class="op">==</span> <span class="st">"2019"</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>        .group_by([<span class="st">"observed_commute_str"</span>, <span class="st">"observed_commute_cat"</span>])</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>        .agg(pl.col(<span class="st">"person_weight"</span>).<span class="bu">sum</span>().alias(<span class="st">"weight"</span>))</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>        .with_columns(</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>            (pl.col(<span class="st">"weight"</span>) <span class="op">/</span> pl.col(<span class="st">"weight"</span>).<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">100</span>).alias(<span class="st">"percentage"</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>        .sort(<span class="st">"observed_commute_cat"</span>, descending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    commute_2023 <span class="op">=</span> (</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>        df.<span class="bu">filter</span>(pl.col(<span class="st">"year"</span>) <span class="op">==</span> <span class="st">"2023"</span>)</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>        .group_by([<span class="st">"observed_commute_str"</span>, <span class="st">"observed_commute_cat"</span>])</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>        .agg(pl.col(<span class="st">"person_weight"</span>).<span class="bu">sum</span>().alias(<span class="st">"weight"</span>))</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>        .with_columns(</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>            (pl.col(<span class="st">"weight"</span>) <span class="op">/</span> pl.col(<span class="st">"weight"</span>).<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">100</span>).alias(<span class="st">"percentage"</span>)</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>        .sort(<span class="st">"observed_commute_cat"</span>, descending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Aggregate telework data</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>    telework_2019 <span class="op">=</span> (</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>        df.<span class="bu">filter</span>(pl.col(<span class="st">"year"</span>) <span class="op">==</span> <span class="st">"2019"</span>)</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>        .group_by([<span class="st">"observed_telework_str"</span>, <span class="st">"observed_telework_cat"</span>])</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>        .agg(pl.col(<span class="st">"person_weight"</span>).<span class="bu">sum</span>().alias(<span class="st">"weight"</span>))</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>        .with_columns(</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>            (pl.col(<span class="st">"weight"</span>) <span class="op">/</span> pl.col(<span class="st">"weight"</span>).<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">100</span>).alias(<span class="st">"percentage"</span>)</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>        .sort(<span class="st">"observed_telework_cat"</span>, descending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>    telework_2023 <span class="op">=</span> (</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>        df.<span class="bu">filter</span>(pl.col(<span class="st">"year"</span>) <span class="op">==</span> <span class="st">"2023"</span>)</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>        .group_by([<span class="st">"observed_telework_str"</span>, <span class="st">"observed_telework_cat"</span>])</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>        .agg(pl.col(<span class="st">"person_weight"</span>).<span class="bu">sum</span>().alias(<span class="st">"weight"</span>))</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>        .with_columns(</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>            (pl.col(<span class="st">"weight"</span>) <span class="op">/</span> pl.col(<span class="st">"weight"</span>).<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">100</span>).alias(<span class="st">"percentage"</span>)</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>        .sort(<span class="st">"observed_telework_cat"</span>, descending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Colors</span></span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>    commute_2019_color <span class="op">=</span> <span class="st">'rgba(59, 130, 246, 0.5)'</span>  <span class="co"># Light blue</span></span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a>    commute_2023_color <span class="op">=</span> <span class="st">'#3b82f6'</span>  <span class="co"># Full blue</span></span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a>    telework_2019_color <span class="op">=</span> <span class="st">'rgba(139, 92, 246, 0.5)'</span>  <span class="co"># Light purple</span></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a>    telework_2023_color <span class="op">=</span> <span class="st">'#8b5cf6'</span>  <span class="co"># Full purple</span></span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> go.Figure()</span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Commute 2019 (left side)</span></span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(go.Bar(</span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>commute_2019[<span class="st">"observed_commute_str"</span>],</span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=-</span>commute_2019[<span class="st">"percentage"</span>],</span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"2019"</span>,</span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a>        orientation<span class="op">=</span><span class="st">'h'</span>,</span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a>        marker_color<span class="op">=</span>commute_2019_color,</span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span>commute_2019[<span class="st">"percentage"</span>].<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a>        texttemplate<span class="op">=</span><span class="st">'%</span><span class="sc">{text}</span><span class="st">%'</span>,</span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a>        textposition<span class="op">=</span><span class="st">'inside'</span>,</span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a>        offsetgroup<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a>        legendgroup<span class="op">=</span><span class="st">'2019'</span>,</span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Commute 2023 (left side, dodged)</span></span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(go.Bar(</span>
<span id="cb37-70"><a href="#cb37-70" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>commute_2023[<span class="st">"observed_commute_str"</span>],</span>
<span id="cb37-71"><a href="#cb37-71" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=-</span>commute_2023[<span class="st">"percentage"</span>],</span>
<span id="cb37-72"><a href="#cb37-72" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"2023"</span>,</span>
<span id="cb37-73"><a href="#cb37-73" aria-hidden="true" tabindex="-1"></a>        orientation<span class="op">=</span><span class="st">'h'</span>,</span>
<span id="cb37-74"><a href="#cb37-74" aria-hidden="true" tabindex="-1"></a>        marker_color<span class="op">=</span>commute_2023_color,</span>
<span id="cb37-75"><a href="#cb37-75" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span>commute_2023[<span class="st">"percentage"</span>].<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb37-76"><a href="#cb37-76" aria-hidden="true" tabindex="-1"></a>        texttemplate<span class="op">=</span><span class="st">'%</span><span class="sc">{text}</span><span class="st">%'</span>,</span>
<span id="cb37-77"><a href="#cb37-77" aria-hidden="true" tabindex="-1"></a>        textposition<span class="op">=</span><span class="st">'inside'</span>,</span>
<span id="cb37-78"><a href="#cb37-78" aria-hidden="true" tabindex="-1"></a>        offsetgroup<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb37-79"><a href="#cb37-79" aria-hidden="true" tabindex="-1"></a>        legendgroup<span class="op">=</span><span class="st">'2023'</span>,</span>
<span id="cb37-80"><a href="#cb37-80" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb37-81"><a href="#cb37-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-82"><a href="#cb37-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Telework 2019 (right side)</span></span>
<span id="cb37-83"><a href="#cb37-83" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(go.Bar(</span>
<span id="cb37-84"><a href="#cb37-84" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>telework_2019[<span class="st">"observed_telework_str"</span>],</span>
<span id="cb37-85"><a href="#cb37-85" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>telework_2019[<span class="st">"percentage"</span>],</span>
<span id="cb37-86"><a href="#cb37-86" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"2019"</span>,</span>
<span id="cb37-87"><a href="#cb37-87" aria-hidden="true" tabindex="-1"></a>        orientation<span class="op">=</span><span class="st">'h'</span>,</span>
<span id="cb37-88"><a href="#cb37-88" aria-hidden="true" tabindex="-1"></a>        marker_color<span class="op">=</span>telework_2019_color,</span>
<span id="cb37-89"><a href="#cb37-89" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span>telework_2019[<span class="st">"percentage"</span>].<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb37-90"><a href="#cb37-90" aria-hidden="true" tabindex="-1"></a>        texttemplate<span class="op">=</span><span class="st">'%</span><span class="sc">{text}</span><span class="st">%'</span>,</span>
<span id="cb37-91"><a href="#cb37-91" aria-hidden="true" tabindex="-1"></a>        textposition<span class="op">=</span><span class="st">'inside'</span>,</span>
<span id="cb37-92"><a href="#cb37-92" aria-hidden="true" tabindex="-1"></a>        offsetgroup<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb37-93"><a href="#cb37-93" aria-hidden="true" tabindex="-1"></a>        legendgroup<span class="op">=</span><span class="st">'2019'</span>,</span>
<span id="cb37-94"><a href="#cb37-94" aria-hidden="true" tabindex="-1"></a>        showlegend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb37-95"><a href="#cb37-95" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb37-96"><a href="#cb37-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-97"><a href="#cb37-97" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Telework 2023 (right side, dodged)</span></span>
<span id="cb37-98"><a href="#cb37-98" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(go.Bar(</span>
<span id="cb37-99"><a href="#cb37-99" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>telework_2023[<span class="st">"observed_telework_str"</span>],</span>
<span id="cb37-100"><a href="#cb37-100" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>telework_2023[<span class="st">"percentage"</span>],</span>
<span id="cb37-101"><a href="#cb37-101" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"2023"</span>,</span>
<span id="cb37-102"><a href="#cb37-102" aria-hidden="true" tabindex="-1"></a>        orientation<span class="op">=</span><span class="st">'h'</span>,</span>
<span id="cb37-103"><a href="#cb37-103" aria-hidden="true" tabindex="-1"></a>        marker_color<span class="op">=</span>telework_2023_color,</span>
<span id="cb37-104"><a href="#cb37-104" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span>telework_2023[<span class="st">"percentage"</span>].<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb37-105"><a href="#cb37-105" aria-hidden="true" tabindex="-1"></a>        texttemplate<span class="op">=</span><span class="st">'%</span><span class="sc">{text}</span><span class="st">%'</span>,</span>
<span id="cb37-106"><a href="#cb37-106" aria-hidden="true" tabindex="-1"></a>        textposition<span class="op">=</span><span class="st">'inside'</span>,</span>
<span id="cb37-107"><a href="#cb37-107" aria-hidden="true" tabindex="-1"></a>        offsetgroup<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb37-108"><a href="#cb37-108" aria-hidden="true" tabindex="-1"></a>        legendgroup<span class="op">=</span><span class="st">'2023'</span>,</span>
<span id="cb37-109"><a href="#cb37-109" aria-hidden="true" tabindex="-1"></a>        showlegend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb37-110"><a href="#cb37-110" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb37-111"><a href="#cb37-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-112"><a href="#cb37-112" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(</span>
<span id="cb37-113"><a href="#cb37-113" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Observed Commute vs Telework Frequency: 2019 vs 2023"</span>,</span>
<span id="cb37-114"><a href="#cb37-114" aria-hidden="true" tabindex="-1"></a>        xaxis_title<span class="op">=</span><span class="st">" Commute Frequency | Telework Frequency &lt;br&gt;</span><span class="sc">% o</span><span class="st">f Responses (Weighted)"</span>,</span>
<span id="cb37-115"><a href="#cb37-115" aria-hidden="true" tabindex="-1"></a>        yaxis_title<span class="op">=</span><span class="st">""</span>,</span>
<span id="cb37-116"><a href="#cb37-116" aria-hidden="true" tabindex="-1"></a>        barmode<span class="op">=</span><span class="st">'group'</span>,</span>
<span id="cb37-117"><a href="#cb37-117" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span><span class="dv">600</span>,</span>
<span id="cb37-118"><a href="#cb37-118" aria-hidden="true" tabindex="-1"></a>        plot_bgcolor<span class="op">=</span><span class="st">'white'</span>,</span>
<span id="cb37-119"><a href="#cb37-119" aria-hidden="true" tabindex="-1"></a>        xaxis<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb37-120"><a href="#cb37-120" aria-hidden="true" tabindex="-1"></a>            tickvals<span class="op">=</span>[<span class="op">-</span><span class="dv">50</span>, <span class="op">-</span><span class="dv">40</span>, <span class="op">-</span><span class="dv">30</span>, <span class="op">-</span><span class="dv">20</span>, <span class="op">-</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>],</span>
<span id="cb37-121"><a href="#cb37-121" aria-hidden="true" tabindex="-1"></a>            ticktext<span class="op">=</span>[<span class="st">'50%'</span>, <span class="st">'40%'</span>, <span class="st">'30%'</span>, <span class="st">'20%'</span>, <span class="st">'10%'</span>, <span class="st">'0'</span>, <span class="st">'10%'</span>, <span class="st">'20%'</span>, <span class="st">'30%'</span>, <span class="st">'40%'</span>, <span class="st">'50%'</span>],</span>
<span id="cb37-122"><a href="#cb37-122" aria-hidden="true" tabindex="-1"></a>            gridcolor<span class="op">=</span><span class="st">'#e5e7eb'</span></span>
<span id="cb37-123"><a href="#cb37-123" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb37-124"><a href="#cb37-124" aria-hidden="true" tabindex="-1"></a>        yaxis<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb37-125"><a href="#cb37-125" aria-hidden="true" tabindex="-1"></a>            gridcolor<span class="op">=</span><span class="st">'#e5e7eb'</span></span>
<span id="cb37-126"><a href="#cb37-126" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb37-127"><a href="#cb37-127" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-128"><a href="#cb37-128" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-129"><a href="#cb37-129" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb37-130"><a href="#cb37-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-131"><a href="#cb37-131" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb37-132"><a href="#cb37-132" aria-hidden="true" tabindex="-1"></a>diverging_observed_fig <span class="op">=</span> create_diverging_observed_by_year_chart(freq_comparison_labeled)</span>
<span id="cb37-133"><a href="#cb37-133" aria-hidden="true" tabindex="-1"></a>diverging_observed_fig.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="fig-observed-freq-bar" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-observed-freq-bar-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>            <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG"></script><script type="text/javascript">if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}</script>                <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script charset="utf-8" src="https://cdn.plot.ly/plotly-3.2.0.min.js" integrity="sha256-iZ2u/oU2wf/vDbl/ChcX93WgbBRSBvUO6N413hDz7xM=" crossorigin="anonymous"></script>                <div id="577aa36c-dc02-4b4c-8527-cf84aa4d549c" class="plotly-graph-div" style="height:600px; width:100%;"></div>            <script type="text/javascript">                window.PLOTLYENV=window.PLOTLYENV || {};                                if (document.getElementById("577aa36c-dc02-4b4c-8527-cf84aa4d549c")) {                    Plotly.newPlot(                        "577aa36c-dc02-4b4c-8527-cf84aa4d549c",                        [{"legendgroup":"2019","marker":{"color":"rgba(59, 130, 246, 0.5)"},"name":"2019","offsetgroup":"0","orientation":"h","text":{"dtype":"f8","bdata":"zczMzMwMQkAzMzMzMzMqQJqZmZmZmUBAAAAAAAAAIkCamZmZmZkBQDMzMzMzMxlA"},"textposition":"inside","texttemplate":"%{text}%","x":{"dtype":"f8","bdata":"mkzWXokSQsBAYL3BFR4qwGNL6vLTnkDARJ6ue8gYIsDWQEu1ZNgBwLCifZwmGxnA"},"y":["5+ days per week","4 days per week","2-3 days per week","1 day per week","Less than once a week","Almost never"],"type":"bar"},{"legendgroup":"2023","marker":{"color":"#3b82f6"},"name":"2023","offsetgroup":"1","orientation":"h","text":{"dtype":"f8","bdata":"AAAAAABAREDNzMzMzMwzQAAAAAAAAB5AmpmZmZkZQEA="},"textposition":"inside","texttemplate":"%{text}%","x":{"dtype":"f8","bdata":"O\u002fSXwVU7RMCqHqt\u002fKNgzwKLk4bf1Ax7A3D+WRxcYQMA="},"y":["5+ days per week","2-3 days per week","1 day per week","Almost never"],"type":"bar"},{"legendgroup":"2019","marker":{"color":"rgba(139, 92, 246, 0.5)"},"name":"2019","offsetgroup":"0","orientation":"h","showlegend":false,"text":{"dtype":"f8","bdata":"MzMzMzMzGUAzMzMzMzMPQDMzMzMzszhAZmZmZmbmMkAzMzMzMzMkQM3MzMzMDEJA"},"textposition":"inside","texttemplate":"%{text}%","x":{"dtype":"f8","bdata":"saJ9nCYbGUCDQVQAdREPQA2qVthhqDhArpLdsOruMkB2curjUDUkQJlM1l6JEkJA"},"y":["5+ days per week","4 days per week","2-3 days per week","1 day per week","Less than once a week","Almost never"],"type":"bar"},{"legendgroup":"2023","marker":{"color":"#8b5cf6"},"name":"2023","offsetgroup":"1","orientation":"h","showlegend":false,"text":{"dtype":"f8","bdata":"mpmZmZkZQECamZmZmZkvQAAAAAAAACdAAAAAAABAREA="},"textposition":"inside","texttemplate":"%{text}%","x":{"dtype":"f8","bdata":"2z+WRxcYQECwW9PaxKUvQPTTcwCHDCdAPPSXwVU7REA="},"y":["5+ days per week","2-3 days per week","1 day per week","Almost never"],"type":"bar"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermap":[{"type":"scattermap","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"title":{"text":" Commute Frequency | Telework Frequency \u003cbr\u003e% of Responses (Weighted)"},"tickvals":[-50,-40,-30,-20,-10,0,10,20,30,40,50],"ticktext":["50%","40%","30%","20%","10%","0","10%","20%","30%","40%","50%"],"gridcolor":"#e5e7eb"},"yaxis":{"title":{"text":""},"gridcolor":"#e5e7eb"},"title":{"text":"Observed Commute vs Telework Frequency: 2019 vs 2023"},"barmode":"group","height":600,"plot_bgcolor":"white"},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('577aa36c-dc02-4b4c-8527-cf84aa4d549c');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };            </script>        </div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-observed-freq-bar-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Observed Telework and Commute Frequency: 2019 vs 2023
</figcaption>
</figure>
</div>
</div>
<div id="b04c1fc7" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_telework_distribution_by_year(df):</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create simple dodged bar chart of telework frequency by year."""</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Aggregate telework data by year</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    telework_data <span class="op">=</span> (</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>        df.group_by([<span class="st">"year"</span>, <span class="st">"observed_telework_str"</span>, <span class="st">"observed_telework_cat"</span>])</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>        .agg(pl.col(<span class="st">"person_weight"</span>).<span class="bu">sum</span>().alias(<span class="st">"weight"</span>))</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate percentages within each year</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    year_totals <span class="op">=</span> telework_data.group_by(<span class="st">"year"</span>).agg(pl.col(<span class="st">"weight"</span>).<span class="bu">sum</span>().alias(<span class="st">"total"</span>))</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    telework_data <span class="op">=</span> (</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>        telework_data</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>        .join(year_totals, on<span class="op">=</span><span class="st">"year"</span>)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>        .with_columns(</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>            (pl.col(<span class="st">"weight"</span>) <span class="op">/</span> pl.col(<span class="st">"total"</span>) <span class="op">*</span> <span class="dv">100</span>).alias(<span class="st">"percentage"</span>)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>        .sort(<span class="st">"observed_telework_cat"</span>)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to pandas for plotting</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="op">=</span> telework_data.to_pandas()</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create figure</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> go.Figure()</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Colors for years</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>    year_colors <span class="op">=</span> {</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"2019"</span>: <span class="st">"#3b82f6"</span>,  <span class="co"># Blue</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"2023"</span>: <span class="st">"#8b5cf6"</span>   <span class="co"># Purple</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> year <span class="kw">in</span> [<span class="st">"2019"</span>, <span class="st">"2023"</span>]:</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>        year_data <span class="op">=</span> plot_df[plot_df[<span class="st">'year'</span>] <span class="op">==</span> year].sort_values(<span class="st">'observed_telework_cat'</span>)</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>        fig.add_trace(go.Bar(</span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span>year,</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span>year_data[<span class="st">'observed_telework_str'</span>],</span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span>year_data[<span class="st">'percentage'</span>],</span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>            marker_color<span class="op">=</span>year_colors[year],</span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>            text<span class="op">=</span>year_data[<span class="st">'percentage'</span>].<span class="bu">round</span>(<span class="dv">1</span>),</span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>            texttemplate<span class="op">=</span><span class="st">'%</span><span class="sc">{text}</span><span class="st">%'</span>,</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>            textposition<span class="op">=</span><span class="st">'outside'</span>,</span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>        ))</span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Observed Telework Frequency: 2019 vs 2023"</span>,</span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a>        xaxis_title<span class="op">=</span><span class="st">"Telework Frequency"</span>,</span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>        yaxis_title<span class="op">=</span><span class="st">"</span><span class="sc">% o</span><span class="st">f Responses (Weighted)"</span>,</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>        barmode<span class="op">=</span><span class="st">'group'</span>,</span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span><span class="dv">500</span>,</span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span><span class="dv">900</span>,</span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>        plot_bgcolor<span class="op">=</span><span class="st">'white'</span>,</span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a>        font<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a>        yaxis_range<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">50</span>],</span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a>        legend<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a>            orientation<span class="op">=</span><span class="st">"h"</span>,</span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a>            yanchor<span class="op">=</span><span class="st">"bottom"</span>,</span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span><span class="fl">1.02</span>,</span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a>            xanchor<span class="op">=</span><span class="st">"center"</span>,</span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span><span class="fl">0.5</span></span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a>        xaxis<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a>            tickangle<span class="op">=-</span><span class="dv">45</span>,</span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a>            gridcolor<span class="op">=</span><span class="st">'#e5e7eb'</span></span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a>        yaxis<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a>            gridcolor<span class="op">=</span><span class="st">'#e5e7eb'</span>,</span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a>            ticksuffix<span class="op">=</span><span class="st">'%'</span></span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a>telework_by_year_fig <span class="op">=</span> create_telework_distribution_by_year(freq_comparison_labeled)</span>
<span id="cb38-78"><a href="#cb38-78" aria-hidden="true" tabindex="-1"></a>telework_by_year_fig.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>            <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG"></script><script type="text/javascript">if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}</script>                <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script charset="utf-8" src="https://cdn.plot.ly/plotly-3.2.0.min.js" integrity="sha256-iZ2u/oU2wf/vDbl/ChcX93WgbBRSBvUO6N413hDz7xM=" crossorigin="anonymous"></script>                <div id="630097ec-b1cb-4ff0-ba9d-927ec038955b" class="plotly-graph-div" style="height:500px; width:900px;"></div>            <script type="text/javascript">                window.PLOTLYENV=window.PLOTLYENV || {};                                if (document.getElementById("630097ec-b1cb-4ff0-ba9d-927ec038955b")) {                    Plotly.newPlot(                        "630097ec-b1cb-4ff0-ba9d-927ec038955b",                        [{"marker":{"color":"#3b82f6"},"name":"2019","text":{"dtype":"f8","bdata":"zczMzMwMQkAzMzMzMzMkQGZmZmZm5jJAMzMzMzOzOEAzMzMzMzMPQDMzMzMzMxlA"},"textposition":"outside","texttemplate":"%{text}%","x":["Almost never","Less than once a week","1 day per week","2-3 days per week","4 days per week","5+ days per week"],"y":{"dtype":"f8","bdata":"mkzWXokSQkB0curjUDUkQKyS3bDq7jJACapW2GGoOECAQVQAdREPQK6ifZwmGxlA"},"type":"bar"},{"marker":{"color":"#8b5cf6"},"name":"2023","text":{"dtype":"f8","bdata":"AAAAAABAREAAAAAAAAAnQJqZmZmZmS9AmpmZmZkZQEA="},"textposition":"outside","texttemplate":"%{text}%","x":["Almost never","1 day per week","2-3 days per week","5+ days per week"],"y":{"dtype":"f8","bdata":"O\u002fSXwVU7RED003MAhwwnQK9b09rEpS9A3D+WRxcYQEA="},"type":"bar"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermap":[{"type":"scattermap","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"font":{"size":12},"yaxis":{"title":{"text":"% of Responses (Weighted)"},"range":[0,50],"gridcolor":"#e5e7eb","ticksuffix":"%"},"legend":{"orientation":"h","yanchor":"bottom","y":1.02,"xanchor":"center","x":0.5},"xaxis":{"title":{"text":"Telework Frequency"},"tickangle":-45,"gridcolor":"#e5e7eb"},"title":{"text":"Observed Telework Frequency: 2019 vs 2023"},"barmode":"group","height":500,"width":900,"plot_bgcolor":"white"},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('630097ec-b1cb-4ff0-ba9d-927ec038955b');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };            </script>        </div>
</div>
</div>
</section>
<section id="stated-vs-observed-comparison" class="level3">
<h3 class="anchored" data-anchor-id="stated-vs-observed-comparison">Stated vs Observed Comparison</h3>
<p>Now lets compare the stated frequencies against the observed frequencies to identify discrepancies.</p>
<div id="proportional-confusion-matrix-func" class="cell" data-execution_count="28">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the order of categories</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>category_colors <span class="op">=</span> {</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Missing Response"</span>: <span class="st">'#94a3b8'</span>,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Almost never"</span>: <span class="st">'#ef4444'</span>,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Less than once a week"</span>: <span class="st">'#f97316'</span>,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"1 day per week"</span>: <span class="st">'#f59e0b'</span>,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2-3 days per week"</span>: <span class="st">'#84cc16'</span>,</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"4 days per week"</span>: <span class="st">'#22c55e'</span>,</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"5+ days per week"</span>: <span class="st">'#10b981'</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>category_order <span class="op">=</span> <span class="bu">list</span>(category_colors.keys())</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> <span class="bu">list</span>(category_colors.values())</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================================</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. PROPORTIONAL TILE CONFUSION MATRIX</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================================</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_proportional_tile_matrix(df, stated_col, observed_col, title):</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create a proportional tile confusion matrix."""</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create contingency table</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    contingency <span class="op">=</span> (</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>        df.group_by([stated_col, observed_col])</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>        .agg(pl.<span class="bu">len</span>().alias(<span class="st">"count"</span>))</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate row totals (total for each stated category)</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>    row_totals <span class="op">=</span> (</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>        contingency.group_by(stated_col)</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>        .agg(pl.col(<span class="st">"count"</span>).<span class="bu">sum</span>().alias(<span class="st">"row_total"</span>))</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Join and calculate proportions</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>    contingency <span class="op">=</span> (</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>        contingency</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>        .join(row_totals, on<span class="op">=</span>stated_col)</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>        .with_columns(</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>            (pl.col(<span class="st">"count"</span>) <span class="op">/</span> pl.col(<span class="st">"row_total"</span>)).alias(<span class="st">"proportion"</span>)</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create the plot</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> go.Figure()</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add tiles for each combination</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> stated_idx, stated_cat <span class="kw">in</span> <span class="bu">enumerate</span>(category_order):</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> observed_idx, observed_cat <span class="kw">in</span> <span class="bu">enumerate</span>(category_order):</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Get the data for this cell</span></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>            cell_data <span class="op">=</span> contingency.<span class="bu">filter</span>(</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>                (pl.col(stated_col) <span class="op">==</span> stated_cat) <span class="op">&amp;</span> </span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>                (pl.col(observed_col) <span class="op">==</span> observed_cat)</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(cell_data) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>                proportion <span class="op">=</span> cell_data[<span class="st">"proportion"</span>][<span class="dv">0</span>]</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>                count <span class="op">=</span> cell_data[<span class="st">"count"</span>][<span class="dv">0</span>]</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Calculate tile size based on square root of proportion</span></span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>                <span class="co"># This makes area proportional to proportion</span></span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>                size <span class="op">=</span> proportion <span class="op">**</span> <span class="fl">0.5</span></span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Tile dimensions</span></span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a>                tile_size <span class="op">=</span> <span class="fl">0.8</span>  <span class="co"># Maximum tile size</span></span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a>                actual_size <span class="op">=</span> size <span class="op">*</span> tile_size</span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a>                offset <span class="op">=</span> (tile_size <span class="op">-</span> actual_size) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Determine if this is a diagonal (perfect agreement)</span></span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a>                is_diagonal <span class="op">=</span> stated_idx <span class="op">==</span> observed_idx</span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Add rectangle</span></span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a>                fig.add_shape(</span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">type</span><span class="op">=</span><span class="st">"rect"</span>,</span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a>                    x0<span class="op">=</span>observed_idx <span class="op">+</span> offset,</span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a>                    y0<span class="op">=</span>stated_idx <span class="op">+</span> offset,</span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a>                    x1<span class="op">=</span>observed_idx <span class="op">+</span> offset <span class="op">+</span> actual_size,</span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a>                    y1<span class="op">=</span>stated_idx <span class="op">+</span> offset <span class="op">+</span> actual_size,</span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a>                    fillcolor<span class="op">=</span>category_colors[observed_cat],</span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a>                    line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a>                        color<span class="op">=</span><span class="st">'#1e40af'</span> <span class="cf">if</span> is_diagonal <span class="cf">else</span> <span class="st">'white'</span>,</span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a>                        width<span class="op">=</span><span class="dv">3</span> <span class="cf">if</span> is_diagonal <span class="cf">else</span> <span class="dv">1</span></span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a>                    ),</span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a>                    opacity<span class="op">=</span><span class="fl">1.0</span> <span class="cf">if</span> is_diagonal <span class="cf">else</span> <span class="fl">0.6</span>,</span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Add percentage text</span></span>
<span id="cb39-86"><a href="#cb39-86" aria-hidden="true" tabindex="-1"></a>                fig.add_annotation(</span>
<span id="cb39-87"><a href="#cb39-87" aria-hidden="true" tabindex="-1"></a>                    x<span class="op">=</span>observed_idx <span class="op">+</span> <span class="fl">0.4</span>,</span>
<span id="cb39-88"><a href="#cb39-88" aria-hidden="true" tabindex="-1"></a>                    y<span class="op">=</span>stated_idx <span class="op">+</span> <span class="fl">0.4</span>,</span>
<span id="cb39-89"><a href="#cb39-89" aria-hidden="true" tabindex="-1"></a>                    text<span class="op">=</span><span class="ss">f"</span><span class="sc">{</span>proportion<span class="op">*</span><span class="dv">100</span><span class="sc">:.0f}</span><span class="ss">%"</span>,</span>
<span id="cb39-90"><a href="#cb39-90" aria-hidden="true" tabindex="-1"></a>                    showarrow<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb39-91"><a href="#cb39-91" aria-hidden="true" tabindex="-1"></a>                    font<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">11</span>, color<span class="op">=</span><span class="st">'#1e293b'</span>, family<span class="op">=</span><span class="st">'Arial Black'</span>),</span>
<span id="cb39-92"><a href="#cb39-92" aria-hidden="true" tabindex="-1"></a>                    xanchor<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb39-93"><a href="#cb39-93" aria-hidden="true" tabindex="-1"></a>                    yanchor<span class="op">=</span><span class="st">'middle'</span></span>
<span id="cb39-94"><a href="#cb39-94" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb39-95"><a href="#cb39-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-96"><a href="#cb39-96" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update layout</span></span>
<span id="cb39-97"><a href="#cb39-97" aria-hidden="true" tabindex="-1"></a>    fig.update_xaxes(</span>
<span id="cb39-98"><a href="#cb39-98" aria-hidden="true" tabindex="-1"></a>        ticktext<span class="op">=</span>category_order,</span>
<span id="cb39-99"><a href="#cb39-99" aria-hidden="true" tabindex="-1"></a>        tickvals<span class="op">=</span><span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">len</span>(category_order))),</span>
<span id="cb39-100"><a href="#cb39-100" aria-hidden="true" tabindex="-1"></a>        tickangle<span class="op">=-</span><span class="dv">45</span>,</span>
<span id="cb39-101"><a href="#cb39-101" aria-hidden="true" tabindex="-1"></a>        side<span class="op">=</span><span class="st">'bottom'</span>,  <span class="co"># Changed from 'top' to 'bottom'</span></span>
<span id="cb39-102"><a href="#cb39-102" aria-hidden="true" tabindex="-1"></a>        title_text<span class="op">=</span><span class="st">"Observed Frequency"</span>,</span>
<span id="cb39-103"><a href="#cb39-103" aria-hidden="true" tabindex="-1"></a>        title_standoff<span class="op">=</span><span class="dv">25</span></span>
<span id="cb39-104"><a href="#cb39-104" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-105"><a href="#cb39-105" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-106"><a href="#cb39-106" aria-hidden="true" tabindex="-1"></a>    fig.update_yaxes(</span>
<span id="cb39-107"><a href="#cb39-107" aria-hidden="true" tabindex="-1"></a>        ticktext<span class="op">=</span>category_order,</span>
<span id="cb39-108"><a href="#cb39-108" aria-hidden="true" tabindex="-1"></a>        tickvals<span class="op">=</span><span class="bu">list</span>(<span class="bu">range</span>(<span class="bu">len</span>(category_order))),</span>
<span id="cb39-109"><a href="#cb39-109" aria-hidden="true" tabindex="-1"></a>        title_text<span class="op">=</span><span class="st">"Stated Frequency"</span>,</span>
<span id="cb39-110"><a href="#cb39-110" aria-hidden="true" tabindex="-1"></a>        autorange<span class="op">=</span><span class="va">True</span>  <span class="co"># Changed from "reversed" to True for low to high</span></span>
<span id="cb39-111"><a href="#cb39-111" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-112"><a href="#cb39-112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-113"><a href="#cb39-113" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(</span>
<span id="cb39-114"><a href="#cb39-114" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb39-115"><a href="#cb39-115" aria-hidden="true" tabindex="-1"></a>            text<span class="op">=</span><span class="ss">f"</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">&lt;br&gt;&lt;sub&gt;Tile size = proportion; Blue border = perfect agreement&lt;/sub&gt;"</span>,</span>
<span id="cb39-116"><a href="#cb39-116" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb39-117"><a href="#cb39-117" aria-hidden="true" tabindex="-1"></a>            xanchor<span class="op">=</span><span class="st">'center'</span></span>
<span id="cb39-118"><a href="#cb39-118" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb39-119"><a href="#cb39-119" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span><span class="dv">700</span>,</span>
<span id="cb39-120"><a href="#cb39-120" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span><span class="dv">700</span>,</span>
<span id="cb39-121"><a href="#cb39-121" aria-hidden="true" tabindex="-1"></a>        plot_bgcolor<span class="op">=</span><span class="st">'white'</span>,</span>
<span id="cb39-122"><a href="#cb39-122" aria-hidden="true" tabindex="-1"></a>        xaxis<span class="op">=</span><span class="bu">dict</span>(showgrid<span class="op">=</span><span class="va">False</span>, zeroline<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb39-123"><a href="#cb39-123" aria-hidden="true" tabindex="-1"></a>        yaxis<span class="op">=</span><span class="bu">dict</span>(showgrid<span class="op">=</span><span class="va">False</span>, zeroline<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb39-124"><a href="#cb39-124" aria-hidden="true" tabindex="-1"></a>        margin<span class="op">=</span><span class="bu">dict</span>(l<span class="op">=</span><span class="dv">150</span>, r<span class="op">=</span><span class="dv">50</span>, t<span class="op">=</span><span class="dv">100</span>, b<span class="op">=</span><span class="dv">150</span>)  <span class="co"># Adjusted margins: less top, more bottom</span></span>
<span id="cb39-125"><a href="#cb39-125" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-126"><a href="#cb39-126" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-127"><a href="#cb39-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb39-128"><a href="#cb39-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-129"><a href="#cb39-129" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================================</span></span>
<span id="cb39-130"><a href="#cb39-130" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. SANKEY DIAGRAM</span></span>
<span id="cb39-131"><a href="#cb39-131" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================================</span></span>
<span id="cb39-132"><a href="#cb39-132" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hex_to_rgba(hex_color, alpha<span class="op">=</span><span class="fl">0.4</span>):</span>
<span id="cb39-133"><a href="#cb39-133" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Convert hex color to rgba string."""</span></span>
<span id="cb39-134"><a href="#cb39-134" aria-hidden="true" tabindex="-1"></a>    hex_color <span class="op">=</span> hex_color.lstrip(<span class="st">'#'</span>)</span>
<span id="cb39-135"><a href="#cb39-135" aria-hidden="true" tabindex="-1"></a>    r, g, b <span class="op">=</span> <span class="bu">tuple</span>(<span class="bu">int</span>(hex_color[i:i<span class="op">+</span><span class="dv">2</span>], <span class="dv">16</span>) <span class="cf">for</span> i <span class="kw">in</span> (<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>))</span>
<span id="cb39-136"><a href="#cb39-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f'rgba(</span><span class="sc">{</span>r<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>g<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>b<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">)'</span></span>
<span id="cb39-137"><a href="#cb39-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-138"><a href="#cb39-138" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_sankey_diagram(df, stated_col, observed_col, title):</span>
<span id="cb39-139"><a href="#cb39-139" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create a Sankey diagram showing flows from stated to observed."""</span></span>
<span id="cb39-140"><a href="#cb39-140" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-141"><a href="#cb39-141" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create flow data</span></span>
<span id="cb39-142"><a href="#cb39-142" aria-hidden="true" tabindex="-1"></a>    flows <span class="op">=</span> (</span>
<span id="cb39-143"><a href="#cb39-143" aria-hidden="true" tabindex="-1"></a>        df.group_by([stated_col, observed_col])</span>
<span id="cb39-144"><a href="#cb39-144" aria-hidden="true" tabindex="-1"></a>        .agg(pl.<span class="bu">len</span>().alias(<span class="st">"count"</span>))</span>
<span id="cb39-145"><a href="#cb39-145" aria-hidden="true" tabindex="-1"></a>        .sort(<span class="st">"count"</span>, descending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-146"><a href="#cb39-146" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-147"><a href="#cb39-147" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-148"><a href="#cb39-148" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create node labels (stated categories on left, observed on right)</span></span>
<span id="cb39-149"><a href="#cb39-149" aria-hidden="true" tabindex="-1"></a>    stated_labels <span class="op">=</span> [<span class="ss">f"Stated: </span><span class="sc">{</span>cat<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> cat <span class="kw">in</span> category_order]</span>
<span id="cb39-150"><a href="#cb39-150" aria-hidden="true" tabindex="-1"></a>    observed_labels <span class="op">=</span> [<span class="ss">f"Observed: </span><span class="sc">{</span>cat<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> cat <span class="kw">in</span> category_order]</span>
<span id="cb39-151"><a href="#cb39-151" aria-hidden="true" tabindex="-1"></a>    all_labels <span class="op">=</span> stated_labels <span class="op">+</span> observed_labels</span>
<span id="cb39-152"><a href="#cb39-152" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-153"><a href="#cb39-153" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create mapping from category to node index</span></span>
<span id="cb39-154"><a href="#cb39-154" aria-hidden="true" tabindex="-1"></a>    stated_map <span class="op">=</span> {cat: i <span class="cf">for</span> i, cat <span class="kw">in</span> <span class="bu">enumerate</span>(category_order)}</span>
<span id="cb39-155"><a href="#cb39-155" aria-hidden="true" tabindex="-1"></a>    observed_map <span class="op">=</span> {cat: i <span class="op">+</span> <span class="bu">len</span>(category_order) <span class="cf">for</span> i, cat <span class="kw">in</span> <span class="bu">enumerate</span>(category_order)}</span>
<span id="cb39-156"><a href="#cb39-156" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-157"><a href="#cb39-157" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare Sankey data</span></span>
<span id="cb39-158"><a href="#cb39-158" aria-hidden="true" tabindex="-1"></a>    sources <span class="op">=</span> []</span>
<span id="cb39-159"><a href="#cb39-159" aria-hidden="true" tabindex="-1"></a>    targets <span class="op">=</span> []</span>
<span id="cb39-160"><a href="#cb39-160" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> []</span>
<span id="cb39-161"><a href="#cb39-161" aria-hidden="true" tabindex="-1"></a>    link_colors <span class="op">=</span> []</span>
<span id="cb39-162"><a href="#cb39-162" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-163"><a href="#cb39-163" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> flows.iter_rows(named<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb39-164"><a href="#cb39-164" aria-hidden="true" tabindex="-1"></a>        stated_cat <span class="op">=</span> row[stated_col]</span>
<span id="cb39-165"><a href="#cb39-165" aria-hidden="true" tabindex="-1"></a>        observed_cat <span class="op">=</span> row[observed_col]</span>
<span id="cb39-166"><a href="#cb39-166" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> row[<span class="st">'count'</span>]</span>
<span id="cb39-167"><a href="#cb39-167" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-168"><a href="#cb39-168" aria-hidden="true" tabindex="-1"></a>        source_idx <span class="op">=</span> stated_map[stated_cat]</span>
<span id="cb39-169"><a href="#cb39-169" aria-hidden="true" tabindex="-1"></a>        target_idx <span class="op">=</span> observed_map[observed_cat]</span>
<span id="cb39-170"><a href="#cb39-170" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-171"><a href="#cb39-171" aria-hidden="true" tabindex="-1"></a>        sources.append(source_idx)</span>
<span id="cb39-172"><a href="#cb39-172" aria-hidden="true" tabindex="-1"></a>        targets.append(target_idx)</span>
<span id="cb39-173"><a href="#cb39-173" aria-hidden="true" tabindex="-1"></a>        values.append(count)</span>
<span id="cb39-174"><a href="#cb39-174" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-175"><a href="#cb39-175" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Color links based on source category</span></span>
<span id="cb39-176"><a href="#cb39-176" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> category_colors[stated_cat]</span>
<span id="cb39-177"><a href="#cb39-177" aria-hidden="true" tabindex="-1"></a>        link_colors.append(hex_to_rgba(color, alpha<span class="op">=</span><span class="fl">0.4</span>))</span>
<span id="cb39-178"><a href="#cb39-178" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-179"><a href="#cb39-179" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create node colors</span></span>
<span id="cb39-180"><a href="#cb39-180" aria-hidden="true" tabindex="-1"></a>    node_colors <span class="op">=</span> colors <span class="op">+</span> colors  <span class="co"># Same colors for both sides</span></span>
<span id="cb39-181"><a href="#cb39-181" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-182"><a href="#cb39-182" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> go.Figure(data<span class="op">=</span>[go.Sankey(</span>
<span id="cb39-183"><a href="#cb39-183" aria-hidden="true" tabindex="-1"></a>        node<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb39-184"><a href="#cb39-184" aria-hidden="true" tabindex="-1"></a>            pad<span class="op">=</span><span class="dv">15</span>,</span>
<span id="cb39-185"><a href="#cb39-185" aria-hidden="true" tabindex="-1"></a>            thickness<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb39-186"><a href="#cb39-186" aria-hidden="true" tabindex="-1"></a>            line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"white"</span>, width<span class="op">=</span><span class="dv">2</span>),</span>
<span id="cb39-187"><a href="#cb39-187" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span>all_labels,</span>
<span id="cb39-188"><a href="#cb39-188" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span>node_colors,</span>
<span id="cb39-189"><a href="#cb39-189" aria-hidden="true" tabindex="-1"></a>            customdata<span class="op">=</span>[cat.split(<span class="st">': '</span>)[<span class="dv">1</span>] <span class="cf">for</span> cat <span class="kw">in</span> all_labels],</span>
<span id="cb39-190"><a href="#cb39-190" aria-hidden="true" tabindex="-1"></a>            hovertemplate<span class="op">=</span><span class="st">'%</span><span class="sc">{customdata}</span><span class="st">&lt;br&gt;Count: %</span><span class="sc">{value}</span><span class="st">&lt;extra&gt;&lt;/extra&gt;'</span></span>
<span id="cb39-191"><a href="#cb39-191" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb39-192"><a href="#cb39-192" aria-hidden="true" tabindex="-1"></a>        link<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb39-193"><a href="#cb39-193" aria-hidden="true" tabindex="-1"></a>            source<span class="op">=</span>sources,</span>
<span id="cb39-194"><a href="#cb39-194" aria-hidden="true" tabindex="-1"></a>            target<span class="op">=</span>targets,</span>
<span id="cb39-195"><a href="#cb39-195" aria-hidden="true" tabindex="-1"></a>            value<span class="op">=</span>values,</span>
<span id="cb39-196"><a href="#cb39-196" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span>link_colors,</span>
<span id="cb39-197"><a href="#cb39-197" aria-hidden="true" tabindex="-1"></a>            hovertemplate<span class="op">=</span><span class="st">'%</span><span class="sc">{source.customdata}</span><span class="st">  %</span><span class="sc">{target.customdata}</span><span class="st">&lt;br&gt;Count: %</span><span class="sc">{value}</span><span class="st">&lt;extra&gt;&lt;/extra&gt;'</span></span>
<span id="cb39-198"><a href="#cb39-198" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb39-199"><a href="#cb39-199" aria-hidden="true" tabindex="-1"></a>    )])</span>
<span id="cb39-200"><a href="#cb39-200" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-201"><a href="#cb39-201" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(</span>
<span id="cb39-202"><a href="#cb39-202" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb39-203"><a href="#cb39-203" aria-hidden="true" tabindex="-1"></a>            text<span class="op">=</span><span class="ss">f"</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">&lt;br&gt;&lt;sub&gt;Width of flows shows number of people&lt;/sub&gt;"</span>,</span>
<span id="cb39-204"><a href="#cb39-204" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb39-205"><a href="#cb39-205" aria-hidden="true" tabindex="-1"></a>            xanchor<span class="op">=</span><span class="st">'center'</span></span>
<span id="cb39-206"><a href="#cb39-206" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb39-207"><a href="#cb39-207" aria-hidden="true" tabindex="-1"></a>        font<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">11</span>),</span>
<span id="cb39-208"><a href="#cb39-208" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span><span class="dv">800</span>,</span>
<span id="cb39-209"><a href="#cb39-209" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="cb39-210"><a href="#cb39-210" aria-hidden="true" tabindex="-1"></a>        margin<span class="op">=</span><span class="bu">dict</span>(l<span class="op">=</span><span class="dv">20</span>, r<span class="op">=</span><span class="dv">20</span>, t<span class="op">=</span><span class="dv">80</span>, b<span class="op">=</span><span class="dv">40</span>)</span>
<span id="cb39-211"><a href="#cb39-211" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-212"><a href="#cb39-212" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-213"><a href="#cb39-213" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="stated-observed-discrepancy" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================================</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE THE PLOTS</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================================</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>telework_tile_fig <span class="op">=</span> create_proportional_tile_matrix(</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    freq_comparison_labeled,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stated_telework_str"</span>,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"observed_telework_str"</span>,</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Telework Frequency: Stated vs Observed"</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Telework plots</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>telework_sankey_fig <span class="op">=</span> create_sankey_diagram(</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    freq_comparison_labeled,</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stated_telework_str"</span>, </span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"observed_telework_str"</span>,</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Telework Frequency Flow: Stated  Observed"</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Commute plots</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>commute_tile_fig <span class="op">=</span> create_proportional_tile_matrix(</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    freq_comparison_labeled,</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stated_commute_str"</span>,</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"observed_commute_str"</span>,</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Commute Frequency: Stated vs Observed"</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>commute_sankey_fig <span class="op">=</span> create_sankey_diagram(</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>    freq_comparison_labeled,</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stated_commute_str"</span>,</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"observed_commute_str"</span>, </span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Commute Frequency Flow: Stated  Observed"</span></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plots (in Quarto, these will render automatically)</span></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>telework_tile_fig.show()</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>telework_sankey_fig.show()</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>commute_tile_fig.show()</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>commute_sankey_fig.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="stated-observed-discrepancy-1" class="cell-output cell-output-display">
<div>            <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG"></script><script type="text/javascript">if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}</script>                <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script charset="utf-8" src="https://cdn.plot.ly/plotly-3.2.0.min.js" integrity="sha256-iZ2u/oU2wf/vDbl/ChcX93WgbBRSBvUO6N413hDz7xM=" crossorigin="anonymous"></script>                <div id="73438d30-ed58-4e9a-b038-c5d430a40b01" class="plotly-graph-div" style="height:700px; width:700px;"></div>            <script type="text/javascript">                window.PLOTLYENV=window.PLOTLYENV || {};                                if (document.getElementById("73438d30-ed58-4e9a-b038-c5d430a40b01")) {                    Plotly.newPlot(                        "73438d30-ed58-4e9a-b038-c5d430a40b01",                        [],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermap":[{"type":"scattermap","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"shapes":[{"fillcolor":"#ef4444","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":1.1788916806429732,"x1":1.6211083193570266,"y0":0.17889168064297334,"y1":0.6211083193570267},{"fillcolor":"#f97316","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":2.305719095841794,"x1":2.494280904158207,"y0":0.3057190958417937,"y1":0.49428090415820636},{"fillcolor":"#f59e0b","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":3.305719095841794,"x1":3.494280904158207,"y0":0.3057190958417937,"y1":0.49428090415820636},{"fillcolor":"#84cc16","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":4.159629914969067,"x1":4.640370085030932,"y0":0.1596299149690674,"y1":0.6403700850309326},{"fillcolor":"#10b981","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":6.2114381916835875,"x1":6.588561808316413,"y0":0.21143819168358735,"y1":0.5885618083164127},{"fillcolor":"#ef4444","line":{"color":"#1e40af","width":3},"opacity":1.0,"type":"rect","x0":1.1020808052749975,"x1":1.6979191947250025,"y0":1.1020808052749975,"y1":1.6979191947250025},{"fillcolor":"#f97316","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":2.328663697172975,"x1":2.4713363028270248,"y0":1.328663697172975,"y1":1.4713363028270248},{"fillcolor":"#f59e0b","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":3.229160439928823,"x1":3.5708395600711773,"y0":1.2291604399288227,"y1":1.5708395600711773},{"fillcolor":"#84cc16","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":4.246463577236342,"x1":4.553536422763658,"y0":1.2464635772363417,"y1":1.5535364227636583},{"fillcolor":"#22c55e","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":5.357619921018469,"x1":5.4423800789815315,"y0":1.3576199210184687,"y1":1.442380078981531},{"fillcolor":"#10b981","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":6.292298440965221,"x1":6.507701559034779,"y0":1.292298440965221,"y1":1.5077015590347789},{"fillcolor":"#ef4444","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":1.0994825315330319,"x1":1.7005174684669684,"y0":2.099482531533032,"y1":2.7005174684669684},{"fillcolor":"#f97316","line":{"color":"#1e40af","width":3},"opacity":1.0,"type":"rect","x0":2.3011013269588925,"x1":2.498898673041108,"y0":2.3011013269588925,"y1":2.498898673041108},{"fillcolor":"#f59e0b","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":3.225403456125387,"x1":3.5745965438746135,"y0":2.225403456125387,"y1":2.5745965438746135},{"fillcolor":"#84cc16","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":4.25498607933037,"x1":4.545013920669629,"y0":2.2549860793303704,"y1":2.5450139206696294},{"fillcolor":"#22c55e","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":5.355771168839111,"x1":5.444228831160888,"y0":2.3557711688391114,"y1":2.4442288311608884},{"fillcolor":"#10b981","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":6.319755848872848,"x1":6.480244151127152,"y0":2.3197558488728482,"y1":2.4802441511271516},{"fillcolor":"#ef4444","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":1.1541538602101014,"x1":1.645846139789899,"y0":3.1541538602101014,"y1":3.645846139789899},{"fillcolor":"#f97316","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":2.295412303176869,"x1":2.5045876968231306,"y0":3.295412303176869,"y1":3.5045876968231306},{"fillcolor":"#f59e0b","line":{"color":"#1e40af","width":3},"opacity":1.0,"type":"rect","x0":3.191712828598188,"x1":3.608287171401812,"y0":3.191712828598188,"y1":3.608287171401812},{"fillcolor":"#84cc16","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":4.229934236699314,"x1":4.570065763300687,"y0":3.2299342366993136,"y1":3.570065763300687},{"fillcolor":"#22c55e","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":5.334699198551958,"x1":5.465300801448042,"y0":3.3346991985519576,"y1":3.4653008014480426},{"fillcolor":"#10b981","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":6.290223021829398,"x1":6.509776978170602,"y0":3.290223021829398,"y1":3.509776978170602},{"fillcolor":"#ef4444","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":1.2172174470471873,"x1":1.5827825529528128,"y0":4.2172174470471875,"y1":4.582782552952813},{"fillcolor":"#f97316","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":2.362689667615197,"x1":2.4373103323848033,"y0":4.3626896676151965,"y1":4.437310332384802},{"fillcolor":"#f59e0b","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":3.2122860111800535,"x1":3.5877139888199463,"y0":4.212286011180054,"y1":4.587713988819947},{"fillcolor":"#84cc16","line":{"color":"#1e40af","width":3},"opacity":1.0,"type":"rect","x0":4.159826055421992,"x1":4.640173944578008,"y0":4.159826055421992,"y1":4.640173944578008},{"fillcolor":"#22c55e","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":5.360426416443572,"x1":5.439573583556427,"y0":4.360426416443572,"y1":4.439573583556427},{"fillcolor":"#10b981","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":6.224750624351938,"x1":6.5752493756480614,"y0":4.224750624351938,"y1":4.5752493756480614},{"fillcolor":"#ef4444","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":1.2651316431322361,"x1":1.5348683568677641,"y0":5.265131643132236,"y1":5.534868356867763},{"fillcolor":"#f97316","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":2.374044572619078,"x1":2.425955427380922,"y0":5.374044572619078,"y1":5.425955427380922},{"fillcolor":"#f59e0b","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":3.29298303135041,"x1":3.50701696864959,"y0":5.29298303135041,"y1":5.50701696864959},{"fillcolor":"#84cc16","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":4.1496949229860745,"x1":4.650305077013926,"y0":5.1496949229860745,"y1":5.650305077013926},{"fillcolor":"#22c55e","line":{"color":"#1e40af","width":3},"opacity":1.0,"type":"rect","x0":5.368211223430439,"x1":5.431788776569562,"y0":5.368211223430439,"y1":5.431788776569562},{"fillcolor":"#10b981","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":6.143054378064971,"x1":6.656945621935029,"y0":5.143054378064971,"y1":5.656945621935029},{"fillcolor":"#ef4444","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":1.2820131195649185,"x1":1.5179868804350818,"y0":6.282013119564918,"y1":6.517986880435082},{"fillcolor":"#f97316","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":2.3574804797237814,"x1":2.442519520276219,"y0":6.357480479723781,"y1":6.442519520276218},{"fillcolor":"#f59e0b","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":3.305400039416642,"x1":3.494599960583358,"y0":6.305400039416642,"y1":6.494599960583358},{"fillcolor":"#84cc16","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":4.2423333990277365,"x1":4.557666600972263,"y0":6.2423333990277365,"y1":6.557666600972263},{"fillcolor":"#22c55e","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":5.348799717514904,"x1":5.451200282485097,"y0":6.348799717514904,"y1":6.451200282485097},{"fillcolor":"#10b981","line":{"color":"#1e40af","width":3},"opacity":1.0,"type":"rect","x0":6.071607235296506,"x1":6.728392764703495,"y0":6.071607235296506,"y1":6.728392764703495}],"annotations":[{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"31%","x":1.4,"xanchor":"center","y":0.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"6%","x":2.4,"xanchor":"center","y":0.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"6%","x":3.4,"xanchor":"center","y":0.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"36%","x":4.4,"xanchor":"center","y":0.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"22%","x":6.4,"xanchor":"center","y":0.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"55%","x":1.4,"xanchor":"center","y":1.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"3%","x":2.4,"xanchor":"center","y":1.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"18%","x":3.4,"xanchor":"center","y":1.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"15%","x":4.4,"xanchor":"center","y":1.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"1%","x":5.4,"xanchor":"center","y":1.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"7%","x":6.4,"xanchor":"center","y":1.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"56%","x":1.4,"xanchor":"center","y":2.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"6%","x":2.4,"xanchor":"center","y":2.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"19%","x":3.4,"xanchor":"center","y":2.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"13%","x":4.4,"xanchor":"center","y":2.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"1%","x":5.4,"xanchor":"center","y":2.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"4%","x":6.4,"xanchor":"center","y":2.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"38%","x":1.4,"xanchor":"center","y":3.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"7%","x":2.4,"xanchor":"center","y":3.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"27%","x":3.4,"xanchor":"center","y":3.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"18%","x":4.4,"xanchor":"center","y":3.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"3%","x":5.4,"xanchor":"center","y":3.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"8%","x":6.4,"xanchor":"center","y":3.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"21%","x":1.4,"xanchor":"center","y":4.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"1%","x":2.4,"xanchor":"center","y":4.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"22%","x":3.4,"xanchor":"center","y":4.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"36%","x":4.4,"xanchor":"center","y":4.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"1%","x":5.4,"xanchor":"center","y":4.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"19%","x":6.4,"xanchor":"center","y":4.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"11%","x":1.4,"xanchor":"center","y":5.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"0%","x":2.4,"xanchor":"center","y":5.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"7%","x":3.4,"xanchor":"center","y":5.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"39%","x":4.4,"xanchor":"center","y":5.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"1%","x":5.4,"xanchor":"center","y":5.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"41%","x":6.4,"xanchor":"center","y":5.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"9%","x":1.4,"xanchor":"center","y":6.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"1%","x":2.4,"xanchor":"center","y":6.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"6%","x":3.4,"xanchor":"center","y":6.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"16%","x":4.4,"xanchor":"center","y":6.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"2%","x":5.4,"xanchor":"center","y":6.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"67%","x":6.4,"xanchor":"center","y":6.4,"yanchor":"middle"}],"xaxis":{"title":{"text":"Observed Frequency","standoff":25},"ticktext":["Missing Response","Almost never","Less than once a week","1 day per week","2-3 days per week","4 days per week","5+ days per week"],"tickvals":[0,1,2,3,4,5,6],"tickangle":-45,"side":"bottom","showgrid":false,"zeroline":false},"yaxis":{"title":{"text":"Stated Frequency"},"ticktext":["Missing Response","Almost never","Less than once a week","1 day per week","2-3 days per week","4 days per week","5+ days per week"],"tickvals":[0,1,2,3,4,5,6],"autorange":true,"showgrid":false,"zeroline":false},"title":{"text":"Telework Frequency: Stated vs Observed\u003cbr\u003e\u003csub\u003eTile size = proportion; Blue border = perfect agreement\u003c\u002fsub\u003e","x":0.5,"xanchor":"center"},"margin":{"l":150,"r":50,"t":100,"b":150},"width":700,"height":700,"plot_bgcolor":"white"},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('73438d30-ed58-4e9a-b038-c5d430a40b01');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };            </script>        </div>
</div>
<div id="stated-observed-discrepancy-2" class="cell-output cell-output-display">
<div>            <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG"></script><script type="text/javascript">if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}</script>                <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script charset="utf-8" src="https://cdn.plot.ly/plotly-3.2.0.min.js" integrity="sha256-iZ2u/oU2wf/vDbl/ChcX93WgbBRSBvUO6N413hDz7xM=" crossorigin="anonymous"></script>                <div id="946b73f4-9053-45b7-a945-16a30064645a" class="plotly-graph-div" style="height:800px; width:1000px;"></div>            <script type="text/javascript">                window.PLOTLYENV=window.PLOTLYENV || {};                                if (document.getElementById("946b73f4-9053-45b7-a945-16a30064645a")) {                    Plotly.newPlot(                        "946b73f4-9053-45b7-a945-16a30064645a",                        [{"link":{"color":["rgba(16, 185, 129, 0.4)","rgba(239, 68, 68, 0.4)","rgba(249, 115, 22, 0.4)","rgba(132, 204, 22, 0.4)","rgba(132, 204, 22, 0.4)","rgba(239, 68, 68, 0.4)","rgba(132, 204, 22, 0.4)","rgba(249, 115, 22, 0.4)","rgba(132, 204, 22, 0.4)","rgba(245, 158, 11, 0.4)","rgba(239, 68, 68, 0.4)","rgba(16, 185, 129, 0.4)","rgba(249, 115, 22, 0.4)","rgba(245, 158, 11, 0.4)","rgba(34, 197, 94, 0.4)","rgba(34, 197, 94, 0.4)","rgba(245, 158, 11, 0.4)","rgba(239, 68, 68, 0.4)","rgba(16, 185, 129, 0.4)","rgba(249, 115, 22, 0.4)","rgba(16, 185, 129, 0.4)","rgba(249, 115, 22, 0.4)","rgba(239, 68, 68, 0.4)","rgba(245, 158, 11, 0.4)","rgba(245, 158, 11, 0.4)","rgba(34, 197, 94, 0.4)","rgba(34, 197, 94, 0.4)","rgba(16, 185, 129, 0.4)","rgba(249, 115, 22, 0.4)","rgba(239, 68, 68, 0.4)","rgba(245, 158, 11, 0.4)","rgba(16, 185, 129, 0.4)","rgba(132, 204, 22, 0.4)","rgba(132, 204, 22, 0.4)","rgba(148, 163, 184, 0.4)","rgba(148, 163, 184, 0.4)","rgba(148, 163, 184, 0.4)","rgba(34, 197, 94, 0.4)","rgba(34, 197, 94, 0.4)","rgba(148, 163, 184, 0.4)","rgba(148, 163, 184, 0.4)"],"hovertemplate":"%{source.customdata}  %{target.customdata}\u003cbr\u003eCount: %{value}\u003cextra\u003e\u003c\u002fextra\u003e","source":[6,1,2,4,4,1,4,2,4,3,1,6,2,3,5,5,3,1,6,2,6,2,1,3,3,5,5,6,2,1,3,6,4,4,0,0,0,5,5,0,0],"target":[13,8,8,11,10,10,8,10,13,8,11,11,11,10,13,11,11,13,8,9,10,13,9,13,9,8,10,12,12,12,12,9,12,9,11,8,13,12,9,10,9],"value":[1193,1186,1108,663,405,390,384,374,353,326,315,275,258,234,196,186,156,155,154,120,99,79,68,65,59,54,34,29,24,24,23,20,18,16,13,11,8,3,2,2,2]},"node":{"color":["#94a3b8","#ef4444","#f97316","#f59e0b","#84cc16","#22c55e","#10b981","#94a3b8","#ef4444","#f97316","#f59e0b","#84cc16","#22c55e","#10b981"],"customdata":["Missing Response","Almost never","Less than once a week","1 day per week","2-3 days per week","4 days per week","5+ days per week","Missing Response","Almost never","Less than once a week","1 day per week","2-3 days per week","4 days per week","5+ days per week"],"hovertemplate":"%{customdata}\u003cbr\u003eCount: %{value}\u003cextra\u003e\u003c\u002fextra\u003e","label":["Stated: Missing Response","Stated: Almost never","Stated: Less than once a week","Stated: 1 day per week","Stated: 2-3 days per week","Stated: 4 days per week","Stated: 5+ days per week","Observed: Missing Response","Observed: Almost never","Observed: Less than once a week","Observed: 1 day per week","Observed: 2-3 days per week","Observed: 4 days per week","Observed: 5+ days per week"],"line":{"color":"white","width":2},"pad":15,"thickness":20},"type":"sankey"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermap":[{"type":"scattermap","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"title":{"text":"Telework Frequency Flow: Stated  Observed\u003cbr\u003e\u003csub\u003eWidth of flows shows number of people\u003c\u002fsub\u003e","x":0.5,"xanchor":"center"},"font":{"size":11},"margin":{"l":20,"r":20,"t":80,"b":40},"height":800,"width":1000},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('946b73f4-9053-45b7-a945-16a30064645a');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };            </script>        </div>
</div>
<div id="stated-observed-discrepancy-3" class="cell-output cell-output-display">
<div>            <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG"></script><script type="text/javascript">if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}</script>                <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script charset="utf-8" src="https://cdn.plot.ly/plotly-3.2.0.min.js" integrity="sha256-iZ2u/oU2wf/vDbl/ChcX93WgbBRSBvUO6N413hDz7xM=" crossorigin="anonymous"></script>                <div id="8a8b22b9-2f10-4b27-a634-8488fa0704de" class="plotly-graph-div" style="height:700px; width:700px;"></div>            <script type="text/javascript">                window.PLOTLYENV=window.PLOTLYENV || {};                                if (document.getElementById("8a8b22b9-2f10-4b27-a634-8488fa0704de")) {                    Plotly.newPlot(                        "8a8b22b9-2f10-4b27-a634-8488fa0704de",                        [],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermap":[{"type":"scattermap","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"shapes":[{"fillcolor":"#ef4444","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":1.2081667390674913,"x1":1.5918332609325088,"y0":0.20816673906749122,"y1":0.5918332609325088},{"fillcolor":"#f59e0b","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":3.2557779489814402,"x1":3.5442220510185596,"y0":0.25577794898144046,"y1":0.5442220510185596},{"fillcolor":"#84cc16","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":4.192153903091735,"x1":4.607846096908266,"y0":0.19215390309173472,"y1":0.6078460969082653},{"fillcolor":"#22c55e","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":5.310557280900008,"x1":5.4894427190999915,"y0":0.31055728090000845,"y1":0.4894427190999916},{"fillcolor":"#10b981","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":6.173725830020305,"x1":6.626274169979696,"y0":0.1737258300203048,"y1":0.6262741699796952},{"fillcolor":"#ef4444","line":{"color":"#1e40af","width":3},"opacity":1.0,"type":"rect","x0":1.0630546303870454,"x1":1.7369453696129549,"y0":1.0630546303870454,"y1":1.7369453696129549},{"fillcolor":"#f97316","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":2.3725494593476992,"x1":2.4274505406523006,"y0":1.3725494593476995,"y1":1.4274505406523008},{"fillcolor":"#f59e0b","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":3.27571239107166,"x1":3.5242876089283404,"y0":1.27571239107166,"y1":1.5242876089283401},{"fillcolor":"#84cc16","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":4.2762186563487585,"x1":4.523781343651241,"y0":1.2762186563487585,"y1":1.5237813436512415},{"fillcolor":"#22c55e","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":5.345098918695399,"x1":5.454901081304602,"y0":1.3450989186953988,"y1":1.4549010813046013},{"fillcolor":"#10b981","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":6.290771220749106,"x1":6.509228779250894,"y0":1.2907712207491062,"y1":1.509228779250894},{"fillcolor":"#ef4444","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":1.0584111728565053,"x1":1.7415888271434947,"y0":2.0584111728565055,"y1":2.741588827143495},{"fillcolor":"#f59e0b","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":3.2469815888647986,"x1":3.5530184111352012,"y0":2.2469815888647986,"y1":2.5530184111352012},{"fillcolor":"#84cc16","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":4.29361826674315,"x1":4.506381733256851,"y0":2.2936182667431493,"y1":2.5063817332568505},{"fillcolor":"#10b981","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":6.307342750668615,"x1":6.492657249331385,"y0":2.3073427506686146,"y1":2.4926572493313857},{"fillcolor":"#ef4444","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":1.1472953322100934,"x1":1.6527046677899064,"y0":3.1472953322100934,"y1":3.6527046677899064},{"fillcolor":"#f97316","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":2.3625365675367322,"x1":2.4374634324632676,"y0":3.3625365675367322,"y1":3.4374634324632676},{"fillcolor":"#f59e0b","line":{"color":"#1e40af","width":3},"opacity":1.0,"type":"rect","x0":3.186425574827604,"x1":3.613574425172396,"y0":3.186425574827604,"y1":3.613574425172396},{"fillcolor":"#84cc16","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":4.227302109441057,"x1":4.572697890558944,"y0":3.2273021094410566,"y1":3.5726978905589433},{"fillcolor":"#22c55e","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":5.350440537221665,"x1":5.4495594627783355,"y0":3.350440537221665,"y1":3.449559462778335},{"fillcolor":"#10b981","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":6.27022286309539,"x1":6.5297771369046105,"y0":3.2702228630953902,"y1":3.5297771369046105},{"fillcolor":"#ef4444","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":1.2219670786689873,"x1":1.5780329213310125,"y0":4.221967078668987,"y1":4.578032921331013},{"fillcolor":"#f97316","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":2.3724192584243333,"x1":2.4275807415756665,"y0":4.372419258424333,"y1":4.4275807415756665},{"fillcolor":"#f59e0b","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":3.254927746293226,"x1":3.5450722537067736,"y0":4.254927746293226,"y1":4.545072253706774},{"fillcolor":"#84cc16","line":{"color":"#1e40af","width":3},"opacity":1.0,"type":"rect","x0":4.13054809010039,"x1":4.6694519098996095,"y0":4.13054809010039,"y1":4.6694519098996095},{"fillcolor":"#22c55e","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":5.352228754280518,"x1":5.4477712457194825,"y0":4.352228754280518,"y1":4.4477712457194825},{"fillcolor":"#10b981","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":6.222204614360269,"x1":6.577795385639732,"y0":4.222204614360269,"y1":4.577795385639732},{"fillcolor":"#ef4444","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":1.288598285688117,"x1":1.5114017143118827,"y0":5.288598285688117,"y1":5.511401714311883},{"fillcolor":"#f97316","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":2.361686948591154,"x1":2.438313051408846,"y0":5.361686948591154,"y1":5.438313051408846},{"fillcolor":"#f59e0b","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":3.2934974852188352,"x1":3.506502514781165,"y0":5.293497485218835,"y1":5.5065025147811655},{"fillcolor":"#84cc16","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":4.153050301759209,"x1":4.646949698240791,"y0":5.153050301759209,"y1":5.646949698240791},{"fillcolor":"#22c55e","line":{"color":"#1e40af","width":3},"opacity":1.0,"type":"rect","x0":5.285060845773462,"x1":5.514939154226538,"y0":5.285060845773462,"y1":5.514939154226538},{"fillcolor":"#10b981","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":6.153862193375591,"x1":6.6461378066244094,"y0":5.153862193375591,"y1":5.6461378066244094},{"fillcolor":"#ef4444","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":1.3141082150570713,"x1":1.4858917849429285,"y0":6.314108215057072,"y1":6.485891784942929},{"fillcolor":"#f97316","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":2.369370499329884,"x1":2.430629500670116,"y0":6.369370499329884,"y1":6.430629500670117},{"fillcolor":"#f59e0b","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":3.319755172070833,"x1":3.4802448279291673,"y0":6.319755172070833,"y1":6.480244827929168},{"fillcolor":"#84cc16","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":4.203441117076103,"x1":4.596558882923896,"y0":6.203441117076103,"y1":6.596558882923896},{"fillcolor":"#22c55e","line":{"color":"white","width":1},"opacity":0.6,"type":"rect","x0":5.286516676032276,"x1":5.513483323967724,"y0":6.286516676032276,"y1":6.513483323967724},{"fillcolor":"#10b981","line":{"color":"#1e40af","width":3},"opacity":1.0,"type":"rect","x0":6.093844249958322,"x1":6.7061557500416775,"y0":6.093844249958322,"y1":6.7061557500416775}],"annotations":[{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"23%","x":1.4,"xanchor":"center","y":0.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"13%","x":3.4,"xanchor":"center","y":0.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"27%","x":4.4,"xanchor":"center","y":0.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"5%","x":5.4,"xanchor":"center","y":0.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"32%","x":6.4,"xanchor":"center","y":0.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"71%","x":1.4,"xanchor":"center","y":1.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"0%","x":2.4,"xanchor":"center","y":1.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"10%","x":3.4,"xanchor":"center","y":1.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"10%","x":4.4,"xanchor":"center","y":1.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"2%","x":5.4,"xanchor":"center","y":1.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"7%","x":6.4,"xanchor":"center","y":1.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"73%","x":1.4,"xanchor":"center","y":2.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"15%","x":3.4,"xanchor":"center","y":2.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"7%","x":4.4,"xanchor":"center","y":2.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"5%","x":6.4,"xanchor":"center","y":2.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"40%","x":1.4,"xanchor":"center","y":3.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"1%","x":2.4,"xanchor":"center","y":3.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"29%","x":3.4,"xanchor":"center","y":3.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"19%","x":4.4,"xanchor":"center","y":3.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"2%","x":5.4,"xanchor":"center","y":3.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"11%","x":6.4,"xanchor":"center","y":3.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"20%","x":1.4,"xanchor":"center","y":4.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"0%","x":2.4,"xanchor":"center","y":4.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"13%","x":3.4,"xanchor":"center","y":4.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"45%","x":4.4,"xanchor":"center","y":4.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"1%","x":5.4,"xanchor":"center","y":4.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"20%","x":6.4,"xanchor":"center","y":4.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"8%","x":1.4,"xanchor":"center","y":5.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"1%","x":2.4,"xanchor":"center","y":5.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"7%","x":3.4,"xanchor":"center","y":5.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"38%","x":4.4,"xanchor":"center","y":5.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"8%","x":5.4,"xanchor":"center","y":5.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"38%","x":6.4,"xanchor":"center","y":5.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"5%","x":1.4,"xanchor":"center","y":6.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"1%","x":2.4,"xanchor":"center","y":6.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"4%","x":3.4,"xanchor":"center","y":6.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"24%","x":4.4,"xanchor":"center","y":6.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"8%","x":5.4,"xanchor":"center","y":6.4,"yanchor":"middle"},{"font":{"color":"#1e293b","family":"Arial Black","size":11},"showarrow":false,"text":"59%","x":6.4,"xanchor":"center","y":6.4,"yanchor":"middle"}],"xaxis":{"title":{"text":"Observed Frequency","standoff":25},"ticktext":["Missing Response","Almost never","Less than once a week","1 day per week","2-3 days per week","4 days per week","5+ days per week"],"tickvals":[0,1,2,3,4,5,6],"tickangle":-45,"side":"bottom","showgrid":false,"zeroline":false},"yaxis":{"title":{"text":"Stated Frequency"},"ticktext":["Missing Response","Almost never","Less than once a week","1 day per week","2-3 days per week","4 days per week","5+ days per week"],"tickvals":[0,1,2,3,4,5,6],"autorange":true,"showgrid":false,"zeroline":false},"title":{"text":"Commute Frequency: Stated vs Observed\u003cbr\u003e\u003csub\u003eTile size = proportion; Blue border = perfect agreement\u003c\u002fsub\u003e","x":0.5,"xanchor":"center"},"margin":{"l":150,"r":50,"t":100,"b":150},"width":700,"height":700,"plot_bgcolor":"white"},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('8a8b22b9-2f10-4b27-a634-8488fa0704de');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };            </script>        </div>
</div>
<div id="stated-observed-discrepancy-4" class="cell-output cell-output-display">
<div>            <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG"></script><script type="text/javascript">if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}</script>                <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script charset="utf-8" src="https://cdn.plot.ly/plotly-3.2.0.min.js" integrity="sha256-iZ2u/oU2wf/vDbl/ChcX93WgbBRSBvUO6N413hDz7xM=" crossorigin="anonymous"></script>                <div id="89eb9c2e-ed43-4e49-bdb6-13a26cf83a35" class="plotly-graph-div" style="height:800px; width:1000px;"></div>            <script type="text/javascript">                window.PLOTLYENV=window.PLOTLYENV || {};                                if (document.getElementById("89eb9c2e-ed43-4e49-bdb6-13a26cf83a35")) {                    Plotly.newPlot(                        "89eb9c2e-ed43-4e49-bdb6-13a26cf83a35",                        [{"link":{"color":["rgba(16, 185, 129, 0.4)","rgba(16, 185, 129, 0.4)","rgba(239, 68, 68, 0.4)","rgba(132, 204, 22, 0.4)","rgba(34, 197, 94, 0.4)","rgba(34, 197, 94, 0.4)","rgba(132, 204, 22, 0.4)","rgba(132, 204, 22, 0.4)","rgba(16, 185, 129, 0.4)","rgba(249, 115, 22, 0.4)","rgba(132, 204, 22, 0.4)","rgba(245, 158, 11, 0.4)","rgba(16, 185, 129, 0.4)","rgba(16, 185, 129, 0.4)","rgba(245, 158, 11, 0.4)","rgba(239, 68, 68, 0.4)","rgba(239, 68, 68, 0.4)","rgba(34, 197, 94, 0.4)","rgba(239, 68, 68, 0.4)","rgba(34, 197, 94, 0.4)","rgba(245, 158, 11, 0.4)","rgba(34, 197, 94, 0.4)","rgba(249, 115, 22, 0.4)","rgba(245, 158, 11, 0.4)","rgba(148, 163, 184, 0.4)","rgba(249, 115, 22, 0.4)","rgba(132, 204, 22, 0.4)","rgba(148, 163, 184, 0.4)","rgba(239, 68, 68, 0.4)","rgba(148, 163, 184, 0.4)","rgba(249, 115, 22, 0.4)","rgba(16, 185, 129, 0.4)","rgba(148, 163, 184, 0.4)","rgba(34, 197, 94, 0.4)","rgba(132, 204, 22, 0.4)","rgba(245, 158, 11, 0.4)","rgba(239, 68, 68, 0.4)","rgba(148, 163, 184, 0.4)","rgba(245, 158, 11, 0.4)"],"hovertemplate":"%{source.customdata}  %{target.customdata}\u003cbr\u003eCount: %{value}\u003cextra\u003e\u003c\u002fextra\u003e","source":[6,6,1,4,5,5,4,4,6,2,4,3,6,6,3,1,1,5,1,5,3,5,2,3,0,2,4,0,1,0,2,6,0,5,4,3,1,0,3],"target":[13,11,8,11,11,13,8,13,12,8,10,8,8,10,10,10,11,12,13,8,11,10,10,13,13,11,12,11,12,8,13,9,10,9,9,12,9,12,9],"value":[2198,906,904,859,457,454,375,374,302,299,249,182,173,151,130,123,122,99,95,93,85,85,60,48,32,29,27,27,24,23,22,22,13,11,9,7,6,5,4]},"node":{"color":["#94a3b8","#ef4444","#f97316","#f59e0b","#84cc16","#22c55e","#10b981","#94a3b8","#ef4444","#f97316","#f59e0b","#84cc16","#22c55e","#10b981"],"customdata":["Missing Response","Almost never","Less than once a week","1 day per week","2-3 days per week","4 days per week","5+ days per week","Missing Response","Almost never","Less than once a week","1 day per week","2-3 days per week","4 days per week","5+ days per week"],"hovertemplate":"%{customdata}\u003cbr\u003eCount: %{value}\u003cextra\u003e\u003c\u002fextra\u003e","label":["Stated: Missing Response","Stated: Almost never","Stated: Less than once a week","Stated: 1 day per week","Stated: 2-3 days per week","Stated: 4 days per week","Stated: 5+ days per week","Observed: Missing Response","Observed: Almost never","Observed: Less than once a week","Observed: 1 day per week","Observed: 2-3 days per week","Observed: 4 days per week","Observed: 5+ days per week"],"line":{"color":"white","width":2},"pad":15,"thickness":20},"type":"sankey"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermap":[{"type":"scattermap","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"title":{"text":"Commute Frequency Flow: Stated  Observed\u003cbr\u003e\u003csub\u003eWidth of flows shows number of people\u003c\u002fsub\u003e","x":0.5,"xanchor":"center"},"font":{"size":11},"margin":{"l":20,"r":20,"t":80,"b":40},"height":800,"width":1000},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('89eb9c2e-ed43-4e49-bdb6-13a26cf83a35');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };            </script>        </div>
</div>
</div>
</section>
</section>
<section id="reporting-discrepancies" class="level2">
<h2 class="anchored" data-anchor-id="reporting-discrepancies">Reporting Discrepancies</h2>
<div id="6276f4a9" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_magnitude_bar_chart(df, year):</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create bar chart showing magnitude of reporting differences."""</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.<span class="bu">filter</span>(pl.col(<span class="st">"year"</span>) <span class="op">==</span> <span class="bu">str</span>(year))</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate differences</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    df_with_diff <span class="op">=</span> df.with_columns([</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>        (pl.col(<span class="st">"observed_commute_cat"</span>) <span class="op">-</span> pl.col(<span class="st">"stated_commute_freq"</span>)).alias(<span class="st">"commute_diff"</span>),</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>        (pl.col(<span class="st">"observed_telework_cat"</span>) <span class="op">-</span> pl.col(<span class="st">"stated_telework_freq"</span>)).alias(<span class="st">"telework_diff"</span>),</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Aggregate by difference value with weights</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    commute_summary <span class="op">=</span> (</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>        df_with_diff</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>        .group_by(<span class="st">"commute_diff"</span>)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>        .agg(pl.col(<span class="st">"person_weight"</span>).<span class="bu">sum</span>().alias(<span class="st">"weight"</span>))</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>        .with_columns(pl.lit(<span class="st">"Commute"</span>).alias(<span class="st">"type"</span>))</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    telework_summary <span class="op">=</span> (</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>        df_with_diff</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>        .group_by(<span class="st">"telework_diff"</span>)</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>        .agg(pl.col(<span class="st">"person_weight"</span>).<span class="bu">sum</span>().alias(<span class="st">"weight"</span>))</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>        .with_columns(pl.lit(<span class="st">"Telework"</span>).alias(<span class="st">"type"</span>))</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine</span></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>    plot_data <span class="op">=</span> pl.concat([</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>        commute_summary.select([<span class="st">"type"</span>, pl.col(<span class="st">"commute_diff"</span>).alias(<span class="st">"difference"</span>), <span class="st">"weight"</span>]),</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>        telework_summary.select([<span class="st">"type"</span>, pl.col(<span class="st">"telework_diff"</span>).alias(<span class="st">"difference"</span>), <span class="st">"weight"</span>])</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate percentages within each type</span></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>    type_totals <span class="op">=</span> plot_data.group_by(<span class="st">"type"</span>).agg(pl.col(<span class="st">"weight"</span>).<span class="bu">sum</span>().alias(<span class="st">"total"</span>))</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>    plot_data <span class="op">=</span> (</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>        plot_data</span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>        .join(type_totals, on<span class="op">=</span><span class="st">"type"</span>)</span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>        .with_columns(</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>            (pl.col(<span class="st">"weight"</span>) <span class="op">/</span> pl.col(<span class="st">"total"</span>) <span class="op">*</span> <span class="dv">100</span>).alias(<span class="st">"percentage"</span>)</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>        .sort(<span class="st">"difference"</span>)</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="op">=</span> plot_data.to_pandas()</span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create grouped bar chart</span></span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> go.Figure()</span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> freq_type, color <span class="kw">in</span> [(<span class="st">"Commute"</span>, <span class="st">"#3b82f6"</span>), (<span class="st">"Telework"</span>, <span class="st">"#8b5cf6"</span>)]:</span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a>        type_data <span class="op">=</span> plot_df[plot_df[<span class="st">'type'</span>] <span class="op">==</span> freq_type].sort_values(<span class="st">'difference'</span>)</span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>        fig.add_trace(go.Bar(</span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a>            name<span class="op">=</span>freq_type,</span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span>type_data[<span class="st">'difference'</span>],</span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span>type_data[<span class="st">'percentage'</span>],</span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>            marker_color<span class="op">=</span>color,</span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a>            text<span class="op">=</span>type_data[<span class="st">'percentage'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span>x<span class="sc">:.1f}</span><span class="ss">%"</span> <span class="cf">if</span> x <span class="op">&gt;</span> <span class="dv">2</span> <span class="cf">else</span> <span class="st">""</span>),</span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>            textposition<span class="op">=</span><span class="st">'outside'</span>,</span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a>            textfont<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>            hovertemplate<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>freq_type<span class="sc">}</span><span class="ss">&lt;br&gt;Difference: %</span><span class="ch">{{</span><span class="ss">x</span><span class="ch">}}</span><span class="ss">&lt;br&gt;Percentage: %</span><span class="ch">{{</span><span class="ss">y:.1f</span><span class="ch">}}</span><span class="ss">%&lt;extra&gt;&lt;/extra&gt;'</span>,</span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a>            width<span class="op">=</span><span class="fl">0.4</span></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a>        ))</span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # Add vertical line at 0</span></span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fig.add_vline(</span></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     x=0,</span></span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     line_dash="dash",</span></span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     line_color="#22c55e",</span></span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     line_width=3,</span></span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     annotation_text="Accurate",</span></span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     annotation_position="top"</span></span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># )</span></span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(</span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a>            text<span class="op">=</span><span class="ss">f"Magnitude of Reporting Discrepancies for </span><span class="sc">{</span><span class="bu">str</span>(year)<span class="sc">}</span><span class="ss">&lt;br&gt;&lt;sub&gt;Difference = Observed - Stated (category levels)&lt;/sub&gt;"</span>,</span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a>            xanchor<span class="op">=</span><span class="st">'center'</span></span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true" tabindex="-1"></a>        xaxis_title<span class="op">=</span><span class="st">"Difference (Observed - Stated)"</span>,</span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a>        yaxis_title<span class="op">=</span><span class="st">"Percentage of Responses"</span>,</span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a>        yaxis_range<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">55</span>],</span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span><span class="dv">500</span>,</span>
<span id="cb41-84"><a href="#cb41-84" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span><span class="dv">900</span>,</span>
<span id="cb41-85"><a href="#cb41-85" aria-hidden="true" tabindex="-1"></a>        plot_bgcolor<span class="op">=</span><span class="st">'white'</span>,</span>
<span id="cb41-86"><a href="#cb41-86" aria-hidden="true" tabindex="-1"></a>        font<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb41-87"><a href="#cb41-87" aria-hidden="true" tabindex="-1"></a>        barmode<span class="op">=</span><span class="st">'group'</span>,</span>
<span id="cb41-88"><a href="#cb41-88" aria-hidden="true" tabindex="-1"></a>        bargap<span class="op">=</span><span class="fl">0.15</span>,</span>
<span id="cb41-89"><a href="#cb41-89" aria-hidden="true" tabindex="-1"></a>        bargroupgap<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb41-90"><a href="#cb41-90" aria-hidden="true" tabindex="-1"></a>        legend<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb41-91"><a href="#cb41-91" aria-hidden="true" tabindex="-1"></a>            orientation<span class="op">=</span><span class="st">"h"</span>,</span>
<span id="cb41-92"><a href="#cb41-92" aria-hidden="true" tabindex="-1"></a>            yanchor<span class="op">=</span><span class="st">"bottom"</span>,</span>
<span id="cb41-93"><a href="#cb41-93" aria-hidden="true" tabindex="-1"></a>            xanchor<span class="op">=</span><span class="st">"center"</span>,</span>
<span id="cb41-94"><a href="#cb41-94" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span><span class="fl">0.5</span></span>
<span id="cb41-95"><a href="#cb41-95" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb41-96"><a href="#cb41-96" aria-hidden="true" tabindex="-1"></a>        yaxis<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb41-97"><a href="#cb41-97" aria-hidden="true" tabindex="-1"></a>            gridcolor<span class="op">=</span><span class="st">'#e5e7eb'</span>,</span>
<span id="cb41-98"><a href="#cb41-98" aria-hidden="true" tabindex="-1"></a>            ticksuffix<span class="op">=</span><span class="st">'%'</span></span>
<span id="cb41-99"><a href="#cb41-99" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb41-100"><a href="#cb41-100" aria-hidden="true" tabindex="-1"></a>        <span class="co"># xaxis=dict(</span></span>
<span id="cb41-101"><a href="#cb41-101" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     gridcolor='#e5e7eb',</span></span>
<span id="cb41-102"><a href="#cb41-102" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     dtick=1,</span></span>
<span id="cb41-103"><a href="#cb41-103" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     zeroline=True,</span></span>
<span id="cb41-104"><a href="#cb41-104" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     zerolinewidth=3,</span></span>
<span id="cb41-105"><a href="#cb41-105" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     zerolinecolor='#22c55e'</span></span>
<span id="cb41-106"><a href="#cb41-106" aria-hidden="true" tabindex="-1"></a>        <span class="co"># )</span></span>
<span id="cb41-107"><a href="#cb41-107" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-108"><a href="#cb41-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-109"><a href="#cb41-109" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add interpretation annotations</span></span>
<span id="cb41-110"><a href="#cb41-110" aria-hidden="true" tabindex="-1"></a>    fig.add_annotation(</span>
<span id="cb41-111"><a href="#cb41-111" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="fl">0.20</span>, y<span class="op">=</span><span class="fl">0.98</span>,</span>
<span id="cb41-112"><a href="#cb41-112" aria-hidden="true" tabindex="-1"></a>        xref<span class="op">=</span><span class="st">"paper"</span>, yref<span class="op">=</span><span class="st">"paper"</span>,</span>
<span id="cb41-113"><a href="#cb41-113" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span><span class="st">" Under-reported"</span>,</span>
<span id="cb41-114"><a href="#cb41-114" aria-hidden="true" tabindex="-1"></a>        showarrow<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb41-115"><a href="#cb41-115" aria-hidden="true" tabindex="-1"></a>        font<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">11</span>, color<span class="op">=</span><span class="st">'#64748b'</span>, weight<span class="op">=</span><span class="st">'bold'</span>),</span>
<span id="cb41-116"><a href="#cb41-116" aria-hidden="true" tabindex="-1"></a>        xanchor<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb41-117"><a href="#cb41-117" aria-hidden="true" tabindex="-1"></a>        yanchor<span class="op">=</span><span class="st">'top'</span></span>
<span id="cb41-118"><a href="#cb41-118" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-119"><a href="#cb41-119" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-120"><a href="#cb41-120" aria-hidden="true" tabindex="-1"></a>    fig.add_annotation(</span>
<span id="cb41-121"><a href="#cb41-121" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="fl">0.7</span>, y<span class="op">=</span><span class="fl">0.98</span>,</span>
<span id="cb41-122"><a href="#cb41-122" aria-hidden="true" tabindex="-1"></a>        xref<span class="op">=</span><span class="st">"paper"</span>, yref<span class="op">=</span><span class="st">"paper"</span>,</span>
<span id="cb41-123"><a href="#cb41-123" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span><span class="st">"Over-reported "</span>,</span>
<span id="cb41-124"><a href="#cb41-124" aria-hidden="true" tabindex="-1"></a>        showarrow<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb41-125"><a href="#cb41-125" aria-hidden="true" tabindex="-1"></a>        font<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">11</span>, color<span class="op">=</span><span class="st">'#64748b'</span>, weight<span class="op">=</span><span class="st">'bold'</span>),</span>
<span id="cb41-126"><a href="#cb41-126" aria-hidden="true" tabindex="-1"></a>        xanchor<span class="op">=</span><span class="st">'right'</span>,</span>
<span id="cb41-127"><a href="#cb41-127" aria-hidden="true" tabindex="-1"></a>        yanchor<span class="op">=</span><span class="st">'top'</span></span>
<span id="cb41-128"><a href="#cb41-128" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-129"><a href="#cb41-129" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-130"><a href="#cb41-130" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb41-131"><a href="#cb41-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-132"><a href="#cb41-132" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plots using your function</span></span>
<span id="cb41-133"><a href="#cb41-133" aria-hidden="true" tabindex="-1"></a>magnitude_bar_fig_19 <span class="op">=</span> create_magnitude_bar_chart(freq_comparison_labeled, <span class="dv">2019</span>)</span>
<span id="cb41-134"><a href="#cb41-134" aria-hidden="true" tabindex="-1"></a>magnitude_bar_fig_23 <span class="op">=</span> create_magnitude_bar_chart(freq_comparison_labeled, <span class="dv">2023</span>)</span>
<span id="cb41-135"><a href="#cb41-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-136"><a href="#cb41-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-137"><a href="#cb41-137" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Combine Figures into a Single View ---</span></span>
<span id="cb41-138"><a href="#cb41-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-139"><a href="#cb41-139" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Create a combined figure with 1 row and 2 columns</span></span>
<span id="cb41-140"><a href="#cb41-140" aria-hidden="true" tabindex="-1"></a>combined_fig <span class="op">=</span> make_subplots(</span>
<span id="cb41-141"><a href="#cb41-141" aria-hidden="true" tabindex="-1"></a>    rows<span class="op">=</span><span class="dv">1</span>, </span>
<span id="cb41-142"><a href="#cb41-142" aria-hidden="true" tabindex="-1"></a>    cols<span class="op">=</span><span class="dv">2</span>, </span>
<span id="cb41-143"><a href="#cb41-143" aria-hidden="true" tabindex="-1"></a>    shared_yaxes<span class="op">=</span><span class="va">True</span>, <span class="co"># Shares the y-axis (and hides labels on the right plot)</span></span>
<span id="cb41-144"><a href="#cb41-144" aria-hidden="true" tabindex="-1"></a>    subplot_titles<span class="op">=</span>(<span class="st">"2019 Results"</span>, <span class="st">"2023 Results"</span>),</span>
<span id="cb41-145"><a href="#cb41-145" aria-hidden="true" tabindex="-1"></a>    horizontal_spacing<span class="op">=</span><span class="fl">0.03</span> <span class="co"># Reduce space between plots</span></span>
<span id="cb41-146"><a href="#cb41-146" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-147"><a href="#cb41-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-148"><a href="#cb41-148" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Add traces from the 2019 figure to the left subplot (row 1, col 1)</span></span>
<span id="cb41-149"><a href="#cb41-149" aria-hidden="true" tabindex="-1"></a><span class="co"># These traces have the legends we want to keep</span></span>
<span id="cb41-150"><a href="#cb41-150" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trace <span class="kw">in</span> magnitude_bar_fig_19.data:</span>
<span id="cb41-151"><a href="#cb41-151" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use legendgroup to link items and set showlegend=True</span></span>
<span id="cb41-152"><a href="#cb41-152" aria-hidden="true" tabindex="-1"></a>    trace.update(showlegend<span class="op">=</span><span class="va">True</span>, legendgroup<span class="op">=</span>trace.name) </span>
<span id="cb41-153"><a href="#cb41-153" aria-hidden="true" tabindex="-1"></a>    combined_fig.add_trace(trace, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-154"><a href="#cb41-154" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-155"><a href="#cb41-155" aria-hidden="true" tabindex="-1"></a><span class="co"># Add vertical line for 'Accurate'</span></span>
<span id="cb41-156"><a href="#cb41-156" aria-hidden="true" tabindex="-1"></a>combined_fig.add_vline(x<span class="op">=</span><span class="dv">0</span>, line_dash<span class="op">=</span><span class="st">"dash"</span>, line_color<span class="op">=</span><span class="st">"#808080"</span>, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-157"><a href="#cb41-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-158"><a href="#cb41-158" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Add traces from the 2023 figure to the right subplot (row 1, col 2)</span></span>
<span id="cb41-159"><a href="#cb41-159" aria-hidden="true" tabindex="-1"></a><span class="co"># Set showlegend=False for these traces to avoid duplication</span></span>
<span id="cb41-160"><a href="#cb41-160" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trace <span class="kw">in</span> magnitude_bar_fig_23.data:</span>
<span id="cb41-161"><a href="#cb41-161" aria-hidden="true" tabindex="-1"></a>    trace.update(showlegend<span class="op">=</span><span class="va">False</span>, legendgroup<span class="op">=</span>trace.name)</span>
<span id="cb41-162"><a href="#cb41-162" aria-hidden="true" tabindex="-1"></a>    combined_fig.add_trace(trace, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb41-163"><a href="#cb41-163" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-164"><a href="#cb41-164" aria-hidden="true" tabindex="-1"></a><span class="co"># Add vertical line for 'Accurate'</span></span>
<span id="cb41-165"><a href="#cb41-165" aria-hidden="true" tabindex="-1"></a>combined_fig.add_vline(x<span class="op">=</span><span class="dv">0</span>, line_dash<span class="op">=</span><span class="st">"dash"</span>, line_color<span class="op">=</span><span class="st">"#808080 "</span>, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb41-166"><a href="#cb41-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-167"><a href="#cb41-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-168"><a href="#cb41-168" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Update the layout for a clean look</span></span>
<span id="cb41-169"><a href="#cb41-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-170"><a href="#cb41-170" aria-hidden="true" tabindex="-1"></a><span class="co"># Use settings from the original figures as a base</span></span>
<span id="cb41-171"><a href="#cb41-171" aria-hidden="true" tabindex="-1"></a>combined_fig.update_layout(</span>
<span id="cb41-172"><a href="#cb41-172" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb41-173"><a href="#cb41-173" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span><span class="st">"Comparison of Reporting Discrepancies&lt;br&gt;&lt;sub&gt;Difference = Observed - Stated (category levels)&lt;/sub&gt;"</span>,</span>
<span id="cb41-174"><a href="#cb41-174" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb41-175"><a href="#cb41-175" aria-hidden="true" tabindex="-1"></a>        xanchor<span class="op">=</span><span class="st">'center'</span></span>
<span id="cb41-176"><a href="#cb41-176" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb41-177"><a href="#cb41-177" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">500</span>,</span>
<span id="cb41-178"><a href="#cb41-178" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="cb41-179"><a href="#cb41-179" aria-hidden="true" tabindex="-1"></a>    barmode<span class="op">=</span><span class="st">'group'</span>,</span>
<span id="cb41-180"><a href="#cb41-180" aria-hidden="true" tabindex="-1"></a>    plot_bgcolor<span class="op">=</span><span class="st">'white'</span>,</span>
<span id="cb41-181"><a href="#cb41-181" aria-hidden="true" tabindex="-1"></a>    font<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">12</span>),</span>
<span id="cb41-182"><a href="#cb41-182" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use the legend definition from the original function</span></span>
<span id="cb41-183"><a href="#cb41-183" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb41-184"><a href="#cb41-184" aria-hidden="true" tabindex="-1"></a>        orientation<span class="op">=</span><span class="st">"h"</span>,</span>
<span id="cb41-185"><a href="#cb41-185" aria-hidden="true" tabindex="-1"></a>        yanchor<span class="op">=</span><span class="st">"bottom"</span>,</span>
<span id="cb41-186"><a href="#cb41-186" aria-hidden="true" tabindex="-1"></a>        xanchor<span class="op">=</span><span class="st">"center"</span>,</span>
<span id="cb41-187"><a href="#cb41-187" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb41-188"><a href="#cb41-188" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=-</span><span class="fl">0.2</span> <span class="co"># Position legend below both plots</span></span>
<span id="cb41-189"><a href="#cb41-189" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb41-190"><a href="#cb41-190" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-191"><a href="#cb41-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-192"><a href="#cb41-192" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Fix Y-Axis Visibility &amp; Gridlines (Addresses your previous question)</span></span>
<span id="cb41-193"><a href="#cb41-193" aria-hidden="true" tabindex="-1"></a><span class="co"># The right plot needs its Y-axis properties explicitly set to match the left one,</span></span>
<span id="cb41-194"><a href="#cb41-194" aria-hidden="true" tabindex="-1"></a><span class="co"># specifically forcing the gridlines to show even without labels.</span></span>
<span id="cb41-195"><a href="#cb41-195" aria-hidden="true" tabindex="-1"></a>combined_fig.update_yaxes(</span>
<span id="cb41-196"><a href="#cb41-196" aria-hidden="true" tabindex="-1"></a>    title_text<span class="op">=</span><span class="st">"Percentage of Responses"</span>,</span>
<span id="cb41-197"><a href="#cb41-197" aria-hidden="true" tabindex="-1"></a>    <span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>, <span class="dv">55</span>], <span class="co"># Match the range you set in the original function</span></span>
<span id="cb41-198"><a href="#cb41-198" aria-hidden="true" tabindex="-1"></a>    gridcolor<span class="op">=</span><span class="st">'#e5e7eb'</span>,</span>
<span id="cb41-199"><a href="#cb41-199" aria-hidden="true" tabindex="-1"></a>    ticksuffix<span class="op">=</span><span class="st">'%'</span>,</span>
<span id="cb41-200"><a href="#cb41-200" aria-hidden="true" tabindex="-1"></a>    showgrid<span class="op">=</span><span class="va">True</span>, <span class="co"># Explicitly force gridlines on the shared axis side</span></span>
<span id="cb41-201"><a href="#cb41-201" aria-hidden="true" tabindex="-1"></a>    col<span class="op">=</span><span class="dv">1</span></span>
<span id="cb41-202"><a href="#cb41-202" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-203"><a href="#cb41-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-204"><a href="#cb41-204" aria-hidden="true" tabindex="-1"></a>combined_fig.update_yaxes(</span>
<span id="cb41-205"><a href="#cb41-205" aria-hidden="true" tabindex="-1"></a>    <span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>, <span class="dv">55</span>],</span>
<span id="cb41-206"><a href="#cb41-206" aria-hidden="true" tabindex="-1"></a>    gridcolor<span class="op">=</span><span class="st">'#e5e7eb'</span>,</span>
<span id="cb41-207"><a href="#cb41-207" aria-hidden="true" tabindex="-1"></a>    ticksuffix<span class="op">=</span><span class="st">'%'</span>,</span>
<span id="cb41-208"><a href="#cb41-208" aria-hidden="true" tabindex="-1"></a>    showgrid<span class="op">=</span><span class="va">True</span>, <span class="co"># Explicitly force gridlines on the shared axis side</span></span>
<span id="cb41-209"><a href="#cb41-209" aria-hidden="true" tabindex="-1"></a>    col<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb41-210"><a href="#cb41-210" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep the labels hidden since we set shared_yaxes=True</span></span>
<span id="cb41-211"><a href="#cb41-211" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-212"><a href="#cb41-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-213"><a href="#cb41-213" aria-hidden="true" tabindex="-1"></a>combined_fig.add_annotation(</span>
<span id="cb41-214"><a href="#cb41-214" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="fl">0.05</span>, y<span class="op">=</span><span class="fl">0.98</span>,</span>
<span id="cb41-215"><a href="#cb41-215" aria-hidden="true" tabindex="-1"></a>    xref<span class="op">=</span><span class="st">"paper"</span>, yref<span class="op">=</span><span class="st">"paper"</span>,</span>
<span id="cb41-216"><a href="#cb41-216" aria-hidden="true" tabindex="-1"></a>    text<span class="op">=</span><span class="st">" Under-reported"</span>,</span>
<span id="cb41-217"><a href="#cb41-217" aria-hidden="true" tabindex="-1"></a>    showarrow<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb41-218"><a href="#cb41-218" aria-hidden="true" tabindex="-1"></a>    font<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">11</span>, color<span class="op">=</span><span class="st">'#64748b'</span>, weight<span class="op">=</span><span class="st">'bold'</span>),</span>
<span id="cb41-219"><a href="#cb41-219" aria-hidden="true" tabindex="-1"></a>    xanchor<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb41-220"><a href="#cb41-220" aria-hidden="true" tabindex="-1"></a>    yanchor<span class="op">=</span><span class="st">'top'</span></span>
<span id="cb41-221"><a href="#cb41-221" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-222"><a href="#cb41-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-223"><a href="#cb41-223" aria-hidden="true" tabindex="-1"></a>combined_fig.add_annotation(</span>
<span id="cb41-224"><a href="#cb41-224" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="fl">0.4</span>, y<span class="op">=</span><span class="fl">0.98</span>,</span>
<span id="cb41-225"><a href="#cb41-225" aria-hidden="true" tabindex="-1"></a>    xref<span class="op">=</span><span class="st">"paper"</span>, yref<span class="op">=</span><span class="st">"paper"</span>,</span>
<span id="cb41-226"><a href="#cb41-226" aria-hidden="true" tabindex="-1"></a>    text<span class="op">=</span><span class="st">"Over-reported "</span>,</span>
<span id="cb41-227"><a href="#cb41-227" aria-hidden="true" tabindex="-1"></a>    showarrow<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb41-228"><a href="#cb41-228" aria-hidden="true" tabindex="-1"></a>    font<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">11</span>, color<span class="op">=</span><span class="st">'#64748b'</span>, weight<span class="op">=</span><span class="st">'bold'</span>),</span>
<span id="cb41-229"><a href="#cb41-229" aria-hidden="true" tabindex="-1"></a>    xanchor<span class="op">=</span><span class="st">'right'</span>,</span>
<span id="cb41-230"><a href="#cb41-230" aria-hidden="true" tabindex="-1"></a>    yanchor<span class="op">=</span><span class="st">'top'</span></span>
<span id="cb41-231"><a href="#cb41-231" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-232"><a href="#cb41-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-233"><a href="#cb41-233" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Display the final stacked figure</span></span>
<span id="cb41-234"><a href="#cb41-234" aria-hidden="true" tabindex="-1"></a>combined_fig.show()</span>
<span id="cb41-235"><a href="#cb41-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-236"><a href="#cb41-236" aria-hidden="true" tabindex="-1"></a>combined_fig.write_image(</span>
<span id="cb41-237"><a href="#cb41-237" aria-hidden="true" tabindex="-1"></a>    <span class="st">"reporting_discrepancy.png"</span>, </span>
<span id="cb41-238"><a href="#cb41-238" aria-hidden="true" tabindex="-1"></a>    scale<span class="op">=</span><span class="dv">4</span>,          <span class="co"># Renders the image at 4x the resolution (400 DPI equivalent for typical screens)</span></span>
<span id="cb41-239"><a href="#cb41-239" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="dv">1280</span>,       <span class="co"># Use the width defined in your update_layout</span></span>
<span id="cb41-240"><a href="#cb41-240" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">800</span>        <span class="co"># Use the height defined in your update_layout</span></span>
<span id="cb41-241"><a href="#cb41-241" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>            <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG"></script><script type="text/javascript">if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}</script>                <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script charset="utf-8" src="https://cdn.plot.ly/plotly-3.2.0.min.js" integrity="sha256-iZ2u/oU2wf/vDbl/ChcX93WgbBRSBvUO6N413hDz7xM=" crossorigin="anonymous"></script>                <div id="9f2b3ad4-a411-419d-8ce0-efe69d05da08" class="plotly-graph-div" style="height:500px; width:1000px;"></div>            <script type="text/javascript">                window.PLOTLYENV=window.PLOTLYENV || {};                                if (document.getElementById("9f2b3ad4-a411-419d-8ce0-efe69d05da08")) {                    Plotly.newPlot(                        "9f2b3ad4-a411-419d-8ce0-efe69d05da08",                        [{"hovertemplate":"Commute\u003cbr\u003eDifference: %{x}\u003cbr\u003ePercentage: %{y:.1f}%\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"Commute","marker":{"color":"#3b82f6"},"name":"Commute","showlegend":true,"text":["","","2.8%","18.6%","19.4%","36.0%","7.6%","3.9%","4.1%","","2.3%",""],"textfont":{"size":12},"textposition":"outside","width":0.4,"x":{"dtype":"i4","bdata":"+\u002f\u002f\u002f\u002f\u002fz\u002f\u002f\u002f\u002f9\u002f\u002f\u002f\u002f\u002fv\u002f\u002f\u002f\u002f\u002f\u002f\u002f\u002f8AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAA"},"y":{"dtype":"f8","bdata":"prYDfnSq8z99eA4LcrHwP6q\u002fY\u002fQ0cAZAQhH\u002f70+jMkA9GNJoMG0zQG45r+RM\u002fkFAlzU2rz2ZHkDms75X11IPQFNnOw+4SBBAAw\u002fKI49C+z\u002fFiOIkiBACQMqPWVToYPQ\u002f"},"type":"bar","xaxis":"x","yaxis":"y"},{"hovertemplate":"Telework\u003cbr\u003eDifference: %{x}\u003cbr\u003ePercentage: %{y:.1f}%\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"Telework","marker":{"color":"#8b5cf6"},"name":"Telework","showlegend":true,"text":["2.4%","","3.2%","6.5%","17.1%","30.4%","14.8%","12.6%","8.3%","3.5%","",""],"textfont":{"size":12},"textposition":"outside","width":0.4,"x":{"dtype":"i4","bdata":"+\u002f\u002f\u002f\u002f\u002fz\u002f\u002f\u002f\u002f9\u002f\u002f\u002f\u002f\u002fv\u002f\u002f\u002f\u002f\u002f\u002f\u002f\u002f8AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAA"},"y":{"dtype":"f8","bdata":"6B7OIOwrA0CFC+N9qYDoP\u002fRLrqKjpAlAOy5sM8oCGkCS4zjIXxQxQP2OjPczWz5A6kcJYUOmLUB6PuuxoyYpQClmQR44jSBAyR4ty+0tDECTZIMeSsfcP5X0aAzpb6c\u002f"},"type":"bar","xaxis":"x","yaxis":"y"},{"hovertemplate":"Commute\u003cbr\u003eDifference: %{x}\u003cbr\u003ePercentage: %{y:.1f}%\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"Commute","marker":{"color":"#3b82f6"},"name":"Commute","showlegend":false,"text":["3.8%","","7.5%","9.1%","10.5%","49.8%","7.0%","6.9%","","","",""],"textfont":{"size":12},"textposition":"outside","width":0.4,"x":{"dtype":"i4","bdata":"+\u002f\u002f\u002f\u002f\u002fz\u002f\u002f\u002f\u002f9\u002f\u002f\u002f\u002f\u002fv\u002f\u002f\u002f\u002f\u002f\u002f\u002f\u002f8AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAA"},"y":{"dtype":"f8","bdata":"EpkfNDS5DkAHnnodDDb1P+R7X5HV1h1AFILlvq4jIkCT7gvyVfIkQEZKOuLQ5EhAgFvw0Dv4G0ARQaK3urkbQKbI2ud\u002f\u002fvo\u002fQvRZTvwU4T+UW6fnfLPsP1ePzcBcB\u002fA\u002f"},"type":"bar","xaxis":"x2","yaxis":"y2"},{"hovertemplate":"Telework\u003cbr\u003eDifference: %{x}\u003cbr\u003ePercentage: %{y:.1f}%\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"Telework","marker":{"color":"#8b5cf6"},"name":"Telework","showlegend":false,"text":["","","6.5%","7.2%","14.9%","44.5%","4.5%","10.5%","3.7%","","3.7%",""],"textfont":{"size":12},"textposition":"outside","width":0.4,"x":{"dtype":"i4","bdata":"+\u002f\u002f\u002f\u002f\u002fz\u002f\u002f\u002f\u002f9\u002f\u002f\u002f\u002f\u002fv\u002f\u002f\u002f\u002f\u002f\u002f\u002f\u002f8AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAA"},"y":{"dtype":"f8","bdata":"QrAB5PN99z9ql77KfzP2PzOYaKAq5RlAaps6vBq4HEATiyU1U7otQFFt3N9uQUZAPrfQZxIrEkBMX3F7jAglQKjR4tTe6Q1AX6yUldhA9z\u002fhVESH\u002fMsNQOyyQIoj3sE\u002f"},"type":"bar","xaxis":"x2","yaxis":"y2"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermap":[{"type":"scattermap","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}},"xaxis":{"anchor":"y","domain":[0.0,0.485]},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Percentage of Responses"},"range":[0,55],"gridcolor":"#e5e7eb","ticksuffix":"%","showgrid":true},"xaxis2":{"anchor":"y2","domain":[0.515,1.0]},"yaxis2":{"anchor":"x2","domain":[0.0,1.0],"matches":"y","showticklabels":false,"range":[0,55],"gridcolor":"#e5e7eb","ticksuffix":"%","showgrid":true},"annotations":[{"font":{"size":16},"showarrow":false,"text":"2019 Results","x":0.2425,"xanchor":"center","xref":"paper","y":1.0,"yanchor":"bottom","yref":"paper"},{"font":{"size":16},"showarrow":false,"text":"2023 Results","x":0.7575000000000001,"xanchor":"center","xref":"paper","y":1.0,"yanchor":"bottom","yref":"paper"},{"font":{"color":"#64748b","size":11,"weight":"bold"},"showarrow":false,"text":" Under-reported","x":0.05,"xanchor":"left","xref":"paper","y":0.98,"yanchor":"top","yref":"paper"},{"font":{"color":"#64748b","size":11,"weight":"bold"},"showarrow":false,"text":"Over-reported ","x":0.4,"xanchor":"right","xref":"paper","y":0.98,"yanchor":"top","yref":"paper"}],"shapes":[{"line":{"color":"#808080","dash":"dash"},"type":"line","x0":0,"x1":0,"xref":"x","y0":0,"y1":1,"yref":"y domain"},{"line":{"color":"#808080 ","dash":"dash"},"type":"line","x0":0,"x1":0,"xref":"x2","y0":0,"y1":1,"yref":"y2 domain"}],"title":{"text":"Comparison of Reporting Discrepancies\u003cbr\u003e\u003csub\u003eDifference = Observed - Stated (category levels)\u003c\u002fsub\u003e","x":0.5,"xanchor":"center"},"font":{"size":12},"legend":{"orientation":"h","yanchor":"bottom","xanchor":"center","x":0.5,"y":-0.2},"height":500,"width":1000,"barmode":"group","plot_bgcolor":"white"},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('9f2b3ad4-a411-419d-8ce0-efe69d05da08');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };            </script>        </div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>INFO:choreographer.browsers.chromium:Chromium init'ed with kwargs {}
INFO:choreographer.browsers.chromium:Found chromium path: C:\Users\nfournier\AppData\Local\Google\Chrome\Application\chrome.exe
INFO:choreographer.utils._tmpfile:Temp directory created: C:\Users\nfournier\AppData\Local\Temp\tmp7os13ye1.
INFO:choreographer.browser_async:Opening browser.
INFO:choreographer.utils._tmpfile:Temp directory created: C:\Users\nfournier\AppData\Local\Temp\tmp71hrml54.
INFO:choreographer.browsers.chromium:Temporary directory at: C:\Users\nfournier\AppData\Local\Temp\tmp71hrml54
INFO:kaleido.kaleido:Conforming 1 to file:///C:/Users/nfournier/AppData/Local/Temp/tmp7os13ye1/index.html
INFO:kaleido.kaleido:Waiting on all navigates
INFO:kaleido.kaleido:All navigates done, putting them all in queue.
INFO:kaleido.kaleido:Getting tab from queue (has 1)
INFO:kaleido.kaleido:Got 380A
INFO:kaleido._kaleido_tab:Processing Comparison_of_Reporting_DiscrepanciesbrsubDifference__Observed___Stated_category_levelssub.png
INFO:kaleido._kaleido_tab:Sending big command for Comparison_of_Reporting_DiscrepanciesbrsubDifference__Observed___Stated_category_levelssub.png.
INFO:kaleido._kaleido_tab:Sent big command for Comparison_of_Reporting_DiscrepanciesbrsubDifference__Observed___Stated_category_levelssub.png.
INFO:kaleido.kaleido:Reloading tab 380A before return.
INFO:kaleido.kaleido:Putting tab 380A back (queue size: 0).
INFO:kaleido.kaleido:Waiting for all cleanups to finish.
INFO:kaleido.kaleido:Exiting Kaleido
INFO:choreographer.browser_async:Closing browser.
INFO:choreographer.browser_async:Closing browser.
INFO:choreographer.utils._tmpfile:TemporaryDirectory.cleanup() worked.
INFO:choreographer.utils._tmpfile:shutil.rmtree worked.
INFO:kaleido.kaleido:Cancelling tasks.
INFO:kaleido.kaleido:Exiting Kaleido/Choreo
INFO:choreographer.utils._tmpfile:TemporaryDirectory.cleanup() worked.
INFO:choreographer.utils._tmpfile:shutil.rmtree worked.
INFO:choreographer.utils._tmpfile:TemporaryDirectory.cleanup() worked.
INFO:choreographer.utils._tmpfile:shutil.rmtree worked.
INFO:kaleido.kaleido:Cancelling tasks.
INFO:kaleido.kaleido:Exiting Kaleido/Choreo</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>